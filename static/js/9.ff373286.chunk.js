/*! For license information please see 9.ff373286.chunk.js.LICENSE.txt */
(this.webpackJsonpundefined=this.webpackJsonpundefined||[]).push([[9],{315:function(e,t,a){},317:function(e,t,a){},320:function(e,t,a){},367:function(e,t,a){"use strict";a.r(t);var n=a(62),r=a(16),s=a(47),i=a(11),o=a(14),l=a(7),u=a(25),c=a(24),p=a(0),d=a.n(p),h=(a(315),a(20)),g=a(55),m=a(87),y=a(54),b=a(49),f=a(251),v=a(204),x=a(297),_=a(298),k=a(378),O=a(301),j=a(299),E=a(300),w=a(244),S=a(365),C=a(295),V=a(366),I=a(263),D=a(281),A=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={lng:NaN,lat:NaN,countryCode:null,legalityStatusNumber:null},n.initialMapViewport=void 0,n.usedMarker=void 0,n.setStateGeoPos=n.setStateGeoPos.bind(Object(l.a)(n)),n.getStatusColor=n.getStatusColor.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){window.addEventListener("mapViewportUpdated",this.setStateGeoPos),this.usedMarker!==this.props.marker&&this.markerChanged(this.props.marker)}},{key:"componentDidChange",value:function(){this.usedMarker!==this.props.marker&&this.markerChanged(this.props.marker)}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("mapViewportUpdated",this.setStateGeoPos),setTimeout((function(){e.props.globals.mainMapFunctions.useAsGeoChooser(!1,void 0)}),1)}},{key:"getLegalityNumber",value:function(e){var t=Object(y.f)(e);return t?t.overview.statusNumber:null}},{key:"setCountryCode",value:function(e,t){var a=this;this.props.globals.graphql.query({query:g.d,variables:{lng:e,lat:t}}).then((function(e){e&&e.data&&e.data.countrycode?a.setState({countryCode:e.data.countrycode,legalityStatusNumber:a.getLegalityNumber(e.data.countrycode)}):a.setState({countryCode:null,legalityStatusNumber:null})})).catch((function(e){a.setState({countryCode:null,legalityStatusNumber:null})}))}},{key:"markerChanged",value:function(e){var t=this;if(e&&e.center&&e.zoom){this.usedMarker=e;var a=e.center.lat||0,n=e.center.lng||0;if(0===a&&0===n){var r=this.getGeo();n=r.lng,a=r.lat}var s={lng:n,lat:a},i=this.props.store.get("map_zoom")||3;"mapbox"===this.props.globals.mainMapFunctions.getMapType()?this.props.globals.mainMapFunctions.flyTo({center:s,zoom:i,padding:{left:this.props.globals.sidebarIsOpen?400:0},duration:this.props.globals.transitionDuration}):(this.props.globals.sidebarIsOpen&&(s=this.props.globals.mainMapFunctions.unproject(this.props.globals.mainMapFunctions.project(s,i).add([-200,0]),i)),this.props.globals.mainMapFunctions.flyTo(s,i,{duration:.001*this.props.globals.transitionDuration})),setTimeout((function(){t.props.globals.mainMapFunctions.useAsGeoChooser(!0,t.props.doc)}),this.props.globals.transitionDuration)}}},{key:"getGeo",value:function(e){var t=this.props.store.get("map_center_fake"),a=0,n=0;return Array.isArray(t)?(a=Number.parseFloat(t[0].toFixed(6)),n=Number.parseFloat(t[1].toFixed(6))):t&&(a=Number.parseFloat(t.lng.toFixed(6)),n=Number.parseFloat(t.lat.toFixed(6))),{lng:a,lat:n}}},{key:"setStateGeoPos",value:function(e){var t=this.getGeo(),a=t.lng,n=t.lat;this.setState({lng:a,lat:n}),this.setCountryCode(a,n),this.props.onChange&&this.props.onChange({lng:a,lat:n})}},{key:"getStatusColor",value:function(e){return"great"===e||1===e?this.props.theme.palette.success.main:"ok"===e||2===e?this.props.theme.palette.warning.main:"bad"===e||3===e?this.props.theme.palette.error.main:this.props.theme.palette.background.default}},{key:"render",value:function(){return d.a.createElement("div",{style:this.props.style},d.a.createElement(j.a,{variant:"body2",gutterBottom:!0},d.a.createElement(h.a,{id:"instructions"})),d.a.createElement(j.a,{variant:"body2",style:{opacity:.6}},d.a.createElement(h.a,{id:"lat",vars:{lat:this.state.lat+""||""}})),d.a.createElement(j.a,{variant:"body2",style:{opacity:.6}},d.a.createElement(h.a,{id:"lng",vars:{lng:this.state.lng+""||""}})),3===this.state.legalityStatusNumber?d.a.createElement(j.a,{key:"geoInputErrorMessage_NotLegal",variant:"body2",style:{marginTop:"16px",color:this.getStatusColor(this.state.legalityStatusNumber)}},d.a.createElement(h.a,{id:"legality_message_geo_not_legal"})):void 0,d.a.createElement(j.a,{key:"geoInputInfoMessage_BeCautious",variant:"body2",style:{marginTop:"16px"}},d.a.createElement(h.a,{id:"legality_message_be_cautious"})),this.state.countryCode?d.a.createElement("div",{style:{display:"block",margin:"16px 0 0",background:this.props.theme.palette.background.default,borderRadius:"8px",overflow:"hidden"}},d.a.createElement(D.a,{key:"d_facts_"+this.state.countryCode,countryCode:this.state.countryCode,toggleable:!0})):void 0)}}]),a}(d.a.Component),F=Object(b.b)(Object(I.a)(A)),T=a(370),B=a(322),N=a(133),q=a(118),Q=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n,o;return Object(i.a)(this,a),(o=t.call(this,e)).filterOptions=function(e,t){var a=t.inputValue;return Object(B.a)(e,a,{threshold:B.a.rankings.CONTAINS,keys:["name_translated","terms_translated","category_name_translated","key","color.key"]})},o._options_=(n=[]).concat.apply(n,Object(s.a)(N.map((function(e){return Object.values(m).filter((function(t){return e.presets.some((function(e){return t.key===e||t.key.startsWith(e+"/")}))})).map((function(t){return o.preset4options(Object(r.a)({},t,{category_name_translated:Object(y.g)(e.name,o.props.globals.userLocales),color:e.color}))})).sort(o.presetSorter)}))).concat(Object(s.a)(Object.values(m).filter((function(e){return!N.some((function(t){return t.presets.some((function(t){return e.key===t||e.key.startsWith(t+"/")}))}))})).map((function(t){return o.preset4options(Object(r.a)({},t,{category_name_translated:e.getString("category_more"),color:q.default}))})).sort(o.presetSorter)))),o.presetChanged=o.presetChanged.bind(Object(l.a)(o)),o}return Object(o.a)(a,[{key:"presetSorter",value:function(e,t){var a=t.icon.localeCompare(e.icon),n=-t.name_translated.localeCompare(e.name_translated);return 0===a?n:a}},{key:"preset4options",value:function(e){return Object(r.a)({},e,{name_translated:Object(y.g)(e.name,this.props.globals.userLocales),terms_translated:Object(y.g)(e.terms,this.props.globals.userLocales),icon:e.icon?e.icon.toLowerCase():""})}},{key:"presetChanged",value:function(e,t){this.props.onChange&&this.props.onChange(t&&t.key?t.key:null)}},{key:"render",value:function(){var e=this,t=void 0;return this.props.defaultValue&&m[this.props.defaultValue]&&(t=this.preset4options(Object(r.a)({},m[this.props.defaultValue],{category_name_translated:"",color:q.default}))),d.a.createElement("div",{style:this.props.style},d.a.createElement(T.a,{options:this._options_,groupBy:function(e){return e.category_name_translated||""},getOptionLabel:function(e){return e.name_translated},getOptionSelected:function(e,t){return!!t&&t.key===e.key},renderOption:function(e){return d.a.createElement(v.a,{component:"div",style:{margin:"-6px -16px -6px -24px"}},d.a.createElement(x.a,null,d.a.createElement("div",{className:"material-icons-round",style:{color:e.icon?"default"===e.color.key?e.color.bg:e.color.fg:"",backgroundColor:e.icon?"default"===e.color.key?"":e.color.bg:"",borderRadius:"100%",width:"40px",height:"40px",lineHeight:"40px",textAlign:"center"}},e.icon)),d.a.createElement(_.a,{primary:e.name_translated}))},ListboxProps:{style:{WebkitOverflowScrolling:"touch"}},PaperComponent:f.a,blurOnSelect:!0,openOnFocus:!0,clearText:"nextQuestionIDs",closeText:"Close",noOptionsText:"No options",openText:"Open",filterOptions:this.filterOptions,defaultValue:t,onChange:this.presetChanged,renderInput:function(t){return d.a.createElement(k.a,Object.assign({},t,{label:e.props.label||"",variant:"outlined",color:"secondary"}))}}))}}]),a}(d.a.Component),P=Object(b.b)(Object(h.c)(Q)),L=(a(317),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={year:"",month:"",date:""},n.formated={year:null,month:null,date:null},n.parseDateString=n.parseDateString.bind(Object(l.a)(n)),n.setValue=n.setValue.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.parseDateString()}},{key:"componentDidChange",value:function(){this.parseDateString()}},{key:"parseDateString",value:function(){var e=this,t=this.props.defaultValue,a=[];t&&(t[""]?a=t[""].match(/(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?/):"string"===typeof t&&(a=t.match(/(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?/)));var n="";t.hasOwnProperty("year:is_set")&&!1===t["year:is_set"]||!t.year&&!a[1]||(n=t.year||a[1]);var r="";t.hasOwnProperty("month:is_set")&&!1===t["month:is_set"]||!t.month&&!a[2]||(r=t.month||a[2]);var s="";t.hasOwnProperty("day:is_set")&&!1===t["day:is_set"]||!t.day&&!a[3]||(s=t.day||a[3]),this.setState({year:n,month:r,day:s},(function(){e.formated={year:e.getFormatedValue("year",n),month:e.getFormatedValue("month",r),day:e.getFormatedValue("day",s)}}))}},{key:"getFormatedValue",value:function(e,t){var a=t,n=!1,r="";if(t*=1,"year"===e)t>99999?t=99999:n=!0,r=(t+"").padStart(4,"0");else if("month"===e)t>12?t=12:t<1?t=1:n=!0,r=(t+"").padStart(2,"0");else if("day"===e){var s=31;this.formated.year&&this.formated.year.isSet&&this.formated.month&&this.formated.month.isSet&&(s=new Date(this.formated.year.value,this.formated.month.value,0).getDate()),t>s?t=s:t<1?t=1:n=!0,r=(t+"").padStart(2,"0")}return{asString:r,value:t,isSet:n,real:a}}},{key:"setValue",value:function(e,t){this.formated[e]=this.getFormatedValue(e,t),"day"!==e&&(this.formated.day=this.getFormatedValue("day",this.formated.day.real));var a=Object.fromEntries(Object.entries(this.formated).map((function(e){return[e[0],e[1].value]}))),n=Object.fromEntries(Object.entries(this.formated).map((function(e){return[e[0]+":is_set",e[1].isSet]})));this.props.onChange&&this.props.onChange(Object(r.a)({"":this.formated.year.asString+"-"+this.formated.month.asString+"-"+this.formated.day.asString},a,{},n))}},{key:"render",value:function(){var e=this,t=this.props.getString("date-input-order",null,"").split("-").filter((function(e){return!!e&&" "!==e}));return d.a.createElement("div",{className:"DateInput",style:this.props.style},d.a.createElement("div",{className:"TextFields"},t.map((function(t,a){return d.a.createElement(k.a,{autoFocus:"year"===t,className:"TextField",type:"number",key:t+"_"+e.state[t],label:e.props.getString("".concat(t,"-label"),null,t),variant:"outlined",color:"secondary",defaultValue:e.state[t],onChange:function(a){return e.setValue(t,a.target.value)}})}))),this.props.helperText?d.a.createElement(j.a,{className:"helperText",variant:"caption"},this.props.helperText):null)}}]),a}(d.a.Component)),M=Object(b.b)(Object(h.c)(L)),z=a(21),W=a(363),R=a(321),G=a(318),K=a.n(G),U=a(43),J=a(372),H=a(371),$=a(375),X=function(e){var t=e.index,a=e.type,n=e.label,r=e.onDelete,s={index:t,type:a},i=Object(H.a)({item:s,collect:function(e){return{isDragging:e.isDragging()}}}),o=Object(z.a)(i,2),l=o[0].isDragging,u=o[1];return d.a.createElement($.a,{ref:u,label:n,style:{cursor:"move",margin:"0 2px 4px 2px",WebkitTouchCallout:"none",WebkitUserSelect:"none",KhtmlUserSelect:"none",MozUserSelect:"none",MsUserSelect:"none",userSelect:"none",opacity:l?.4:1},onDelete:"function"===typeof r?function(){return r(s)}:null})},Y=a(362),Z=a(379),ee=function(e){var t=e.label,a=e.accept,n=e.items,s=e.onDrop,i=e.onRemoveItem,o=Object(U.a)(),l=Object(J.a)({accept:a,drop:s,collect:function(e){return{isOver:e.isOver(),canDrop:e.canDrop()}}}),u=Object(z.a)(l,2),c=u[0],p=c.isOver,h=c.canDrop,g=u[1],m=p&&h,y=n.length>0;return d.a.createElement(Y.a,{ref:g,variant:"outlined",color:"secondary",fullWidth:!0,style:{transition:"margin-top 0.2s ease",marginTop:y?"16px":"8px"}},d.a.createElement(Z.a,{focused:y&&m,shrink:y},t,""),d.a.createElement("fieldset",{style:{display:"block",width:"auto",minHeight:"1.1875em",padding:"18.5px 8px",borderWidth:"1px",borderStyle:"solid",borderColor:m?o.palette.secondary.main:"dark"===o.palette.type?"rgba(255,255,255,0.23)":"rgba(0,0,0,0.23)",transition:"border-color 200ms ease 0ms",borderRadius:"8px",marginTop:"-5px"}},d.a.createElement("legend",{style:Object(r.a)({width:"auto",height:"11px",display:"block",padding:"0",fontSize:"0.75em",textAlign:"left",visibility:"hidden"},y?{maxWidth:"1000px",transition:"max-width 100ms ease 50ms"}:{maxWidth:"0.01px",transition:"max-width 50ms ease 0ms"})},d.a.createElement("span",{style:{padding:"0 5px"}},t,"")),d.a.createElement("div",{style:{margin:"-13px -2px -14px -2px"}},n.map((function(e){return d.a.createElement(X,{key:e.index,index:e.index,label:e.label,type:e.type,onDelete:i})})))))},te=function(e){return d.a.createElement(W.a,{backend:R.a},d.a.createElement(ae,e))},ae=function(e){var t=e.defaultValue,a=e.onChange,s=e.style,i=Object(p.useState)([{value:"only",label:d.a.createElement(h.b,{id:"audience_input_label_only"})},{value:"primary",label:d.a.createElement(h.b,{id:"audience_input_label_primary"})},{value:"welcome",label:d.a.createElement(h.b,{id:"audience_input_label_welcome"})},{value:"no",label:d.a.createElement(h.b,{id:"audience_input_label_no"})}]),o=Object(z.a)(i,1)[0],l=Object(p.useState)([]),u=Object(z.a)(l,2),c=u[0],g=u[1];Object(p.useEffect)((function(){g(["queer","youth","trans","inter","sexuality:bi","sexuality:lesbian","sexuality:gay","allies","cis","men","women"].map((function(e){return{key:e,label:d.a.createElement(h.b,{id:e.replace(/:/g,"_")}),value:t[e]||null,defaultValue:t[e]||null,type:"box"}})))}),[t]);var m=Object(p.useCallback)((function(e,t){var r=K()(c,Object(n.a)({},t.index,{value:{$set:e}}));g(r);var s=Object.fromEntries(r.filter((function(e){return e.hasOwnProperty("value")&&e.value!==e.defaultValue})).map((function(e){return[e.key,e.value||!1]})));a(s)}),[c,a]);return d.a.createElement("div",{style:s},d.a.createElement(j.a,{variant:"body2",style:{marginBottom:"16px"}},d.a.createElement(h.b,{id:"audience_input_instruction"})),d.a.createElement("div",null,c.map((function(e,t){return Object(r.a)({},e,{index:t})})).filter((function(e){return null===e.value})).map((function(e){return d.a.createElement(X,{key:e.index,index:e.index,label:e.label,type:e.type})}))),o.map((function(e){var t=e.value,a=e.label;return d.a.createElement(ee,{key:t,label:a,accept:["box"],items:c.map((function(e,t){return Object(r.a)({},e,{index:t})})).filter((function(e){return e.value===t})),onDrop:function(e){return m(t,e)},onRemoveItem:function(e){return m(null,e)}})})))},ne=(a(320),a(364)),re=a(380),se=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={value:{},showAllFields:!1},n.newValue={},n.parseDefaultValue=n.parseDefaultValue.bind(Object(l.a)(n)),n.setValue=n.setValue.bind(Object(l.a)(n)),n.toggleShowAllFields=n.toggleShowAllFields.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){this.parseDefaultValue()}},{key:"componentDidChange",value:function(){this.parseDefaultValue()}},{key:"parseDefaultValue",value:function(){var e=this;this.setState({value:this.props.defaultValue||{}},(function(){e.newValue=JSON.parse(JSON.stringify(e.state.value)),e.publishChanges(),e.setCountryCode()}))}},{key:"setCountryCode",value:function(){var e=this,t=this.props.tags.lng,a=this.props.tags.lat;this.props.globals.graphql.query({query:g.d,variables:{lng:t,lat:a}}).then((function(t){if(t&&t.data&&t.data.countrycode){var a=t.data.countrycode;e.props.globals.convert_alpha3_to_alpha2(a,(function(t){e.setValue("country",t)}))}else e.setValue("country",null)})).catch((function(t){e.setValue("country",null)}))}},{key:"setValue",value:function(e,t){this.newValue[e]=t,this.publishChanges()}},{key:"publishChanges",value:function(){if(this.props.onChange){for(var e={},t=0,a=Object.keys(this.newValue);t<a.length;t++){var n=a[t];this.state.value[n]!==this.newValue[n]&&(e[n]=this.newValue[n])}this.props.onChange(e)}}},{key:"getAddressInputStyles",value:function(e,t){return e.widths[t]?{width:100*e.widths[t]+"%"}:{width:"auto",flexShrink:"2"}}},{key:"toggleShowAllFields",value:function(e){this.setState((function(e,t){return{showAllFields:!e.showAllFields}}))}},{key:"render",value:function(){var e=this,t=this.state.value.country||null,a=(t||"").toLowerCase(),n=Object(y.a)(t,this.state.showAllFields);return d.a.createElement("div",{className:"AddressInput",style:this.props.style},d.a.createElement("div",null,n.format.map((function(t){return d.a.createElement("div",{key:JSON.stringify(t),className:"TextFields"},t.map((function(t){var r=e.state.value[t],s=e.props.getString("label_".concat(t,"_").concat(a),null,e.props.getString("label_".concat(t),null,t));return d.a.createElement(k.a,{className:"TextField",type:"text",key:t,label:s,title:s,variant:"outlined",size:"small",color:"secondary",defaultValue:r,onChange:function(a){return e.setValue(t,a.target.value)},style:e.getAddressInputStyles(n,t)})})))}))),d.a.createElement(ne.a,{style:{display:"_ALL_FIELDS_"===t?"none":"flex",margin:"8px 0 0",width:"auto",padding:"0 8px 0 0",boxShadow:"inset 0 0 0 999px ".concat(this.props.theme.palette.divider),borderRadius:"".concat(this.props.theme.shape.borderRadius,"px")},control:d.a.createElement(re.a,{checked:this.state.showAllFields,onChange:this.toggleShowAllFields,inputProps:{"aria-label":this.props.getString("show_all_fields")}}),label:this.props.getString("show_all_fields")}),this.props.helperText?d.a.createElement(j.a,{className:"helperText",variant:"caption"},this.props.helperText):null)}}]),a}(d.a.Component),ie=Object(b.b)(Object(h.c)(Object(I.a)(se))),oe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={questionsAreLoaded:!1,answersByQuestionId:{},questionsById:{},nextQuestionIDs:[],stageIndex:0},n.sourcesText="",n.answer_tags={},n.tagsFromTheDoc={},n.inputValues={},n.renderStage=n.renderStage.bind(Object(l.a)(n)),n.answerQuestion=n.answerQuestion.bind(Object(l.a)(n)),n.loadQuestions=n.loadQuestions.bind(Object(l.a)(n)),n.submitInputs=n.submitInputs.bind(Object(l.a)(n)),n.setQuestionAsActive=n.setQuestionAsActive.bind(Object(l.a)(n)),n.savePresetValue=n.savePresetValue.bind(Object(l.a)(n)),n.saveValueByKey=n.saveValueByKey.bind(Object(l.a)(n)),n.abort=n.abort.bind(Object(l.a)(n)),n.acceptPrivacyPolicy=n.acceptPrivacyPolicy.bind(Object(l.a)(n)),n.showQuestions=n.showQuestions.bind(Object(l.a)(n)),n.addSources=n.addSources.bind(Object(l.a)(n)),n.suggest=n.suggest.bind(Object(l.a)(n)),n.finish=n.finish.bind(Object(l.a)(n)),n.saveSourcesText=n.saveSourcesText.bind(Object(l.a)(n)),n}return Object(o.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.props.store.getPrivacy("tracking")&&this.setState({stageIndex:1}),this.setState((function(t,a){if(0===e.state.nextQuestionIDs.length&&e.props.startQuestions.length>0)return{nextQuestionIDs:e.props.startQuestions}})),this.loadQuestions()}},{key:"componentDidUpdate",value:function(){this.props.doc&&this.props.doc.properties&&this.props.doc.properties.tags&&this.props.doc.properties.tags!==this.tagsFromTheDoc&&(this.tagsFromTheDoc=this.props.doc.properties.tags)}},{key:"componentWillUnmount",value:function(){this.loadQuestionsQuerySubscription&&this.loadQuestionsQuerySubscription.unsubscribe()}},{key:"loadQuestions",value:function(){var e=this;this.loadQuestionsQuerySubscription=this.props.globals.graphql.watchQuery({fetchPolicy:"cache-and-network",query:g.h,variables:{languages:navigator.languages}}).subscribe((function(t){var a=t.data;if(a&&!e.state.questionsAreLoaded){var n=[].concat(Object(s.a)(e.props.startQuestions),Object(s.a)(e.state.nextQuestionIDs)),i=0,o=JSON.parse(JSON.stringify(a.questions)).reduce((function(t,a){var s=a.properties.possibleAnswers.filter((function(e){return"geo"===e.inputtype})).length>0;return e.props.globals.isSmallScreen&&s&&(i+=1),a.properties.question_translated=Object(y.h)(a.properties.question,e.props.globals.userLocales),a.properties.in_one_word_translated=Object(y.h)(a.properties.in_one_word,e.props.globals.userLocales),a.properties.description_translated=Object(y.h)(a.properties.description,e.props.globals.userLocales),a.properties.possibleAnswers=a.properties.possibleAnswers.map((function(t){return Object(r.a)({},t,{title_translated:Object(y.h)(t.title,e.props.globals.userLocales),description_translated:Object(y.h)(t.description,e.props.globals.userLocales)})})),t[a._id]=Object(r.a)({},a,{visible:!0,active:a._id===n[i],answered:!1,possibleAnswersByKey:a.properties.possibleAnswers.reduce((function(e,t){return e[t.key]=t,e}),{})}),t}),{});e.setState({questionsById:o,questionsAreLoaded:!0})}}))}},{key:"setQuestionAsActive",value:function(e){this.setState((function(t,a){for(var n=Object.keys(t.questionsById),r=t.questionsById,s=0,i=n;s<i.length;s++){r[i[s]].active=!1}return r[e].active=!0,{questionsById:r}}))}},{key:"answer2tags",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=this.state.questionsById[e];if(s&&s.possibleAnswersByKey){var i=s.possibleAnswersByKey[t];if(i){if(i.tags&&"object"===typeof i.tags&&Object.keys(i.tags).length>0)if("boolean"===typeof a)!0===a&&(n=Object(r.a)({},n,{},i.tags));else for(var o in i.tags)n[o]=a;n.preset&&"string"===typeof n.preset&&m[n.preset]&&m[n.preset].tags&&(n=Object(r.a)({},n,{},m[n.preset].tags))}}return n}},{key:"answerQuestion",value:function(e,t){var a=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=!1;Object.keys(t).length>0&&(o=!0),o&&(this.answer_tags=Object(r.a)({},this.answer_tags,{},t,{},Object.entries(t).reduce((function(t,n){return a.answer2tags(e,n[0],n[1],t)}),{}))),this.setState((function(a,l){var u=a.questionsById,c=a.nextQuestionIDs;if(u[e].active=!1,o&&(u[e].answered=!0),o&&0===i.length){var p=Object.keys(t);i=u[e].properties.possibleAnswers.filter((function(e){return p.includes(e.key)})).map((function(e){return e.followUpQuestionIDs||[]})).reduce((function(e,t){return[].concat(Object(s.a)(e),Object(s.a)(t))}),[])}if(i.length>0){var d=c.indexOf(e),h=c.slice(0,d+1),g=c.slice(d);c=Object(s.a)(new Set([].concat(Object(s.a)(h),Object(s.a)(i.filter((function(e){return!h.includes(e)}))),Object(s.a)(g.filter((function(e){return!i.includes(e)}))))))}var m=c.indexOf(e);if(m<c.length-1)for(var y=m+1;y<c.length;y+=1)if(u[c[y]]&&!u[c[y]].answered){u[c[y]].active=!0;break}return o?{nextQuestionIDs:c,questionsById:u,answersByQuestionId:Object(r.a)({},a.answersByQuestionId,Object(n.a)({},e,t))}:{nextQuestionIDs:c,questionsById:u}}))}},{key:"saveInputValue",value:function(e,t,a){this.inputValues[e]||(this.inputValues[e]={}),this.inputValues[e][t]=a}},{key:"submitInputs",value:function(e){var t=this.inputValues[e]||{};this.inputValues[e]={},this.answerQuestion(e,t)}},{key:"getInputValueByNamespace",value:function(e,t){var a={},n=t+":",r=n.length;if(this.inputValues[e]){for(var s=this.inputValues[e],i=0,o=Object.keys(s);i<o.length;i++){var l=o[i];l===t?a[""]=s[l]:l.startsWith(n)&&(a[l.substring(r)]=s[l])}if(Object.keys(a).lenght>0)return a}if(this.answer_tags){for(var u=this.answer_tags,c=0,p=Object.keys(u);c<p.length;c++){var d=p[c];d===t?a[""]=u[d]:d.startsWith(n)&&(a[d.substring(r)]=u[d])}if(Object.keys(a).lenght>0)return a}if(this.tagsFromTheDoc){for(var h=this.tagsFromTheDoc,g=0,m=Object.keys(h);g<m.length;g++){var y=m[g];y===t?a[""]=h[y]:y.startsWith(n)&&(a[y.substring(r)]=h[y])}if(Object.keys(a).lenght>0)return a}return a}},{key:"getInputValue",value:function(e,t){if(this.inputValues[e]&&this.inputValues[e][t])return this.inputValues[e][t];for(var a=this.state.questionsById[e].possibleAnswersByKey[t],n=Object.keys(a.tags||{}),r=0,s=n;r<s.length;r++){var i=s[r];if(this.answer_tags.hasOwnProperty(i))return this.answer_tags[i]}for(var o=0,l=n;o<l.length;o++){var u=l[o];if(this.tagsFromTheDoc.hasOwnProperty(u))return this.tagsFromTheDoc[u]}return""}},{key:"savePresetValue",value:function(e,t){this.saveInputValue(e,"preset",t.preset)}},{key:"saveValueByKey",value:function(e,t,a){for(var n=0,r=Object.keys(t);n<r.length;n++){var s=r[n];this.saveInputValue(e,a?""===s?a:a+":"+s:s,t[s])}}},{key:"renderQuestion",value:function(e){var t=this,a=this.state.questionsById[e];if(!(a&&a._id&&a.properties))return null;if(!a.visible)return null;var n=a.properties.possibleAnswers.filter((function(e){return"geo"===e.inputtype})).length>0;if(this.props.globals.isSmallScreen&&n)return null;var s=a.properties.possibleAnswers.filter((function(e){return"text"===e.inputtype||"number"===e.inputtype||"geo"===e.inputtype||"preset"===e.inputtype||"date"===e.inputtype||"audience"===e.inputtype||"address"===e.inputtype})).length>0,i=s||a.properties.possibleAnswers&&a.properties.possibleAnswers.length>2,o=this.props.doc.properties.geometry.location,l="";return a.active?""!==a.properties.question_translated?l=a.properties.question_translated:""!==a.properties.in_one_word_translated&&(l=a.properties.in_one_word_translated):""!==a.properties.in_one_word_translated?l=a.properties.in_one_word_translated:""!==a.properties.question_translated&&(l=a.properties.question_translated),d.a.createElement(f.a,{key:"question_".concat(a._id),className:"questionCard "+(a.answered?"answered ":"")+(a.active?"active ":"")+(s?"hasInputField ":"")+(i?"isMultiRow ":""),variant:"outlined",elevation:0,onClick:a.active?null:function(){return t.setQuestionAsActive(a._id)}},d.a.createElement(v.a,{dense:!0,disableGutters:!0,className:"questionText"},a.properties.icon?d.a.createElement(x.a,null,d.a.createElement("div",{className:"material-icons-round",style:{color:"inherit",width:"40px",height:"40px",lineHeight:"40px",textAlign:"center"}},a.properties.icon)):null,d.a.createElement(_.a,{primary:l,primaryTypographyProps:{variant:"body1"},secondary:a.active?a.properties.description_translated:""})),d.a.createElement("div",{className:"possibleAnswers",style:{flexDirection:i?"column":"row"}},a.active?a.properties.possibleAnswers.map((function(e){if(!e.hidden){var n=e.key,s=e.namespace,l=e.inputtype||"",u=e.inputOptions||{};return"date"===l?d.a.createElement(M,{key:n,label:e.title_translated,helperText:e.description_translated,defaultValue:t.getInputValueByNamespace(a._id,s),onChange:function(e){return t.saveValueByKey(a._id,e,s)}}):"address"===l?d.a.createElement(ie,{key:n,label:e.title_translated,helperText:e.description_translated,defaultValue:t.getInputValueByNamespace(a._id,s),tags:Object(r.a)({},t.props.doc.properties.tags,{},t.answer_tags),onChange:function(e){return t.saveValueByKey(a._id,e,s)},style:{padding:"0 8px"}}):"geo"===l?d.a.createElement(F,{key:n,marker:{center:o,zoom:18},doc:t.props.doc,onChange:function(e){return t.saveValueByKey(a._id,e,null)},style:{margin:"4px 0",padding:"0 12px"}}):"preset"===l?d.a.createElement(P,{key:n,label:e.title_translated,defaultValue:t.getInputValue(a._id,n),onChange:function(e){return t.saveInputValue(a._id,n,e)},style:{margin:"8px 8px 4px 8px"}}):"audience"===l?d.a.createElement(te,{key:n,label:e.title_translated,helperText:e.description_translated,defaultValue:t.getInputValueByNamespace(a._id,s),onChange:function(e){return t.saveValueByKey(a._id,e,s)},style:{margin:"0 8px"}}):"text"===l?d.a.createElement(k.a,Object.assign({type:"text"},u.multiline?{multiline:"multiline"}:null,{key:n,label:e.title_translated,helperText:e.description_translated,variant:"outlined",color:"secondary",defaultValue:t.getInputValue(a._id,n),onChange:function(e){return t.saveInputValue(a._id,n,e.target.value)},style:{margin:"8px 8px 4px"}})):"number"===l?d.a.createElement(k.a,{type:"number",key:n,label:e.title_translated,helperText:e.description_translated,variant:"outlined",color:"secondary",defaultValue:t.getInputValue(a._id,n),onChange:function(e){return t.saveInputValue(a._id,n,e.target.value)},style:{margin:"8px 8px 4px"}}):d.a.createElement(v.a,{button:!0,key:n,onClick:function(){return t.answerQuestion(a._id,e.tags||{},e.followUpQuestionIDs||[])},variant:"outlined",size:"large",style:{flexGrow:"1",border:"none",color:"inherit",margin:"4px 8px",padding:i?"10px 16px":"16px 8px",justifyContent:i?"flex-start":"center",textAlign:i?"inherit":"center",boxShadow:"inset 0 0 0 999px ".concat(t.props.theme.palette.divider),width:"auto",borderRadius:"".concat(t.props.theme.shape.borderRadius,"px")}},i&&e.icon?d.a.createElement(x.a,{style:{minWidth:"24px",margin:"6px 16px 0 0",alignSelf:"flex-start"}},d.a.createElement("div",{className:"material-icons-round"},e.icon)):void 0,d.a.createElement(_.a,{primary:e.title_translated,secondary:e.description_translated}))}})):void 0),d.a.createElement("div",{className:"saveButton"},d.a.createElement(O.a,{onClick:function(){return t.submitInputs(a._id)},variant:"outlined",size:"large",style:{border:"none",boxShadow:"inset 0 0 0 999px ".concat(this.props.theme.palette.divider),color:"inherit",margin:"0 8px",padding:"8px 16px 8px 12px"}},d.a.createElement(S.a,{style:{color:"var(--light-green)",marginRight:"8px"}}),d.a.createElement(h.a,{id:"save"}))))}},{key:"abort",value:function(){this.props.onAbort&&this.props.onAbort()}},{key:"acceptPrivacyPolicy",value:function(){var e=this;this.props.store.setPrivacy("tracking",!0).finally((function(){e.props.store.setPrivacy(null,!0).finally((function(){e.props.store.set("uuid",Object(y.i)(),"tracking"),e.showQuestions()}))}))}},{key:"showQuestions",value:function(){this.setState({stageIndex:1})}},{key:"addSources",value:function(){this.setState({stageIndex:2})}},{key:"suggest",value:function(){var e=this;Object.keys(this.answer_tags).length>0&&this.props.globals.graphql.mutate({mutation:g.a,variables:{properties:{forID:this.props.doc._id,tags:this.answer_tags,sources:this.sourcesText||"",fromBot:!1,dataset:"qiekub",antiSpamUserIdentifier:this.props.store.get("uuid")||""}}}).catch((function(e){console.error("mutation_addChangeset-error",e)})).finally((function(){e.setState({stageIndex:3})}))}},{key:"finish",value:function(){this.props.onFinish&&this.props.onFinish()}},{key:"saveSourcesText",value:function(e){this.sourcesText=e.target.value}},{key:"renderStage",value:function(){var e=this,t=this.state.stageIndex;if(0===t)return d.a.createElement("div",{style:{padding:"16px"}},d.a.createElement(j.a,{variant:"h6",gutterBottom:!0},d.a.createElement(h.a,{id:"headings_privacy_stage"})),d.a.createElement(j.a,{variant:"body1",gutterBottom:!0},d.a.createElement(h.a,{id:"privacy_info",elems:{privacy_policy_link:d.a.createElement(E.a,{target:"_blank",href:"https://www.qiekub.org/datenschutz.html"})}})),d.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",margin:"32px 0 0 0"}},d.a.createElement(w.a,{onClick:this.abort,variant:"extended",size:"large",style:{boxShadow:"none"}},d.a.createElement(C.a,{style:{marginRight:"8px"}}),d.a.createElement(h.a,{id:"abort"})),d.a.createElement(w.a,{onClick:this.acceptPrivacyPolicy,variant:"extended",size:"large",color:"secondary"},d.a.createElement(h.a,{id:"agree"}),d.a.createElement(V.a,{style:{color:"var(--light-green)",marginLeft:"8px"}}))));if(1===t){if(!this.state.questionsAreLoaded)return d.a.createElement("div",{style:{margin:"16px"}},d.a.createElement(j.a,{variant:"h6",gutterBottom:!0},d.a.createElement(h.a,{id:"headings_questions_stage"})),d.a.createElement(j.a,{variant:"body1",style:{margin:"0 0 32px 0"}},d.a.createElement(h.a,{id:"questions_are_loading"})),d.a.createElement(w.a,{onClick:this.abort,variant:"extended",size:"large",color:"secondary"},d.a.createElement(C.a,{style:{marginRight:"8px"}}),d.a.createElement(h.a,{id:"abort"})));if(this.state.questionsById&&Object.keys(this.state.questionsById).length>0)return d.a.createElement(d.a.Fragment,null,d.a.createElement(j.a,{variant:"h6",gutterBottom:!0,style:{margin:"16px 16px 32px 16px"}},d.a.createElement(h.a,{id:"headings_questions_stage"})),d.a.createElement(d.a.Fragment,{key:"questions"},this.state.nextQuestionIDs.map((function(t){return e.renderQuestion(t)}))),d.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",margin:"32px 0 0 0"}},d.a.createElement(w.a,{onClick:this.abort,variant:"extended",size:"large",style:{boxShadow:"none"}},d.a.createElement(C.a,{style:{marginRight:"8px"}}),d.a.createElement(h.a,{id:"abort"})),d.a.createElement(w.a,{onClick:this.addSources,variant:"extended",size:"large",color:"secondary"},d.a.createElement(h.a,{id:"next"}),d.a.createElement(V.a,{style:{color:"var(--light-green)",marginLeft:"8px"}}))))}else{if(2===t)return d.a.createElement("div",{style:{padding:"16px"}},d.a.createElement(j.a,{variant:"h6",gutterBottom:!0},d.a.createElement(h.a,{id:"headings_sources_stage"})),d.a.createElement(j.a,{variant:"body1",gutterBottom:!0},d.a.createElement(h.a,{id:"sources_info"})),d.a.createElement(k.a,{style:{marginTop:"16px"},variant:"outlined",color:"secondary",fullWidth:!0,multiline:!0,autoFocus:!1,placeholder:this.props.getString("sources_placeholder"),onChange:this.saveSourcesText}),d.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",margin:"32px 0 0 0"}},d.a.createElement(w.a,{onClick:this.showQuestions,variant:"extended",size:"large",style:{boxShadow:"none"}},d.a.createElement(C.a,{style:{marginRight:"8px"}}),d.a.createElement(h.a,{id:"back"})),d.a.createElement(w.a,{onClick:this.suggest,variant:"extended",size:"large",color:"secondary"},d.a.createElement(h.a,{id:"suggest"}),d.a.createElement(S.a,{style:{color:"var(--light-green)",marginLeft:"8px"}}))));if(3===t)return d.a.createElement("div",{style:{padding:"16px"}},d.a.createElement(j.a,{variant:"h6",gutterBottom:!0},d.a.createElement(h.a,{id:"headings_thanks_stage"})),d.a.createElement(j.a,{variant:"body1",gutterBottom:!0},d.a.createElement(h.a,{id:"after_questions_thanks_text"})),d.a.createElement("div",{style:{display:"flex",justifyContent:"space-between",margin:"32px 0 0 0"}},d.a.createElement(w.a,{onClick:this.finish,variant:"extended",size:"large",color:"secondary"},d.a.createElement(h.a,{id:"finish"}),d.a.createElement(S.a,{style:{color:"var(--light-green)",marginLeft:"8px"}}))))}return null}},{key:"render",value:function(){var e=this.props.doc;return e&&e._id?this.renderStage():null}}]),a}(d.a.Component);t.default=Object(b.b)(Object(h.c)(Object(I.a)(oe)))}}]);
//# sourceMappingURL=9.ff373286.chunk.js.map