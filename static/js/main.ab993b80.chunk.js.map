{"version":3,"sources":["components/Main/map/MainMapMapbox.module.css","images/mapbox-logo-black.svg","images/mapbox-logo-white.svg","locales lazy /^/.//.*/.ftl$/ groupOptions: {} namespace object","components/Localized/index.js","components/ConicGradient/index.js","components/Main/map/PruneCluster_dist/PruneCluster.js","components/FiltersPanelContent/index.js","components/Main/map/MainMapMapbox.js","components/Main/index.js","components/App/index.js","index.js","l10n.js","components/LocalStorage/index.js","components/Globals/index.js","functions.js","queries.js"],"names":["module","exports","map","webpackAsyncContext","req","__webpack_require__","o","Promise","resolve","then","e","Error","code","ids","id","t","keys","Object","Localized","props","key","elems","br","Fragment","children","withLocalization","Inner","l10n","React","useContext","FluentContext","createElement","getString","args","fallback","useConicGradient","waitingForConicGradient","useRef","useState","isRunning","setIsRunning","conicGradientExists","setConicGradientExists","onReady","useCallback","callback","current","push","getConicGradient","window","ConicGradient","useEffect","delay","savedCallback","setInterval","clearInterval","useInterval","PruneCluster","FiltersPanelContent","state","category","age","audience_queer","Set","mustHaveUndecidedChangeset","published","categories","_categories_","name_translated","getTranslation","name","globals","userLocales","audience_queer_values","translation_key","emoji","emojis","audience_queer_only","audience_queer_primary","audience_queer_welcome","ages","Array","apply","v","i","highest_ages_entry","length","setValue","bind","getFilterObj","toggleMustHaveUndecidedChangeset","this","onChange","presets","audienceQueerOptions","has","selectedAge","ageOption","stateKeyName","value","closeMenuCallback","setState","audienceKey","size","delete","add","className","variant","popupState","Fab","bindTrigger","aria-label","title","style","margin","background","color","bg","Menu","bindMenu","transitionDuration","anchorOrigin","vertical","horizontal","MenuItem","onClick","close","selected","isSelected","fg","theme","palette","type","undefined","vars","number","filter","audience","toogleAudienceQueer","strong","profileID","width","height","Component","withGlobals","withTheme","__extends","extendStatics","setPrototypeOf","__proto__","d","b","p","hasOwnProperty","__","constructor","prototype","create","PruneCluster_1","Point","ClusterObject","hashCodeCounter","maxHashCodeValue","Math","pow","Marker","_super","lat","lng","data","weight","filtered","_this","call","position","hashCode","Move","SetData","Cluster","marker","stats","ENABLE_MARKERS_LIST","_clusterMarkers","lastMarker","population","totalWeight","averagePosition","AddMarker","h","currentTotalWeight","newWeight","Reset","ComputeBounds","cluster","proj","Project","Size","startX","floor","x","startY","y","a","UnProject","bounds","minLat","maxLat","minLng","maxLng","GetClusterMarkers","ApplyCluster","newCluster","min","max","concat","insertionSort","list","j","tmp","tmpLng","_markers","_nbChanges","_clusters","ViewPadding","RegisterMarker","_removeFlag","RegisterMarkers","markers","forEach","_sortMarkers","total","nbChanges","sort","_sortClusters","_indexLowerBoundLng","it","step","first","count","_resetClusterViews","l","ProcessView","heightBuffer","abs","widthBuffer","extendedBounds","firstIndex","clusters","workingClusterList","slice","markerPosition","clusterFound","ll","splice","newClustersList","RemoveMarkers","newMarkersList","FindMarkersInArea","area","aMinLat","aMaxLat","aMinLng","aMaxLng","result","pos","withFiltered","rMinLat","Number","MAX_VALUE","rMaxLat","rMinLng","rMaxLng","FindMarkersBoundsInArea","ComputeGlobalBounds","GetMarkers","GetPopulation","ResetClusters","PruneClusterForLeaflet","L","Layer","Class","extend","initialize","clusterMargin","_map","project","LatLng","getZoom","unproject","_objectsOnMap","spiderfier","PruneClusterLeafletSpiderfier","_hardMove","_resetIcons","_removeTimeoutId","_markersRemoveListTimeout","BuildLeafletCluster","m","icon","BuildLeafletClusterIcon","_leafletClusterBounds","on","cbounds","markersArea","LatLngBounds","zoomLevelBefore","zoomLevelAfter","getBoundsZoom","filteredBounds","_leafletMarker","newMarkersArea","markerPos","isFiltered","currentFilteredBounds","getMaxZoom","fire","center","getLatLng","setView","fitBounds","c","iconSize","maxPopulation","DivIcon","html","point","BuildLeafletMarker","PrepareLeafletMarker","setIcon","popup","content","getPopup","setPopupContent","popupOptions","bindPopup","onAdd","_moveStart","_moveEnd","_zoomStart","_zoomEnd","addLayer","onRemove","off","removeLayer","_moveInProgress","hard","_zoomInProgress","getBounds","zoom","marginRatio","resetIcons","southWest","getSouthWest","northEast","getNorthEast","objectsOnMap","newObjectsOnMap","markersOnMap","_removeFromMap","clusterCreationList","clusterCreationListPopOne","opacityUpdateList","workingList","icluster","iclusterData","latMargin","lngMargin","oldMaxLng","oldMinLat","oldMaxLat","newMinLng","newMinLat","newMaxLat","_leafletCollision","_leafletOldPopulation","_leafletOldHashCode","oldMarker","_hashCode","_zoomLevel","forceIconRedraw","setLatLng","_leafletPosition","equals","boundsCopy","Util","_population","idata","remove","pa","jcluster","jdata","pb","oldMinLng","newMaxLng","poisson","console","error","creationMarker","iposition","addTo","setOpacity","setTimeout","_icon","DomUtil","addClass","_shadow","clearTimeout","toRemove","FitBounds","RedrawIcons","processView","_2PI","PI","_circleFootSeparation","_circleStartAngle","_spiralFootSeparation","_spiralLengthStart","_spiralLengthFactor","_spiralCountTrigger","spiderfyDistanceMultiplier","_cluster","_currentMarkers","_multiLines","multiPolyline","_lines","polyline","Spiderfy","Unspiderfy","_currentCenter","points","centerPoint","latLngToLayerPoint","_generatePointsSpiral","_generatePointsCircle","polylines","leafletMarkers","projectedPoints","layerPointToLatLng","setZIndexOffset","startTime","Date","anim","stepRatio","diffLat","diffLng","setLatLngs","_clusterMarker","centerPt","angle","legLength","angleStep","res","round","cos","sin","separation","lengthFactor","MapboxLoader","lazy","MainMapMapbox","docs","isGeoChooser","middleMarkerDoc","currentStyleURL","clusterGroup","defaultClusterSize","mapbox_markers","mapbox_markersOnScreen","filters","leaflet_map","borderGotLoaded","prune_markers","undecidedPlaces","loadedMapbox","gotMapRefLeaflet","syncViewport","addMarkersToPruneCluster","filterMarkers","showAllMarkers","showAllMarkersButMiddleMarker","viewportChanged","zoomIn","zoomOut","loadMarkers","loadUndecidedPlaces","filtersChanged","conic_gradient","updateMarkers","forceRedraw","onFunctions","functions","getMapType","setPadding","setZoom","getCenter","flyToBounds","jumpTo","panBy","panTo","flyTo","invalidateSize","latLngToContainerPoint","useAsGeoChooser","refetchMarkers","mainMapFunctions","addEventListener","setMapPos","mapViewport","store","get","newStyleURL","getStyleUrl","setStyle","removeEventListener","markerQuerySubscription","unsubscribe","graphql","query","fetchPolicy","query_markers","variables","languages","navigator","event","map_center","yesOrNo","setGlobalMapCenter","watchQuery","subscribe","JSON","parse","stringify","doc","___preset","preset","default","___color","getColorByPreset","colorsByPreset","colors","query_undecidedPlaces","_id","borders_path","fetch","borders_response","json","borders","getStatusColor","status","success","main","warning","features","feature","country_code","getCountryCode","properties","ilga","getILGA","overview","statusNumber","geometry","addSource","layers","getStyle","firstSymbolId","layer","getLayer","element","Map","getInitCenter","zoomSnap","zoomAnimation","fadeAnimation","markerZoomAnimation","scrollWheelZoom","minZoom","maxZoom","ref","mapboxgl","container","LngLat","bearing","pitch","hash","refreshExpiredTiles","bearingSnap","pitchWithRotate","dragPan","dragRotate","touchZoomRotate","touchPitch","scrollZoom","boxZoom","doubleClickZoom","currentMapboxStylesheetID","newMapboxStylesheetID","stylesheet","_loaded","localizeTheMap","getBearing","getPitch","language","layerIDs","layout","flat","includes","layerID","setLayoutProperty","options","newMarkers","createPoiMarker","createClusterMarker","setLngLat","document","classList","cursor","navigate","innerHTML","toLowerCase","getTranslationFromArray","entries","reduce","obj","preset_key","colors_sum","sum","pair","gradient","dataURL","padding","isSmallScreen","top","right","bottom","left","sidebarIsOpen","duration","values","stops","counter","currentPos","gapColor","ceil","join","repeating","updateMarkersAfterPruneClusterUpdate","middleMarkerID","showBorders","hideBorders","presets_length","checkAudienceQueerOptions","publishedFilter","tags","hasUndecidedChangesets","isInPresets","startsWith","bool","matchesAudienceQueer","isInAgeRange","min_age","max_age","parsedMin","parseFloat","parsedMax","isNaN","viewport","mapCenter","mapZoom","set","dispatchEvent","Event","animate","onFiltersChanged","mapIsResizing","pointerEvents","minHeight","borderRadius","marginBottom","target","rel","href","src","mapbox_logo_darkmode","mapbox_logo_lightmode","alt","classes","mapbox_logo","renderLazyLoader","onLoad","withConicGradient","forwardRef","ConicGradientProps","Main","SearchBar","Sidebar","MainDrawerContent","defaultTheme","createMuiTheme","primary","secondary","action","active","paper","tonalOffset","HandlePath","docID","onPathChanged","App","searchBarValue","prefersDarkMode","isMainDrawerOpen","setSearchBarValue","setSidebarIsOpen","setTheme","check_color_scheme","check_small_screen","dontFilterTheseIds","closeMainDrawer","toggleMainDrawer","closeSidebar","matchMedia","matcher_color_scheme","addListener","matcher_small_screen","removeListener","background_paper","background_default","secondary_main","error_main","typography","fontFamily","h1","fontSize","fontWeight","letterSpacing","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","button","caption","overline","shape","transitions","complex","enteringScreen","leavingScreen","short","shorter","shortest","standard","easing","easeIn","easeInOut","easeOut","sharp","overrides","MuiInputLabel","textOverflow","overflow","whiteSpace","MuiLink","root","MuiFab","backgroundColor","getContrastText","transition","opacity","matches","componentName","functionsObject","newFilters","pathVars","ThemeProvider","StylesProvider","injectFirst","path","Drawer","open","onClose","display","onSetSidebarIsOpen","onSetSearchBarValue","onDontFilterTheseIds","onSetView","onFlyTo","onGetZoom","attr","saveFunctions","ReactDOM","render","Globals","getElementById","_supportedLocales_","fetchMessages","locale","response","text","messages","FluentResource","getDefaultBundles","bundle","FluentBundle","addResource","ReactLocalization","createMessagesGenerator","currentLocales","all","fetched","cur","assign","generateBundles","f","AppLocalizationProvider","bundles","negotiateLanguages","defaultLocale","privacy_level_keys","essentials","tracking","storage_functions","privacy_level_key","setPrivacy","reject","getPrivacy","isDevEnvironment","local_ip","getCookie","match","cookie","RegExp","cache","InMemoryCache","persistCache","storage","localStorage","globalState","__session","ApolloClient","link","HttpLink","credentials","headers","uri","query_whoami","whoami","catch","finally","globalStateFinishedLoading","GlobalsContext","createContext","GlobalsProvider","pageOpenTS","cookieOptions","maxAge","domain","secure","loadedCountries","country_by_iso_a2","country_by_iso_a3","saved_country_callbacks","loadCountries","getCountryByAlpha2","getCountryByAlpha3","convert_alpha3_to_alpha2","convert_alpha2_to_alpha3","getCountryByCode","getInitialGlobalState","saved_country_callback","query_countries","wantedTags","countries","country_key_a2","toUpperCase","country_key_a3","alpha2","alpha3","countryDoc","iso_a3","Provider","ComponentWrapped","withLocalStorage","addressFormats","address_formats","item","format","uuidv4","replace","crypto","getRandomValues","Uint8Array","toString","texts","texts_array","isArray","text_object","attrs","colorsByPreset_sorted","addAddressFormatDefaults","addressFormat","widths","housenumber","street","unit","city","postcode","getAddressFormatDefault","countryCodes","getAddressFormatByCountryCode","countryCode","showAllFields","addressFormat2return","alreadInUseKeys","keys2add","getAddressFormatByTags","addr_keys","lastMatchCount","lastAddressFormat","thisMatchCount","getAddressFormatBySubkeys","split","alpha3code","TR","ilga_dataset","legality_key","gender_key","criminalisation","description","penalty","penalty_keys","years","protection","protection_keys","recognition","recognition_keys","getStatusNumber","ISO_A3","ISO_A3_EH","ADM0_A3","gql","place","search","questions","countrycode","addChangeset","addEdge","undecidedTags","recompile"],"mappings":"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","file":"static/js/main.ab993b80.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"mapbox_logo\":\"MainMapMapbox_mapbox_logo__2n7ow\"};","module.exports = __webpack_public_path__ + \"static/media/mapbox-logo-black.bd026264.svg\";","module.exports = __webpack_public_path__ + \"static/media/mapbox-logo-white.a77f8ced.svg\";","var map = {\n\t\"./ar.ftl\": [\n\t\t209,\n\t\t13\n\t],\n\t\"./de.ftl\": [\n\t\t210,\n\t\t14\n\t],\n\t\"./en.ftl\": [\n\t\t211,\n\t\t15\n\t],\n\t\"./en_GB.ftl\": [\n\t\t212,\n\t\t16\n\t],\n\t\"./en_US.ftl\": [\n\t\t213,\n\t\t17\n\t],\n\t\"./es.ftl\": [\n\t\t214,\n\t\t18\n\t],\n\t\"./fil.ftl\": [\n\t\t215,\n\t\t19\n\t],\n\t\"./fr.ftl\": [\n\t\t216,\n\t\t20\n\t],\n\t\"./it.ftl\": [\n\t\t217,\n\t\t21\n\t],\n\t\"./ja.ftl\": [\n\t\t218,\n\t\t22\n\t],\n\t\"./ko.ftl\": [\n\t\t219,\n\t\t23\n\t],\n\t\"./pt.ftl\": [\n\t\t220,\n\t\t24\n\t],\n\t\"./ru.ftl\": [\n\t\t221,\n\t\t25\n\t],\n\t\"./vi.ftl\": [\n\t\t222,\n\t\t26\n\t],\n\t\"./zh-Hans.ftl\": [\n\t\t223,\n\t\t27\n\t],\n\t\"./zh-Hant.ftl\": [\n\t\t224,\n\t\t28\n\t]\n};\nfunction webpackAsyncContext(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\treturn Promise.resolve().then(function() {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t});\n\t}\n\n\tvar ids = map[req], id = ids[0];\n\treturn __webpack_require__.e(ids[1]).then(function() {\n\t\treturn __webpack_require__.t(id, 7);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 175;\nmodule.exports = webpackAsyncContext;","import React from 'react'\nimport {\n\tLocalized as LocalizedOriginal,\n\t// withLocalization,\n} from '@fluent/react'\n\nimport { FluentContext } from '../../../node_modules/@fluent/react/esm/context.js'\n\nconst Localized = props => (\n\t<LocalizedOriginal\n\t\tkey={props.id}\n\t\t{...props}\n\t\telems={{\n\t\t\tbr: <br />,\n\t\t\t...props.elems,\n\t\t}}\n\t>\n\t\t<React.Fragment>{props.children}</React.Fragment>\n\t</LocalizedOriginal>\n)\n\n// A custom withLocalization to have an empty fallback.\n// It is nearly identical to the original.\nfunction withLocalization(Inner) {\n    function WithLocalization(props) {\n        const l10n = React.useContext(FluentContext)\n\n        const getString = (id, args, fallback) => l10n.getString(id, args, fallback || ' ')\n\n        return React.createElement(Inner, { getString, ...props })\n    }\n    return WithLocalization\n}\n\nexport {\n\twithLocalization,\n\tLocalized,\n\tLocalized as default,\n}\n\n/*\n\nimport { Localized, withLocalization } from '../Localized/'\n\n<Localized id=\"translation_id\" />\nexport default withLocalization(componentName)\n\n\nimport Localized from '../Localized/'\n<Localized id=\"translation_id\" />\n\nimport { withLocalization } from '@fluent/react'\nexport default withLocalization(componentName)\n\n*/","import React, { useState, useEffect, useRef, useCallback } from 'react'\n\nfunction useInterval(callback, delay) {\n\t// source: https://overreacted.io/making-setinterval-declarative-with-react-hooks/\n  const savedCallback = useRef()\n\n  // Remember the latest callback.\n  useEffect(() => {\n    savedCallback.current = callback\n  }, [callback])\n\n  // Set up the interval.\n  useEffect(() => {\n    function tick() {\n      savedCallback.current()\n    }\n    if (delay !== null) {\n      let id = setInterval(tick, delay)\n      return () => clearInterval(id)\n    }\n  }, [delay])\n}\n\nfunction useConicGradient() {\n\tconst waitingForConicGradient = useRef([])\n\tconst [isRunning, setIsRunning] = useState(false)\n\tconst [conicGradientExists, setConicGradientExists] = useState(false)\n\n\tconst onReady = useCallback(function(callback){\n\t\tif (!!callback) {\n\t\t\tif (conicGradientExists) {\n\t\t\t\tcallback()\n\t\t\t}else{\n\t\t\t\twaitingForConicGradient.current.push(callback)\n\t\t\t}\n\t\t}\n\t}, [conicGradientExists])\n\n\tconst getConicGradient = useCallback(function(){\n\t\tif (conicGradientExists) {\n\t\t\treturn window.ConicGradient\n\t\t}else{\n\t\t\treturn null\n\t\t}\n\t}, [conicGradientExists])\n\n\tuseEffect(function(){\n\t\tsetIsRunning(true)\n\t}, [])\n\n\tuseInterval(function(){\n\t\tif (!!window.ConicGradient) {\n\t\t\tsetIsRunning(false)\n\t\t\tsetConicGradientExists(true)\n\n\t\t\tfor (const callback of waitingForConicGradient.current) {\n\t\t\t\tcallback()\n\t\t\t}\n\t\t\twaitingForConicGradient.current = []\n\t\t}\n\t}, isRunning ? 10 : null)\n\n\treturn {\n\t\tonReady,\n\t\tgetConicGradient,\n\t}\n}\n\nfunction withConicGradient(Component) {\t\n\treturn React.forwardRef(function(props, ref){\n\t\tconst ConicGradientProps = useConicGradient()\n\t\treturn <Component conic_gradient={ConicGradientProps} ref={ref} {...props} />\n\t})\n}\n\nexport { withConicGradient }\n\n\n","/* eslint-disable */\n\nimport L from 'leaflet'\n\nvar __extends = (this && this.__extends) || (function() {\n  var extendStatics = Object.setPrototypeOf ||\n    ({\n        __proto__: []\n      }\n      instanceof Array && function(d, b) {\n        d.__proto__ = b;\n      }) ||\n    function(d, b) {\n      for (var p in b)\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n  return function(d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n})();\nvar PruneCluster;\n(function(PruneCluster_1) {\n  var Point = (function() {\n    function Point() {}\n    return Point;\n  }());\n  PruneCluster_1.Point = Point;\n  var ClusterObject = (function() {\n    function ClusterObject() {}\n    return ClusterObject;\n  }());\n  PruneCluster_1.ClusterObject = ClusterObject;\n  var hashCodeCounter = 1;\n  var maxHashCodeValue = Math.pow(2, 53) - 1;\n  var Marker = (function(_super) {\n    __extends(Marker, _super);\n\n    function Marker(lat, lng, data, category, weight, filtered) {\n      if (data === void 0) {\n        data = {};\n      }\n      if (weight === void 0) {\n        weight = 1;\n      }\n      if (filtered === void 0) {\n        filtered = false;\n      }\n      var _this = _super.call(this) || this;\n      _this.data = data;\n      _this.position = {\n        lat: +lat,\n        lng: +lng\n      };\n      _this.weight = weight;\n      _this.category = category;\n      _this.filtered = filtered;\n      _this.hashCode = hashCodeCounter++;\n      return _this;\n    }\n    Marker.prototype.Move = function(lat, lng) {\n      this.position.lat = +lat;\n      this.position.lng = +lng;\n    };\n    Marker.prototype.SetData = function(data) {\n      for (var key in data) {\n        this.data[key] = data[key];\n      }\n    };\n    return Marker;\n  }(ClusterObject));\n  PruneCluster_1.Marker = Marker;\n  var Cluster = (function(_super) {\n    __extends(Cluster, _super);\n\n    function Cluster(marker) {\n      var _this = _super.call(this) || this;\n      _this.stats = [0, 0, 0, 0, 0, 0, 0, 0];\n      _this.data = {};\n      if (!marker) {\n        _this.hashCode = 1;\n        if (Cluster.ENABLE_MARKERS_LIST) {\n          _this._clusterMarkers = [];\n        }\n        return _this;\n      }\n      if (Cluster.ENABLE_MARKERS_LIST) {\n        _this._clusterMarkers = [marker];\n      }\n      _this.lastMarker = marker;\n      _this.hashCode = 31 + marker.hashCode;\n      _this.population = 1;\n      if (marker.category !== undefined) {\n        _this.stats[marker.category] = 1;\n      }\n      _this.totalWeight = marker.weight;\n      _this.position = {\n        lat: marker.position.lat,\n        lng: marker.position.lng\n      };\n      _this.averagePosition = {\n        lat: marker.position.lat,\n        lng: marker.position.lng\n      };\n      return _this;\n    }\n    Cluster.prototype.AddMarker = function(marker) {\n      if (Cluster.ENABLE_MARKERS_LIST) {\n        this._clusterMarkers.push(marker);\n      }\n      var h = this.hashCode;\n      h = ((h << 5) - h) + marker.hashCode;\n      if (h >= maxHashCodeValue) {\n        this.hashCode = h % maxHashCodeValue;\n      } else {\n        this.hashCode = h;\n      }\n      this.lastMarker = marker;\n      var weight = marker.weight,\n        currentTotalWeight = this.totalWeight,\n        newWeight = weight + currentTotalWeight;\n      this.averagePosition.lat =\n        (this.averagePosition.lat * currentTotalWeight +\n          marker.position.lat * weight) / newWeight;\n      this.averagePosition.lng =\n        (this.averagePosition.lng * currentTotalWeight +\n          marker.position.lng * weight) / newWeight;\n      ++this.population;\n      this.totalWeight = newWeight;\n      if (marker.category !== undefined) {\n        this.stats[marker.category] = (this.stats[marker.category] + 1) || 1;\n      }\n    };\n    Cluster.prototype.Reset = function() {\n      this.hashCode = 1;\n      this.lastMarker = undefined;\n      this.population = 0;\n      this.totalWeight = 0;\n      this.stats = [0, 0, 0, 0, 0, 0, 0, 0];\n      if (Cluster.ENABLE_MARKERS_LIST) {\n        this._clusterMarkers = [];\n      }\n    };\n    Cluster.prototype.ComputeBounds = function(cluster) {\n      var proj = cluster.Project(this.position.lat, this.position.lng);\n      var size = cluster.Size;\n      var nbX = Math.floor(proj.x / size),\n        nbY = Math.floor(proj.y / size),\n        startX = nbX * size,\n        startY = nbY * size;\n      var a = cluster.UnProject(startX, startY),\n        b = cluster.UnProject(startX + size, startY + size);\n      this.bounds = {\n        minLat: b.lat,\n        maxLat: a.lat,\n        minLng: a.lng,\n        maxLng: b.lng\n      };\n    };\n    Cluster.prototype.GetClusterMarkers = function() {\n      return this._clusterMarkers;\n    };\n    Cluster.prototype.ApplyCluster = function(newCluster) {\n      this.hashCode = this.hashCode * 41 + newCluster.hashCode * 43;\n      if (this.hashCode > maxHashCodeValue) {\n        this.hashCode = this.hashCode = maxHashCodeValue;\n      }\n      var weight = newCluster.totalWeight,\n        currentTotalWeight = this.totalWeight,\n        newWeight = weight + currentTotalWeight;\n      this.averagePosition.lat =\n        (this.averagePosition.lat * currentTotalWeight +\n          newCluster.averagePosition.lat * weight) / newWeight;\n      this.averagePosition.lng =\n        (this.averagePosition.lng * currentTotalWeight +\n          newCluster.averagePosition.lng * weight) / newWeight;\n      this.population += newCluster.population;\n      this.totalWeight = newWeight;\n      this.bounds.minLat = Math.min(this.bounds.minLat, newCluster.bounds.minLat);\n      this.bounds.minLng = Math.min(this.bounds.minLng, newCluster.bounds.minLng);\n      this.bounds.maxLat = Math.max(this.bounds.maxLat, newCluster.bounds.maxLat);\n      this.bounds.maxLng = Math.max(this.bounds.maxLng, newCluster.bounds.maxLng);\n      for (var category in newCluster.stats) {\n        if (newCluster.stats.hasOwnProperty(category)) {\n          if (this.stats.hasOwnProperty(category)) {\n            this.stats[category] += newCluster.stats[category];\n          } else {\n            this.stats[category] = newCluster.stats[category];\n          }\n        }\n      }\n      if (Cluster.ENABLE_MARKERS_LIST) {\n        this._clusterMarkers = this._clusterMarkers.concat(newCluster.GetClusterMarkers());\n      }\n    };\n    Cluster.ENABLE_MARKERS_LIST = false;\n    return Cluster;\n  }(ClusterObject));\n  PruneCluster_1.Cluster = Cluster;\n\n  function checkPositionInsideBounds(a, b) {\n    return (a.lat >= b.minLat && a.lat <= b.maxLat) &&\n      a.lng >= b.minLng && a.lng <= b.maxLng;\n  }\n\n  function insertionSort(list) {\n    for (var i = 1, j, tmp, tmpLng, length = list.length; i < length; ++i) {\n      tmp = list[i];\n      tmpLng = tmp.position.lng;\n      for (j = i - 1; j >= 0 && list[j].position.lng > tmpLng; --j) {\n        list[j + 1] = list[j];\n      }\n      list[j + 1] = tmp;\n    }\n  }\n\n  function shouldUseInsertionSort(total, nbChanges) {\n    if (nbChanges > 300) {\n      return false;\n    } else {\n      return (nbChanges / total) < 0.2;\n    }\n  }\n  var PruneCluster = (function() {\n    function PruneCluster() {\n      this._markers = [];\n      this._nbChanges = 0;\n      this._clusters = [];\n      this.Size = 166;\n      this.ViewPadding = 0.2;\n    }\n    PruneCluster.prototype.RegisterMarker = function(marker) {\n      if (marker._removeFlag) {\n        delete marker._removeFlag;\n      }\n      this._markers.push(marker);\n      this._nbChanges += 1;\n    };\n    PruneCluster.prototype.RegisterMarkers = function(markers) {\n      var _this = this;\n      markers.forEach(function(marker) {\n        _this.RegisterMarker(marker);\n      });\n    };\n    PruneCluster.prototype._sortMarkers = function() {\n      var markers = this._markers,\n        length = markers.length;\n      if (this._nbChanges && !shouldUseInsertionSort(length, this._nbChanges)) {\n        this._markers.sort(function(a, b) {\n          return a.position.lng - b.position.lng;\n        });\n      } else {\n        insertionSort(markers);\n      }\n      this._nbChanges = 0;\n    };\n    PruneCluster.prototype._sortClusters = function() {\n      insertionSort(this._clusters);\n    };\n    PruneCluster.prototype._indexLowerBoundLng = function(lng) {\n      var markers = this._markers,\n        it, step, first = 0,\n        count = markers.length;\n      while (count > 0) {\n        step = Math.floor(count / 2);\n        it = first + step;\n        if (markers[it].position.lng < lng) {\n          first = ++it;\n          count -= step + 1;\n        } else {\n          count = step;\n        }\n      }\n      return first;\n    };\n    PruneCluster.prototype._resetClusterViews = function() {\n      for (var i = 0, l = this._clusters.length; i < l; ++i) {\n        var cluster = this._clusters[i];\n        cluster.Reset();\n        cluster.ComputeBounds(this);\n      }\n    };\n    PruneCluster.prototype.ProcessView = function(bounds) {\n      var heightBuffer = Math.abs(bounds.maxLat - bounds.minLat) * this.ViewPadding,\n        widthBuffer = Math.abs(bounds.maxLng - bounds.minLng) * this.ViewPadding;\n      var extendedBounds = {\n        minLat: bounds.minLat - heightBuffer - heightBuffer,\n        maxLat: bounds.maxLat + heightBuffer + heightBuffer,\n        minLng: bounds.minLng - widthBuffer - widthBuffer,\n        maxLng: bounds.maxLng + widthBuffer + widthBuffer\n      };\n      this._sortMarkers();\n      this._resetClusterViews();\n      var firstIndex = this._indexLowerBoundLng(extendedBounds.minLng);\n      var markers = this._markers,\n        clusters = this._clusters;\n      var workingClusterList = clusters.slice(0);\n      for (var i = firstIndex, l = markers.length; i < l; ++i) {\n        var marker = markers[i],\n          markerPosition = marker.position;\n        if (markerPosition.lng > extendedBounds.maxLng) {\n          break;\n        }\n        if (markerPosition.lat > extendedBounds.minLat &&\n          markerPosition.lat < extendedBounds.maxLat &&\n          !marker.filtered) {\n          var clusterFound = false,\n            cluster;\n          for (var j = 0, ll = workingClusterList.length; j < ll; ++j) {\n            cluster = workingClusterList[j];\n            if (cluster.bounds.maxLng < marker.position.lng) {\n              workingClusterList.splice(j, 1);\n              --j;\n              --ll;\n              continue;\n            }\n            if (checkPositionInsideBounds(markerPosition, cluster.bounds)) {\n              cluster.AddMarker(marker);\n              clusterFound = true;\n              break;\n            }\n          }\n          if (!clusterFound) {\n            cluster = new Cluster(marker);\n            cluster.ComputeBounds(this);\n            clusters.push(cluster);\n            workingClusterList.push(cluster);\n          }\n        }\n      }\n      var newClustersList = [];\n      for (i = 0, l = clusters.length; i < l; ++i) {\n        cluster = clusters[i];\n        if (cluster.population > 0) {\n          newClustersList.push(cluster);\n        }\n      }\n      this._clusters = newClustersList;\n      this._sortClusters();\n      return this._clusters;\n    };\n    PruneCluster.prototype.RemoveMarkers = function(markers) {\n      if (!markers) {\n        this._markers = [];\n        return;\n      }\n      for (var i = 0, l = markers.length; i < l; ++i) {\n        markers[i]._removeFlag = true;\n      }\n      var newMarkersList = [];\n      for (i = 0, l = this._markers.length; i < l; ++i) {\n        if (!this._markers[i]._removeFlag) {\n          newMarkersList.push(this._markers[i]);\n        } else {\n          delete this._markers[i]._removeFlag;\n        }\n      }\n      this._markers = newMarkersList;\n    };\n    PruneCluster.prototype.FindMarkersInArea = function(area) {\n      var aMinLat = area.minLat,\n        aMaxLat = area.maxLat,\n        aMinLng = area.minLng,\n        aMaxLng = area.maxLng,\n        markers = this._markers,\n        result = [];\n      var firstIndex = this._indexLowerBoundLng(aMinLng);\n      for (var i = firstIndex, l = markers.length; i < l; ++i) {\n        var pos = markers[i].position;\n        if (pos.lng > aMaxLng) {\n          break;\n        }\n        if (pos.lat >= aMinLat && pos.lat <= aMaxLat &&\n          pos.lng >= aMinLng) {\n          result.push(markers[i]);\n        }\n      }\n      return result;\n    };\n    PruneCluster.prototype.ComputeBounds = function(markers, withFiltered) {\n      if (withFiltered === void 0) {\n        withFiltered = true;\n      }\n      if (!markers || !markers.length) {\n        return null;\n      }\n      var rMinLat = Number.MAX_VALUE,\n        rMaxLat = -Number.MAX_VALUE,\n        rMinLng = Number.MAX_VALUE,\n        rMaxLng = -Number.MAX_VALUE;\n      for (var i = 0, l = markers.length; i < l; ++i) {\n        if (!withFiltered && markers[i].filtered) {\n          continue;\n        }\n        var pos = markers[i].position;\n        if (pos.lat < rMinLat)\n          rMinLat = pos.lat;\n        if (pos.lat > rMaxLat)\n          rMaxLat = pos.lat;\n        if (pos.lng < rMinLng)\n          rMinLng = pos.lng;\n        if (pos.lng > rMaxLng)\n          rMaxLng = pos.lng;\n      }\n      return {\n        minLat: rMinLat,\n        maxLat: rMaxLat,\n        minLng: rMinLng,\n        maxLng: rMaxLng\n      };\n    };\n    PruneCluster.prototype.FindMarkersBoundsInArea = function(area) {\n      return this.ComputeBounds(this.FindMarkersInArea(area));\n    };\n    PruneCluster.prototype.ComputeGlobalBounds = function(withFiltered) {\n      if (withFiltered === void 0) {\n        withFiltered = true;\n      }\n      return this.ComputeBounds(this._markers, withFiltered);\n    };\n    PruneCluster.prototype.GetMarkers = function() {\n      return this._markers;\n    };\n    PruneCluster.prototype.GetPopulation = function() {\n      return this._markers.length;\n    };\n    PruneCluster.prototype.ResetClusters = function() {\n      this._clusters = [];\n    };\n    return PruneCluster;\n  }());\n  PruneCluster_1.PruneCluster = PruneCluster;\n})(PruneCluster || (PruneCluster = {}));\nexport var PruneCluster;\n(function(PruneCluster) {})(PruneCluster || (PruneCluster = {}));\nexport var PruneClusterForLeaflet = (L.Layer ? L.Layer : L.Class).extend({\n  initialize: function(size, clusterMargin) {\n    var _this = this;\n    if (size === void 0) {\n      size = 120;\n    }\n    if (clusterMargin === void 0) {\n      clusterMargin = 20;\n    }\n    this.Cluster = new PruneCluster.PruneCluster();\n    this.Cluster.Size = size;\n    this.clusterMargin = Math.min(clusterMargin, size / 4);\n    this.Cluster.Project = function(lat, lng) {\n      return _this._map.project(new L.LatLng(lat, lng), Math.floor(_this._map.getZoom()));\n    };\n    this.Cluster.UnProject = function(x, y) {\n      return _this._map.unproject(new L.Point(x, y), Math.floor(_this._map.getZoom()));\n    };\n    this._objectsOnMap = [];\n    this.spiderfier = new PruneClusterLeafletSpiderfier(this);\n    this._hardMove = false;\n    this._resetIcons = false;\n    this._removeTimeoutId = 0;\n    this._markersRemoveListTimeout = [];\n  },\n  RegisterMarker: function(marker) {\n    this.Cluster.RegisterMarker(marker);\n  },\n  RegisterMarkers: function(markers) {\n    this.Cluster.RegisterMarkers(markers);\n  },\n  RemoveMarkers: function(markers) {\n    this.Cluster.RemoveMarkers(markers);\n  },\n  BuildLeafletCluster: function(cluster, position) {\n    var _this = this;\n    var m = new L.Marker(position, {\n      icon: this.BuildLeafletClusterIcon(cluster)\n    });\n    m._leafletClusterBounds = cluster.bounds;\n    m.on('click', function() {\n      var cbounds = m._leafletClusterBounds;\n      var markersArea = _this.Cluster.FindMarkersInArea(cbounds);\n      var b = _this.Cluster.ComputeBounds(markersArea);\n      if (b) {\n        var bounds = new L.LatLngBounds(new L.LatLng(b.minLat, b.maxLng), new L.LatLng(b.maxLat, b.minLng));\n        var zoomLevelBefore = _this._map.getZoom(),\n          zoomLevelAfter = _this._map.getBoundsZoom(bounds, false, new L.Point(20, 20));\n        if (zoomLevelAfter === zoomLevelBefore) {\n          var filteredBounds = [];\n          for (var i = 0, l = _this._objectsOnMap.length; i < l; ++i) {\n            var o = _this._objectsOnMap[i];\n            if (o.data._leafletMarker !== m) {\n              if (o.bounds.minLat >= cbounds.minLat &&\n                o.bounds.maxLat <= cbounds.maxLat &&\n                o.bounds.minLng >= cbounds.minLng &&\n                o.bounds.maxLng <= cbounds.maxLng) {\n                filteredBounds.push(o.bounds);\n              }\n            }\n          }\n          if (filteredBounds.length > 0) {\n            var newMarkersArea = [];\n            var ll = filteredBounds.length;\n            for (i = 0, l = markersArea.length; i < l; ++i) {\n              var markerPos = markersArea[i].position;\n              var isFiltered = false;\n              for (var j = 0; j < ll; ++j) {\n                var currentFilteredBounds = filteredBounds[j];\n                if (markerPos.lat >= currentFilteredBounds.minLat &&\n                  markerPos.lat <= currentFilteredBounds.maxLat &&\n                  markerPos.lng >= currentFilteredBounds.minLng &&\n                  markerPos.lng <= currentFilteredBounds.maxLng) {\n                  isFiltered = true;\n                  break;\n                }\n              }\n              if (!isFiltered) {\n                newMarkersArea.push(markersArea[i]);\n              }\n            }\n            markersArea = newMarkersArea;\n          }\n          if (markersArea.length < 200 || zoomLevelAfter >= _this._map.getMaxZoom()) {\n            _this._map.fire('overlappingmarkers', {\n              cluster: _this,\n              markers: markersArea,\n              center: m.getLatLng(),\n              marker: m\n            });\n          } else {\n            zoomLevelAfter++;\n          }\n          _this._map.setView(m.getLatLng(), zoomLevelAfter);\n        } else {\n          _this._map.fitBounds(bounds);\n        }\n      }\n    });\n    return m;\n  },\n  BuildLeafletClusterIcon: function(cluster) {\n    var c = 'prunecluster prunecluster-';\n    var iconSize = 38;\n    var maxPopulation = this.Cluster.GetPopulation();\n    if (cluster.population < Math.max(10, maxPopulation * 0.01)) {\n      c += 'small';\n    } else if (cluster.population < Math.max(100, maxPopulation * 0.05)) {\n      c += 'medium';\n      iconSize = 40;\n    } else {\n      c += 'large';\n      iconSize = 44;\n    }\n    return new L.DivIcon({\n      html: \"<div><span>\" + cluster.population + \"</span></div>\",\n      className: c,\n      iconSize: L.point(iconSize, iconSize)\n    });\n  },\n  BuildLeafletMarker: function(marker, position) {\n    var m = new L.Marker(position);\n    this.PrepareLeafletMarker(m, marker.data, marker.category);\n    return m;\n  },\n  PrepareLeafletMarker: function(marker, data, category) {\n    if (data.icon) {\n      if (typeof data.icon === 'function') {\n        marker.setIcon(data.icon(data, category));\n      } else {\n        marker.setIcon(data.icon);\n      }\n    }\n    if (data.popup) {\n      var content = typeof data.popup === 'function' ? data.popup(data, category) : data.popup;\n      if (marker.getPopup()) {\n        marker.setPopupContent(content, data.popupOptions);\n      } else {\n        marker.bindPopup(content, data.popupOptions);\n      }\n    }\n  },\n  onAdd: function(map) {\n    this._map = map;\n    map.on('movestart', this._moveStart, this);\n    map.on('moveend', this._moveEnd, this);\n    map.on('zoomend', this._zoomStart, this);\n    map.on('zoomend', this._zoomEnd, this);\n    this.ProcessView();\n    map.addLayer(this.spiderfier);\n  },\n  onRemove: function(map) {\n    map.off('movestart', this._moveStart, this);\n    map.off('moveend', this._moveEnd, this);\n    map.off('zoomend', this._zoomStart, this);\n    map.off('zoomend', this._zoomEnd, this);\n    for (var i = 0, l = this._objectsOnMap.length; i < l; ++i) {\n      map.removeLayer(this._objectsOnMap[i].data._leafletMarker);\n    }\n    this._objectsOnMap = [];\n    this.Cluster.ResetClusters();\n    map.removeLayer(this.spiderfier);\n    this._map = null;\n  },\n  _moveStart: function() {\n    this._moveInProgress = true;\n  },\n  _moveEnd: function(e) {\n    this._moveInProgress = false;\n    this._hardMove = e.hard;\n    this.ProcessView();\n  },\n  _zoomStart: function() {\n    this._zoomInProgress = true;\n  },\n  _zoomEnd: function() {\n    this._zoomInProgress = false;\n    this.ProcessView();\n  },\n  ProcessView: function() {\n    var _this = this;\n    if (!this._map || this._zoomInProgress || this._moveInProgress) {\n      return;\n    }\n    var map = this._map,\n      bounds = map.getBounds(),\n      zoom = Math.floor(map.getZoom()),\n      marginRatio = this.clusterMargin / this.Cluster.Size,\n      resetIcons = this._resetIcons;\n    var southWest = bounds.getSouthWest(),\n      northEast = bounds.getNorthEast();\n    var clusters = this.Cluster.ProcessView({\n      minLat: southWest.lat,\n      minLng: southWest.lng,\n      maxLat: northEast.lat,\n      maxLng: northEast.lng\n    });\n    var objectsOnMap = this._objectsOnMap,\n      newObjectsOnMap = [],\n      markersOnMap = new Array(objectsOnMap.length);\n    for (var i = 0, l = objectsOnMap.length; i < l; ++i) {\n      var marker = objectsOnMap[i].data._leafletMarker;\n      markersOnMap[i] = marker;\n      marker._removeFromMap = true;\n    }\n    var clusterCreationList = [];\n    var clusterCreationListPopOne = [];\n    var opacityUpdateList = [];\n    var workingList = [];\n    for (i = 0, l = clusters.length; i < l; ++i) {\n      var icluster = clusters[i],\n        iclusterData = icluster.data;\n      var latMargin = (icluster.bounds.maxLat - icluster.bounds.minLat) * marginRatio,\n        lngMargin = (icluster.bounds.maxLng - icluster.bounds.minLng) * marginRatio;\n      for (var j = 0, ll = workingList.length; j < ll; ++j) {\n        var c = workingList[j];\n        if (c.bounds.maxLng < icluster.bounds.minLng) {\n          workingList.splice(j, 1);\n          --j;\n          --ll;\n          continue;\n        }\n        var oldMaxLng = c.averagePosition.lng + lngMargin,\n          oldMinLat = c.averagePosition.lat - latMargin,\n          oldMaxLat = c.averagePosition.lat + latMargin,\n          newMinLng = icluster.averagePosition.lng - lngMargin,\n          newMinLat = icluster.averagePosition.lat - latMargin,\n          newMaxLat = icluster.averagePosition.lat + latMargin;\n        if (oldMaxLng > newMinLng && oldMaxLat > newMinLat && oldMinLat < newMaxLat) {\n          iclusterData._leafletCollision = true;\n          c.ApplyCluster(icluster);\n          break;\n        }\n      }\n      if (!iclusterData._leafletCollision) {\n        workingList.push(icluster);\n      }\n    }\n    clusters.forEach(function(cluster) {\n      var m = undefined;\n      var data = cluster.data;\n      if (data._leafletCollision) {\n        data._leafletCollision = false;\n        data._leafletOldPopulation = 0;\n        data._leafletOldHashCode = 0;\n        return;\n      }\n      var position = new L.LatLng(cluster.averagePosition.lat, cluster.averagePosition.lng);\n      var oldMarker = data._leafletMarker;\n      if (oldMarker) {\n        if (cluster.population === 1 && data._leafletOldPopulation === 1 && cluster.hashCode === oldMarker._hashCode) {\n          if (resetIcons || oldMarker._zoomLevel !== zoom || cluster.lastMarker.data.forceIconRedraw) {\n            _this.PrepareLeafletMarker(oldMarker, cluster.lastMarker.data, cluster.lastMarker.category);\n            if (cluster.lastMarker.data.forceIconRedraw) {\n              cluster.lastMarker.data.forceIconRedraw = false;\n            }\n          }\n          oldMarker.setLatLng(position);\n          m = oldMarker;\n        } else if (cluster.population > 1 && data._leafletOldPopulation > 1 && (oldMarker._zoomLevel === zoom ||\n            data._leafletPosition.equals(position))) {\n          oldMarker.setLatLng(position);\n          if (resetIcons || cluster.population != data._leafletOldPopulation ||\n            cluster.hashCode !== data._leafletOldHashCode) {\n            var boundsCopy = {};\n            L.Util.extend(boundsCopy, cluster.bounds);\n            oldMarker._leafletClusterBounds = boundsCopy;\n            oldMarker.setIcon(_this.BuildLeafletClusterIcon(cluster));\n          }\n          data._leafletOldPopulation = cluster.population;\n          data._leafletOldHashCode = cluster.hashCode;\n          m = oldMarker;\n        }\n      }\n      if (!m) {\n        if (cluster.population === 1) {\n          clusterCreationListPopOne.push(cluster);\n        } else {\n          clusterCreationList.push(cluster);\n        }\n        data._leafletPosition = position;\n        data._leafletOldPopulation = cluster.population;\n        data._leafletOldHashCode = cluster.hashCode;\n      } else {\n        m._removeFromMap = false;\n        newObjectsOnMap.push(cluster);\n        m._zoomLevel = zoom;\n        m._hashCode = cluster.hashCode;\n        m._population = cluster.population;\n        data._leafletMarker = m;\n        data._leafletPosition = position;\n      }\n    });\n    clusterCreationList = clusterCreationListPopOne.concat(clusterCreationList);\n    for (i = 0, l = objectsOnMap.length; i < l; ++i) {\n      icluster = objectsOnMap[i];\n      var idata = icluster.data;\n      marker = idata._leafletMarker;\n      if (idata._leafletMarker._removeFromMap) {\n        var remove = true;\n        if (marker._zoomLevel === zoom) {\n          var pa = icluster.averagePosition;\n          latMargin = (icluster.bounds.maxLat - icluster.bounds.minLat) * marginRatio,\n            lngMargin = (icluster.bounds.maxLng - icluster.bounds.minLng) * marginRatio;\n          for (j = 0, ll = clusterCreationList.length; j < ll; ++j) {\n            var jcluster = clusterCreationList[j],\n              jdata = jcluster.data;\n            if (marker._population === 1 && jcluster.population === 1 &&\n              marker._hashCode === jcluster.hashCode) {\n              if (resetIcons || jcluster.lastMarker.data.forceIconRedraw) {\n                this.PrepareLeafletMarker(marker, jcluster.lastMarker.data, jcluster.lastMarker.category);\n                if (jcluster.lastMarker.data.forceIconRedraw) {\n                  jcluster.lastMarker.data.forceIconRedraw = false;\n                }\n              }\n              marker.setLatLng(jdata._leafletPosition);\n              remove = false;\n            } else {\n              var pb = jcluster.averagePosition;\n              var oldMinLng = pa.lng - lngMargin,\n                newMaxLng = pb.lng + lngMargin;\n              oldMaxLng = pa.lng + lngMargin;\n              oldMinLat = pa.lat - latMargin;\n              oldMaxLat = pa.lat + latMargin;\n              newMinLng = pb.lng - lngMargin;\n              newMinLat = pb.lat - latMargin;\n              newMaxLat = pb.lat + latMargin;\n              if ((marker._population > 1 && jcluster.population > 1) &&\n                (oldMaxLng > newMinLng && oldMinLng < newMaxLng && oldMaxLat > newMinLat && oldMinLat < newMaxLat)) {\n                marker.setLatLng(jdata._leafletPosition);\n                marker.setIcon(this.BuildLeafletClusterIcon(jcluster));\n                var poisson = {};\n                L.Util.extend(poisson, jcluster.bounds);\n                marker._leafletClusterBounds = poisson;\n                jdata._leafletOldPopulation = jcluster.population;\n                jdata._leafletOldHashCode = jcluster.hashCode;\n                marker._population = jcluster.population;\n                remove = false;\n              }\n            }\n            if (!remove) {\n              jdata._leafletMarker = marker;\n              marker._removeFromMap = false;\n              newObjectsOnMap.push(jcluster);\n              clusterCreationList.splice(j, 1);\n              --j;\n              --ll;\n              break;\n            }\n          }\n        }\n        if (remove) {\n          if (!marker._removeFromMap)\n            console.error(\"wtf\");\n        }\n      }\n    }\n    for (i = 0, l = clusterCreationList.length; i < l; ++i) {\n      icluster = clusterCreationList[i],\n        idata = icluster.data;\n      var iposition = idata._leafletPosition;\n      var creationMarker;\n      if (icluster.population === 1) {\n        creationMarker = this.BuildLeafletMarker(icluster.lastMarker, iposition);\n      } else {\n        creationMarker = this.BuildLeafletCluster(icluster, iposition);\n      }\n      creationMarker.addTo(map);\n      creationMarker.setOpacity(0);\n      opacityUpdateList.push(creationMarker);\n      idata._leafletMarker = creationMarker;\n      creationMarker._zoomLevel = zoom;\n      creationMarker._hashCode = icluster.hashCode;\n      creationMarker._population = icluster.population;\n      newObjectsOnMap.push(icluster);\n    }\n    window.setTimeout(function() {\n      for (i = 0, l = opacityUpdateList.length; i < l; ++i) {\n        var m = opacityUpdateList[i];\n        if (m._icon)\n          L.DomUtil.addClass(m._icon, \"prunecluster-anim\");\n        if (m._shadow)\n          L.DomUtil.addClass(m._shadow, \"prunecluster-anim\");\n        m.setOpacity(1);\n      }\n    }, 1);\n    if (this._hardMove) {\n      for (i = 0, l = markersOnMap.length; i < l; ++i) {\n        marker = markersOnMap[i];\n        if (marker._removeFromMap) {\n          map.removeLayer(marker);\n        }\n      }\n    } else {\n      if (this._removeTimeoutId !== 0) {\n        window.clearTimeout(this._removeTimeoutId);\n        for (i = 0, l = this._markersRemoveListTimeout.length; i < l; ++i) {\n          map.removeLayer(this._markersRemoveListTimeout[i]);\n        }\n      }\n      var toRemove = [];\n      for (i = 0, l = markersOnMap.length; i < l; ++i) {\n        marker = markersOnMap[i];\n        if (marker._removeFromMap) {\n          marker.setOpacity(0);\n          toRemove.push(marker);\n        }\n      }\n      if (toRemove.length > 0) {\n        this._removeTimeoutId = window.setTimeout(function() {\n          for (i = 0, l = toRemove.length; i < l; ++i) {\n            map.removeLayer(toRemove[i]);\n          }\n          _this._removeTimeoutId = 0;\n        }, 300);\n      }\n      this._markersRemoveListTimeout = toRemove;\n    }\n    this._objectsOnMap = newObjectsOnMap;\n    this._hardMove = false;\n    this._resetIcons = false;\n  },\n  FitBounds: function(withFiltered) {\n    if (withFiltered === void 0) {\n      withFiltered = true;\n    }\n    var bounds = this.Cluster.ComputeGlobalBounds(withFiltered);\n    if (bounds) {\n      this._map.fitBounds(new L.LatLngBounds(new L.LatLng(bounds.minLat, bounds.maxLng), new L.LatLng(bounds.maxLat, bounds.minLng)));\n    }\n  },\n  GetMarkers: function() {\n    return this.Cluster.GetMarkers();\n  },\n  RedrawIcons: function(processView) {\n    if (processView === void 0) {\n      processView = true;\n    }\n    this._resetIcons = true;\n    if (processView) {\n      this.ProcessView();\n    }\n  }\n});\nexport var PruneClusterLeafletSpiderfier = (L.Layer ? L.Layer : L.Class).extend({\n  _2PI: Math.PI * 2,\n  _circleFootSeparation: 25,\n  _circleStartAngle: Math.PI / 6,\n  _spiralFootSeparation: 28,\n  _spiralLengthStart: 11,\n  _spiralLengthFactor: 5,\n  _spiralCountTrigger: 8,\n  spiderfyDistanceMultiplier: 1,\n  initialize: function(cluster) {\n    this._cluster = cluster;\n    this._currentMarkers = [];\n    this._multiLines = !!L.multiPolyline;\n    this._lines = this._multiLines ?\n      L.multiPolyline([], {\n        weight: 1.5,\n        color: '#222'\n      }) :\n      L.polyline([], {\n        weight: 1.5,\n        color: '#222'\n      });\n  },\n  onAdd: function(map) {\n    this._map = map;\n    this._map.on('overlappingmarkers', this.Spiderfy, this);\n    this._map.on('click', this.Unspiderfy, this);\n    this._map.on('zoomend', this.Unspiderfy, this);\n  },\n  Spiderfy: function(data) {\n    var _this = this;\n    if (data.cluster !== this._cluster) {\n      return;\n    }\n    this.Unspiderfy();\n    var markers = data.markers.filter(function(marker) {\n      return !marker.filtered;\n    });\n    this._currentCenter = data.center;\n    var centerPoint = this._map.latLngToLayerPoint(data.center);\n    var points;\n    if (markers.length >= this._spiralCountTrigger) {\n      points = this._generatePointsSpiral(markers.length, centerPoint);\n    } else {\n      if (this._multiLines) {\n        centerPoint.y += 10;\n      }\n      points = this._generatePointsCircle(markers.length, centerPoint);\n    }\n    var polylines = [];\n    var leafletMarkers = [];\n    var projectedPoints = [];\n    for (var i = 0, l = points.length; i < l; ++i) {\n      var pos = this._map.layerPointToLatLng(points[i]);\n      var m = this._cluster.BuildLeafletMarker(markers[i], data.center);\n      m.setZIndexOffset(5000);\n      m.setOpacity(0);\n      this._currentMarkers.push(m);\n      this._map.addLayer(m);\n      leafletMarkers.push(m);\n      projectedPoints.push(pos);\n    }\n    window.setTimeout(function() {\n      for (i = 0, l = points.length; i < l; ++i) {\n        leafletMarkers[i].setLatLng(projectedPoints[i])\n          .setOpacity(1);\n      }\n      var startTime = +new Date();\n      var interval = 42,\n        duration = 290;\n      var anim = window.setInterval(function() {\n        polylines = [];\n        var now = +new Date();\n        var d = now - startTime;\n        if (d >= duration) {\n          window.clearInterval(anim);\n          stepRatio = 1.0;\n        } else {\n          var stepRatio = d / duration;\n        }\n        var center = data.center;\n        for (i = 0, l = points.length; i < l; ++i) {\n          var p = projectedPoints[i],\n            diffLat = p.lat - center.lat,\n            diffLng = p.lng - center.lng;\n          polylines.push([center, new L.LatLng(center.lat + diffLat * stepRatio, center.lng + diffLng * stepRatio)]);\n        }\n        _this._lines.setLatLngs(polylines);\n      }, interval);\n    }, 1);\n    this._lines.setLatLngs(polylines);\n    this._map.addLayer(this._lines);\n    if (data.marker) {\n      this._clusterMarker = data.marker.setOpacity(0.3);\n    }\n  },\n  _generatePointsCircle: function(count, centerPt) {\n    var circumference = this.spiderfyDistanceMultiplier * this._circleFootSeparation * (2 + count),\n      legLength = circumference / this._2PI,\n      angleStep = this._2PI / count,\n      res = [],\n      i, angle;\n    res.length = count;\n    for (i = count - 1; i >= 0; i--) {\n      angle = this._circleStartAngle + i * angleStep;\n      res[i] = new L.Point(Math.round(centerPt.x + legLength * Math.cos(angle)), Math.round(centerPt.y + legLength * Math.sin(angle)));\n    }\n    return res;\n  },\n  _generatePointsSpiral: function(count, centerPt) {\n    var legLength = this.spiderfyDistanceMultiplier * this._spiralLengthStart,\n      separation = this.spiderfyDistanceMultiplier * this._spiralFootSeparation,\n      lengthFactor = this.spiderfyDistanceMultiplier * this._spiralLengthFactor,\n      angle = 0,\n      res = [],\n      i;\n    res.length = count;\n    for (i = count - 1; i >= 0; i--) {\n      angle += separation / legLength + i * 0.0005;\n      res[i] = new L.Point(Math.round(centerPt.x + legLength * Math.cos(angle)), Math.round(centerPt.y + legLength * Math.sin(angle)));\n      legLength += this._2PI * lengthFactor / angle;\n    }\n    return res;\n  },\n  Unspiderfy: function() {\n    var _this = this;\n    for (var i = 0, l = this._currentMarkers.length; i < l; ++i) {\n      this._currentMarkers[i].setLatLng(this._currentCenter).setOpacity(0);\n    }\n    var markers = this._currentMarkers;\n    window.setTimeout(function() {\n      for (i = 0, l = markers.length; i < l; ++i) {\n        _this._map.removeLayer(markers[i]);\n      }\n    }, 300);\n    this._currentMarkers = [];\n    this._map.removeLayer(this._lines);\n    if (this._clusterMarker) {\n      this._clusterMarker.setOpacity(1);\n    }\n  },\n  onRemove: function(map) {\n    this.Unspiderfy();\n    map.off('overlappingmarkers', this.Spiderfy, this);\n    map.off('click', this.Unspiderfy, this);\n    map.off('zoomend', this.Unspiderfy, this);\n  }\n});\n\n\n// export PruneClusterForLeaflet\n\nexport default PruneCluster\n","import React from 'react'\nimport './index.css'\n\nimport { Localized, withLocalization } from '../Localized/'\n\nimport {\n\tFab,\n\tMenu,\n\tMenuItem,\n} from '@material-ui/core'\n\nimport {\n\tCheckCircleRounded as CheckIcon,\n\tArrowDropDownRounded as ArrowDropDownIcon,\n} from '@material-ui/icons'\nimport { withTheme } from '@material-ui/core/styles'\n\nimport PopupState, { bindTrigger, bindMenu } from 'material-ui-popup-state'\n\nimport { getTranslation } from '../../functions.js'\nimport _categories_ from '../../data/dist/categories.json'\n\nimport { withGlobals } from '../Globals/'\n\n// TODO: Add a filter for \"For any or all audience groups.\" (Trans, BPOC, Gay-Women, ...)\n\nclass FiltersPanelContent extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\n\t\tthis.state = {\n\t\t\tcategory: null,\n\t\t\tage: null,\n\t\t\taudience_queer: new Set(['only','primary','welcome']), // only primary welcome\n\t\t\tmustHaveUndecidedChangeset: false,\n\t\t\tpublished: true,\n\t\t}\n\n\t\tthis.categories = _categories_.map(category => ({\n\t\t\t...category,\n\t\t\tname_translated: getTranslation(category.name, this.props.globals.userLocales),\n\t\t}))\n\n\t\tthis.audience_queer_values = [\n\t\t\t{\n\t\t\t\tkey: 'everything',\n\t\t\t\ttranslation_key: 'menu_text_audience_queer_everything',\n\t\t\t\temoji: null,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'only',\n\t\t\t\ttranslation_key: 'menu_text_audience_queer_only',\n\t\t\t\temoji: this.props.globals.emojis.audience_queer_only,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'primary',\n\t\t\t\ttranslation_key: 'menu_text_audience_queer_primary',\n\t\t\t\temoji: this.props.globals.emojis.audience_queer_primary,\n\t\t\t},\n\t\t\t{\n\t\t\t\tkey: 'welcome',\n\t\t\t\ttranslation_key: 'menu_text_audience_queer_welcome',\n\t\t\t\temoji: this.props.globals.emojis.audience_queer_welcome,\n\t\t\t},\n\t\t]\n\n\t\tthis.ages = Array.apply(null, Array(15)).map((v,i)=>i+14)\n\t\tthis.highest_ages_entry = this.ages[this.ages.length-1]\n\n\t\tthis.setValue = this.setValue.bind(this)\n\t\tthis.getFilterObj = this.getFilterObj.bind(this)\n\t\tthis.toggleMustHaveUndecidedChangeset = this.toggleMustHaveUndecidedChangeset.bind(this)\n\t}\n\n\tcomponentDidMount(){\n\t\tif (this.props.onChange) {\n\t\t\tthis.props.onChange(this.getFilterObj())\n\t\t}\n\t}\n\n\tgetFilterObj(){\n\n\t\t// const tags = {}\n\t\t// if (!!this.state.age) {\n\t\t// \t// gte = Matches values that are greater than or equal to a specified value. #mongodb\n\t\t// \t// lte = Matches values that are less than or equal to a specified value. #mongodb\n\n\t\t// \tif (this.state.age === this.highest_ages_entry) {\n\t\t// \t\ttags.min_age = {gte: this.state.age}\n\t\t// \t\ttags.max_age = {lte: this.state.age}\n\t\t// \t}else{\t\t\t\t\n\t\t// \t\ttags.min_age = {gte: this.state.age}\n\t\t// \t\ttags.max_age = {lte: this.state.age}\n\t\t// \t}\n\t\t// }\n\n\t\treturn {\n\t\t\tpresets: (!!this.state.category ? this.state.category.presets : []),\n\t\t\t\n\t\t\taudienceQueerOptions: this.state.audience_queer.has('everything') ? [] : [...this.state.audience_queer],\n\t\t\tselectedAge: this.state.age,\n\t\t\tageOption: (this.state.age === this.highest_ages_entry ? 'open_end' : ''),\n\t\t\tmustHaveUndecidedChangeset: this.state.mustHaveUndecidedChangeset,\n\t\t\tpublished: this.state.published,\n\t\t}\n\t}\n\n\tsetValue(stateKeyName, value, closeMenuCallback){\n\t\tthis.setState({[stateKeyName]: (\n\t\t\t!!value || value === false\n\t\t\t? value\n\t\t\t: null\n\t\t)}, ()=>{\n\t\t\tif (typeof closeMenuCallback === 'function') {\n\t\t\t\tcloseMenuCallback()\n\t\t\t}\n\n\t\t\tif (this.props.onChange) {\n\t\t\t\tthis.props.onChange(this.getFilterObj())\n\t\t\t}\n\t\t})\n\t}\n\n\ttoogleAudienceQueer(audienceKey){\n\t\tthis.setState((state, props) => {\n\t\t\tlet audience_queer = state.audience_queer\n\n\t\t\tif (audienceKey === 'everything') {\n\t\t\t\tif (audience_queer.size === 0) {\n\t\t\t\t\taudience_queer = new Set(['only','primary','welcome'])\n\t\t\t\t}else{\n\t\t\t\t\taudience_queer = new Set()\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif (audience_queer.has(audienceKey)) {\n\t\t\t\t\taudience_queer.delete(audienceKey)\n\t\t\t\t}else{\n\t\t\t\t\taudience_queer.add(audienceKey)\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn {audience_queer}\n\t\t}, ()=>{\n\t\t\tif (this.props.onChange) {\n\t\t\t\tthis.props.onChange(this.getFilterObj())\n\t\t\t}\n\t\t})\n\t}\n\n\ttoggleMustHaveUndecidedChangeset(){\n\t\tthis.setState((state, props) => ({\n\t\t\tmustHaveUndecidedChangeset: !state.mustHaveUndecidedChangeset\n\t\t}), ()=>{\n\t\t\tif (this.props.onChange) {\n\t\t\t\tthis.props.onChange(this.getFilterObj())\n\t\t\t}\n\t\t})\n\t}\n\n\trender() {\n\t\treturn (<div className=\"filterMenuInner\">\n\t\t\t<PopupState variant=\"popover\">\n\t\t\t\t{popupState => (\n\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t<Fab\n\t\t\t\t\t\t\t{...bindTrigger(popupState)}\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\t\tclassName=\"fab\"\n\t\t\t\t\t\t\taria-label={this.props.getString('what-to-show')}\n\t\t\t\t\t\t\ttitle={this.props.getString('what-to-show')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t!!this.state.category\n\t\t\t\t\t\t\t\t? (<>\n\t\t\t\t\t\t\t\t\t<div className=\"filterMenuDot\" style={{margin:'0 8px 0 -4px',background:this.state.category.color.bg}}></div>\n\t\t\t\t\t\t\t\t\t{this.state.category.name_translated}\n\t\t\t\t\t\t\t\t</>)\n\t\t\t\t\t\t\t\t: <Localized id=\"what-to-show\" />\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<ArrowDropDownIcon className=\"ArrowDropDownIcon\"/>\n\t\t\t\t\t\t</Fab>\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{...bindMenu(popupState)}\n\t\t\t\t\t\t\ttransitionDuration={0}\n\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\tvertical: 'top',\n\t\t\t\t\t\t\t\thorizontal: 'left',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"menuBlurredPaperBackground\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tkey=\"everything\"\n\t\t\t\t\t\t\t\tvalue=\"\"\n\t\t\t\t\t\t\t\tonClick={()=>this.setValue('category', null, popupState.close)}\n\t\t\t\t\t\t\t\tselected={!(!!this.state.category)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"filterMenuDot\" style={{background:'transparent'}}></div>\n\t\t\t\t\t\t\t\t<Localized id=\"show-everything\" />\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t{this.categories.map(category=>{\n\t\t\t\t\t\t\t\tconst isSelected = (!!this.state.category && category.name_translated === this.state.category.name_translated)\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\tkey={category.name_translated}\n\t\t\t\t\t\t\t\t\tvalue={category.name_translated}\n\t\t\t\t\t\t\t\t\tonClick={()=>this.setValue('category', category,popupState.close)}\n\t\t\t\t\t\t\t\t\tselected={isSelected}\n\t\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\t\tbackground: (isSelected ? category.color.bg : ''),\n\t\t\t\t\t\t\t\t\t\tcolor: (\n\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t? category.color.fg\n\t\t\t\t\t\t\t\t\t\t\t: (\n\t\t\t\t\t\t\t\t\t\t\t\tthis.props.theme.palette.type === 'light'\n\t\t\t\t\t\t\t\t\t\t\t\t? category.color.bg\n\t\t\t\t\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"filterMenuDot\" style={{background:(isSelected ? category.color.fg : category.color.bg)}}></div>\n\t\t\t\t\t\t\t\t\t{category.name_translated}\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t)}\n\t\t\t</PopupState>\n\n\t\t\t<PopupState variant=\"popover\">\n\t\t\t\t{popupState => (\n\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t<Fab\n\t\t\t\t\t\t\t{...bindTrigger(popupState)}\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\t\tclassName=\"fab\"\n\t\t\t\t\t\t\taria-label={this.props.getString('for-which-age')}\n\t\t\t\t\t\t\ttitle={this.props.getString('for-which-age')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t!!this.state.age\n\t\t\t\t\t\t\t\t? (\n\t\t\t\t\t\t\t\t\tthis.state.age===this.highest_ages_entry\n\t\t\t\t\t\t\t\t\t? <Localized id=\"for-age-x-and-up\" vars={{age:this.state.age}}/>\n\t\t\t\t\t\t\t\t\t: <Localized id=\"for-age-x\" vars={{age:this.state.age}} />\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t: <Localized id=\"for-which-age\" />\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<ArrowDropDownIcon className=\"ArrowDropDownIcon\"/>\n\t\t\t\t\t\t</Fab>\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{...bindMenu(popupState)}\n\t\t\t\t\t\t\ttransitionDuration={0}\n\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\tvertical: 'top',\n\t\t\t\t\t\t\t\thorizontal: 'left',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"menuBlurredPaperBackground\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tkey=\"any_age\"\n\t\t\t\t\t\t\t\tonClick={()=>this.setValue('age', null, popupState.close)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"filterMenuDot hasIcon material-icons-round\">\n\t\t\t\t\t\t\t\t\t{(!(!!this.state.age) ? 'check' : '')}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Localized id=\"any_age\" />\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t{this.ages.map(number=>{\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\tkey={number}\n\t\t\t\t\t\t\t\t\tonClick={()=>this.setValue('age', number, popupState.close)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className=\"filterMenuDot hasIcon material-icons-round\">\n\t\t\t\t\t\t\t\t\t\t{(!!this.state.age && number === this.state.age ? 'check' : '')}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t{number===this.highest_ages_entry ? '≥ '+number : number}\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t)}\n\t\t\t</PopupState>\n\n\t\t\t<PopupState variant=\"popover\">\n\t\t\t\t{popupState => (\n\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t<Fab\n\t\t\t\t\t\t\t{...bindTrigger(popupState)}\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\t\tclassName=\"fab\"\n\t\t\t\t\t\t\taria-label={this.props.getString('what-to-show')}\n\t\t\t\t\t\t\ttitle={this.props.getString('button_audience_queer_default_text')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.state.audience_queer.size > 0\n\t\t\t\t\t\t\t\t? (<>\n\t\t\t\t\t\t\t\t\t<Localized id=\"button_audience_queer_default_text\" />\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis.audience_queer_values\n\t\t\t\t\t\t\t\t\t\t.filter(audience => this.state.audience_queer.has(audience.key))\n\t\t\t\t\t\t\t\t\t\t.map(audience => {\n\t\t\t\t\t\t\t\t\t\t\treturn <div key={audience.emoji} style={{margin:'0 -4px 0 8px'}}>{audience.emoji}</div>\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t</>)\n\t\t\t\t\t\t\t\t: <Localized id=\"button_audience_queer_default_text\" />\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<ArrowDropDownIcon className=\"ArrowDropDownIcon\"/>\n\t\t\t\t\t\t</Fab>\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{...bindMenu(popupState)}\n\t\t\t\t\t\t\ttransitionDuration={0}\n\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\tvertical: 'top',\n\t\t\t\t\t\t\t\thorizontal: 'left',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"menuBlurredPaperBackground\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{this.audience_queer_values.map(audience => {\n\t\t\t\t\t\t\t\tconst isSelected = (\n\t\t\t\t\t\t\t\t\taudience.key === 'everything'\n\t\t\t\t\t\t\t\t\t? this.state.audience_queer.size === 0\n\t\t\t\t\t\t\t\t\t: this.state.audience_queer.has(audience.key)\n\t\t\t\t\t\t\t\t)\n\n\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\t\tkey={audience.key}\n\t\t\t\t\t\t\t\t\tonClick={()=>this.toogleAudienceQueer(audience.key)}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<div className={'filterMenuDot hasIcon '+(audience.emoji ? '' : 'material-icons-round')}>\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tisSelected\n\t\t\t\t\t\t\t\t\t\t\t? (audience.emoji ? audience.emoji : 'check')\n\t\t\t\t\t\t\t\t\t\t\t: ''\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t\t\t<Localized\n\t\t\t\t\t\t\t\t\t\t\tid={audience.translation_key}\n\t\t\t\t\t\t\t\t\t\t\telems={{\n\t\t\t\t\t\t\t\t\t\t\t\tstrong: <strong />,\n\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t})}\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t)}\n\t\t\t</PopupState>\n\n\t\t\t{\n\t\t\t\t!!this.props.globals.profileID\n\t\t\t\t? (<>\n\t\t\t\t\t<Fab\n\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\tclassName=\"fab\"\n\t\t\t\t\t\taria-label={this.props.getString('must_have_undecided_changes')}\n\t\t\t\t\t\ttitle={this.props.getString('must_have_undecided_changes')}\n\t\t\t\t\t\tonClick={this.toggleMustHaveUndecidedChangeset}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Localized id=\"must_have_undecided_changes\" />\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t!!this.state.mustHaveUndecidedChangeset\n\t\t\t\t\t\t\t? (<CheckIcon className=\"ArrowDropDownIcon\" style={{\n\t\t\t\t\t\t\t\twidth:'20px',\n\t\t\t\t\t\t\t\theight:'20px',\n\t\t\t\t\t\t\t}}/>)\n\t\t\t\t\t\t\t:  <div style={{width:'8px'}}></div>\n\t\t\t\t\t\t}\n\t\t\t\t\t</Fab>\n\n\n\n\t\t\t<PopupState variant=\"popover\">\n\t\t\t\t{popupState => (\n\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t<Fab\n\t\t\t\t\t\t\t{...bindTrigger(popupState)}\n\t\t\t\t\t\t\tsize=\"small\"\n\t\t\t\t\t\t\tvariant=\"extended\"\n\t\t\t\t\t\t\tclassName=\"fab\"\n\t\t\t\t\t\t\taria-label={this.props.getString('button_text_published')}\n\t\t\t\t\t\t\ttitle={this.props.getString('button_text_published')}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.state.published === null\n\t\t\t\t\t\t\t\t? <Localized id=\"button_text_published\" />\n\t\t\t\t\t\t\t\t: (\n\t\t\t\t\t\t\t\t\tthis.state.published === true\n\t\t\t\t\t\t\t\t\t? <Localized id=\"menu_text_published_published\" />\n\t\t\t\t\t\t\t\t\t: <Localized id=\"menu_text_published_unpublished\" />\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t<ArrowDropDownIcon className=\"ArrowDropDownIcon\"/>\n\t\t\t\t\t\t</Fab>\n\t\t\t\t\t\t<Menu\n\t\t\t\t\t\t\t{...bindMenu(popupState)}\n\t\t\t\t\t\t\ttransitionDuration={0}\n\t\t\t\t\t\t\tanchorOrigin={{\n\t\t\t\t\t\t\t\tvertical: 'top',\n\t\t\t\t\t\t\t\thorizontal: 'left',\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tclassName=\"menuBlurredPaperBackground\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tkey=\"everything\"\n\t\t\t\t\t\t\t\tonClick={()=>this.setValue('published', null, popupState.close)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"filterMenuDot hasIcon material-icons-round\">\n\t\t\t\t\t\t\t\t\t{this.state.published === null ? 'check' : ''}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Localized id=\"menu_text_published_everything\" />\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tkey=\"unpublished\"\n\t\t\t\t\t\t\t\tonClick={()=>this.setValue('published', false, popupState.close)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"filterMenuDot hasIcon material-icons-round\">\n\t\t\t\t\t\t\t\t\t{this.state.published === false ? 'check' : ''}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Localized id=\"menu_text_published_unpublished\" />\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t\t<MenuItem\n\t\t\t\t\t\t\t\tkey=\"published\"\n\t\t\t\t\t\t\t\tonClick={()=>this.setValue('published', true, popupState.close)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"filterMenuDot hasIcon material-icons-round\">\n\t\t\t\t\t\t\t\t\t{this.state.published === true ? 'check' : ''}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<Localized id=\"menu_text_published_published\" />\n\t\t\t\t\t\t\t</MenuItem>\n\t\t\t\t\t\t</Menu>\n\t\t\t\t\t</React.Fragment>\n\t\t\t\t)}\n\t\t\t</PopupState>\n\t\t\t\t</>)\n\t\t\t\t: null\n\t\t\t}\n\t\t</div>)\n\t}\n}\n\nexport default withGlobals(withTheme(withLocalization(FiltersPanelContent)))\n\n","import React, { lazy, Suspense } from 'react'\n\nimport { withLocalization } from '../../Localized/'\nimport { withConicGradient } from '../../ConicGradient/'\n\nimport { navigate } from '@reach/router'\nimport {\n\tmarkers as query_markers,\n\tundecidedPlaces as query_undecidedPlaces,\n} from '../../../queries.js'\n\nimport './index.css'\nimport classes from './MainMapMapbox.module.css'\n\nimport presets from '../../../data/dist/presets.json'\nimport colors from '../../../data/dist/colors.json'\nimport colorsByPreset from '../../../data/dist/colorsByPreset.json'\nimport { getColorByPreset, getTranslationFromArray, getCountryCode, getILGA /*, getPreset, getWantedTagsList*/ } from '../../../functions.js'\n\nimport { withGlobals } from '../../Globals/'\n\nimport {\n\tFab,\n} from '@material-ui/core'\nimport {\n\tAddRounded as ZoomInIcon, // ZoomInRounded\n\tRemoveRounded as ZoomOutIcon, // ZoomOutRounded\n} from '@material-ui/icons'\nimport { withTheme } from '@material-ui/core/styles'\n\nimport FiltersPanelContent from '../../FiltersPanelContent/'\n\n// import { Map, TileLayer } from 'react-leaflet'\nimport L from 'leaflet'\nimport './leaflet/leaflet.css'\n\nimport mapbox_logo_lightmode from '../../../images/mapbox-logo-black.svg'\nimport mapbox_logo_darkmode from '../../../images/mapbox-logo-white.svg'\n\n// import MapboxLoader from './MapboxLoader.js'\n\nimport { PruneCluster, PruneClusterForLeaflet } from './PruneCluster_dist/PruneCluster.js'\n\nPruneCluster.Cluster.ENABLE_MARKERS_LIST = true\n\nconst MapboxLoader = lazy(() => import('./MapboxLoader.js'))\n\nclass MainMapMapbox extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tdocs: [],\n\t\t\tisGeoChooser: false,\n\t\t\tmiddleMarkerDoc: undefined,\n\t\t}\n\n\t\tthis.currentStyleURL = null\n\n\t\tthis.clusterGroup = null\n\t\tthis.defaultClusterSize = 120\n\n\t\t// objects for caching and keeping track of HTML marker objects (for performance)\n\t\tthis.mapbox_markers = {}\n\t\tthis.mapbox_markersOnScreen = {}\n\n\t\tthis.filters = null\n\n\t\t// this.MarkerLayerRef = React.createRef()\n\t\tthis.leaflet_map = null\n\t\tthis.map = null\n\t\tthis.borderGotLoaded = false\n\t\tthis.prune_markers = []\n\t\tthis.undecidedPlaces = []\n\n\t\tthis.ConicGradient = null\n\n\t\tthis.loadedMapbox = this.loadedMapbox.bind(this)\n\t\t// this.gotMapRef = this.gotMapRef.bind(this)\n\t\tthis.gotMapRefLeaflet = this.gotMapRefLeaflet.bind(this)\n\n\t\tthis.syncViewport = this.syncViewport.bind(this)\n\t\tthis.addMarkersToPruneCluster = this.addMarkersToPruneCluster.bind(this)\n\t\tthis.filterMarkers = this.filterMarkers.bind(this)\n\t\tthis.showAllMarkers = this.showAllMarkers.bind(this)\n\t\tthis.showAllMarkersButMiddleMarker = this.showAllMarkersButMiddleMarker.bind(this)\n\n\t\t// this.setMapPos = this.setMapPos.bind(this)\n\t\tthis.viewportChanged = this.viewportChanged.bind(this)\n\t\tthis.zoomIn = this.zoomIn.bind(this)\n\t\tthis.zoomOut = this.zoomOut.bind(this)\n\n\t\tthis.loadMarkers = this.loadMarkers.bind(this)\n\t\tthis.loadUndecidedPlaces = this.loadUndecidedPlaces.bind(this)\n\n\t\tthis.filtersChanged = this.filtersChanged.bind(this)\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.loadMarkers()\n\t\tthis.loadUndecidedPlaces()\n\n\t\tif (this.props.conic_gradient) {\n\t\t\tthis.props.conic_gradient.onReady(() => {\n\t\t\t\tthis.ConicGradient = this.props.conic_gradient.getConicGradient()\n\t\t\t\t// this.clusterGroup.RedrawIcons()\n\t\t\t\tthis.updateMarkers({ forceRedraw: true })\n\t\t\t})\n\t\t}\n\n\t\tif (this.props.onFunctions) {\n\t\t\tconst functions = {\n\t\t\t\tmap: {\n\t\t\t\t\tgetMapType: () => 'mapbox',\n\t\t\t\t\tsetPadding: (...attr) => this.map ? this.map.setPadding(...attr) : null,\n\t\t\t\t\tsetZoom: (...attr) => this.map ? this.map.setZoom(...attr) : null,\n\t\t\t\t\tgetZoom: () => this.map ? this.map.getZoom() : null,\n\t\t\t\t\tgetCenter: () => this.map ? this.map.getCenter() : null,\n\t\t\t\t\tgetBounds: () => this.map ? this.map.getBounds() : null,\n\t\t\t\t\tzoomIn: () => this.map ? this.map.zoomIn() : null,\n\t\t\t\t\tfitBounds: (...attr) => this.map ? this.map.fitBounds(...attr) : null,\n\t\t\t\t\tflyToBounds: (...attr) => this.map ? this.map.fitBounds(...attr) : null,\n\t\t\t\t\t// setView: (...attr) => {\n\t\t\t\t\t// \tthis.map.setCenter(attr.center)\n\t\t\t\t\t// \tthis.map.setZoom(attr.zoom)\n\t\t\t\t\t// }, // this.map.setView(...attr),\n\t\t\t\t\tsetView: (...attr) => this.map ? this.map.jumpTo(...attr) : null,\n\t\t\t\t\tpanBy: (...attr) => this.map ? this.map.panBy(...attr) : null,\n\t\t\t\t\tpanTo: (...attr) => this.map ? this.map.panTo(...attr) : null,\n\t\t\t\t\tflyTo: (...attr) => this.map ? this.map.flyTo(...attr) : null,\n\t\t\t\t\tinvalidateSize: (...attr) => { }, // this.map.resize(...attr),\n\t\t\t\t\tproject: (...attr) => this.leaflet_map ? this.leaflet_map.project(...attr) : null,\n\t\t\t\t\tunproject: (...attr) => this.leaflet_map ? this.leaflet_map.unproject(...attr) : null,\n\t\t\t\t\tlatLngToContainerPoint: (...attr) => this.leaflet_map ? this.leaflet_map.latLngToContainerPoint(...attr) : null,\n\n\t\t\t\t\tuseAsGeoChooser: (...attr) => this.useAsGeoChooser(...attr),\n\t\t\t\t\trefetchMarkers: () => this.refetchMarkers(),\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.props.globals.mainMapFunctions = functions.map\n\t\t\tthis.props.onFunctions(functions)\n\t\t}\n\n\t\twindow.addEventListener('updateMainMapView', this.setMapPos)\n\n\t\tthis.mapViewport = {\n\t\t\tcenter: this.props.store.get('map_center_real') || [51, 10],\n\t\t\tzoom: this.props.store.get('map_zoom') || 3,\n\t\t}\n\t}\n\tcomponentDidUpdate() {\n\t\tif (this.props.filters !== this.filters) {\n\t\t\tthis.filters = this.props.filters\n\t\t\tthis.filterMarkers(this.filters)\n\t\t}\n\n\t\tconst newStyleURL = this.getStyleUrl()\n\t\tif (!!this.map && this.currentStyleURL !== newStyleURL) {\n\t\t\tthis.currentStyleURL = newStyleURL\n\t\t\tthis.map.setStyle(newStyleURL)\n\t\t}\n\t}\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener('updateMainMapView', this.setMapPos)\n\n\t\tif (this.markerQuerySubscription) {\n\t\t\tthis.markerQuerySubscription.unsubscribe()\n\t\t}\n\t}\n\n\trefetchMarkers() {\n\t\tthis.props.globals.graphql.query({\n\t\t\tfetchPolicy: 'network-only',\n\t\t\tquery: query_markers,\n\t\t\tvariables: {\n\t\t\t\tlanguages: navigator.languages,\n\t\t\t},\n\t\t})\n\t}\n\n\tsetMapPos(event) {\n\t\tthis.setState({ center: this.props.globals.map_center })\n\t}\n\n\tuseAsGeoChooser(yesOrNo, middleMarkerDoc) {\n\t\tif (yesOrNo) {\n\t\t\tthis.setState({\n\t\t\t\tisGeoChooser: true,\n\t\t\t\tmiddleMarkerDoc,\n\t\t\t}, () => {\n\t\t\t\tthis.filterMarkers(this.filters)\n\t\t\t\tthis.setGlobalMapCenter()\n\t\t\t})\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tisGeoChooser: false,\n\t\t\t\tmiddleMarkerDoc: undefined,\n\t\t\t}, () => {\n\t\t\t\tthis.filterMarkers(this.filters)\n\t\t\t\tthis.setGlobalMapCenter()\n\t\t\t})\n\t\t}\n\t}\n\n\tloadMarkers() {\n\t\tthis.markerQuerySubscription = this.props.globals.graphql.watchQuery({\n\t\t\tfetchPolicy: 'cache-and-network',\n\t\t\tquery: query_markers,\n\t\t\tvariables: {\n\t\t\t\tlanguages: navigator.languages,\n\t\t\t\t// wantedTags: ['min_age','max_age',...getWantedTagsList(presets)], // this gets us about 11% reduction in size\n\t\t\t},\n\t\t})\n\t\t\t.subscribe(({ data }) => {\n\t\t\t\tif (!!data && !!data.markers) {\n\t\t\t\t\tconst docs = JSON.parse(JSON.stringify(data.markers)).map(doc => {\n\t\t\t\t\t\tdoc.___preset = (\n\t\t\t\t\t\t\t!!doc.preset && !!presets[doc.preset]\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tkey: doc.preset,\n\t\t\t\t\t\t\t\t\t...presets[doc.preset],\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: presets.default\n\t\t\t\t\t\t)\n\t\t\t\t\t\tdoc.___color = getColorByPreset(doc.___preset.key, colorsByPreset) || colors.default\n\n\t\t\t\t\t\treturn doc\n\t\t\t\t\t})\n\n\t\t\t\t\tthis.docs = docs\n\t\t\t\t\tthis.addMarkersToPruneCluster(docs)\n\t\t\t\t}\n\t\t\t})\n\t}\n\n\tloadUndecidedPlaces() {\n\t\tif (!!this.props.globals.profileID) {\n\t\t\tthis.markerQuerySubscription = this.props.globals.graphql.watchQuery({\n\t\t\t\tfetchPolicy: 'cache-and-network',\n\t\t\t\tquery: query_undecidedPlaces,\n\t\t\t\tvariables: {},\n\t\t\t})\n\t\t\t\t.subscribe(({ data }) => {\n\t\t\t\t\tif (!!data && !!data.undecidedPlaces) {\n\t\t\t\t\t\tthis.undecidedPlaces = data.undecidedPlaces.map(doc => doc._id)\n\t\t\t\t\t\tthis.filterMarkers(this.filters)\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t}\n\t}\n\n\tasync showBorders() {\n\t\tif (!this.borderGotLoaded) {\n\t\t\tthis.borderGotLoaded = true\n\t\t\tconst borders_path = await import('./border-files/borders_1to110m_p2.geojson')\n\t\t\tconst borders_response = await fetch(borders_path.default)\n\t\t\tconst borders = await borders_response.json()\n\n\t\t\tconst getStatusColor = status => {\n\t\t\t\tif (status === 'great' || status === 1) {\n\t\t\t\t\treturn this.props.theme.palette.success.main\n\t\t\t\t} else if (status === 'ok' || status === 2) {\n\t\t\t\t\treturn this.props.theme.palette.warning.main\n\t\t\t\t} else if (status === 'bad' || status === 3) {\n\t\t\t\t\treturn this.props.theme.palette.error.main\n\t\t\t\t}\n\t\t\t\treturn this.props.theme.palette.background.default\n\t\t\t}\n\n\t\t\tborders.features = borders.features.map(feature => {\n\t\t\t\tconst country_code = getCountryCode(feature.properties)\n\t\t\t\tconst ilga = getILGA(country_code)\n\t\t\t\tconst color = getStatusColor(\n\t\t\t\t\tilga\n\t\t\t\t\t\t&& ilga.overview\n\t\t\t\t\t\t&& ilga.overview.statusNumber\n\t\t\t\t\t\t? ilga.overview.statusNumber\n\t\t\t\t\t\t: -1\n\t\t\t\t)\n\n\t\t\t\treturn {\n\t\t\t\t\tgeometry: feature.geometry,\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\t...feature.properties,\n\t\t\t\t\t\tcolor,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tthis.map.addSource('borders', {\n\t\t\t\ttype: 'geojson',\n\t\t\t\tdata: borders,\n\t\t\t})\n\n\t\t\t// this.map.on('load', ()=>{\n\t\t\t// \t// this.showBorders()\n\t\t\t// })\n\t\t}\n\n\t\tconst layers = this.map.getStyle().layers\n\t\t// Find the index of the first symbol layer in the map style\n\t\tlet firstSymbolId = null\n\t\tfor (const layer of layers) {\n\t\t\tif (layer.type === 'symbol') {\n\t\t\t\tfirstSymbolId = layer.id\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\n\t\tthis.map.addLayer({\n\t\t\t'id': 'borders',\n\t\t\t'type': 'fill',\n\t\t\t'source': 'borders',\n\t\t\t'layout': {},\n\t\t\t'paint': {\n\t\t\t\t'fill-color': ['get', 'color'],\n\t\t\t\t'fill-opacity': 0.15,\n\t\t\t},\n\t\t}, firstSymbolId)\n\t}\n\thideBorders() {\n\t\tif (!!this.map && this.map.getLayer('borders')) {\n\t\t\tthis.map.removeLayer('borders')\n\t\t}\n\t}\n\n\tgetStyleUrl() {\n\t\tif (this.props.theme.palette.type === 'light') {\n\t\t\treturn 'mapbox://styles/qiekub/ck8aum3p70aa51in4ikxao8ii' // ?optimize=true\n\t\t} else {\n\t\t\treturn 'mapbox://styles/qiekub/ck8ozalln0c1g1iog1mpl8aps' // ?optimize=true\n\t\t}\n\t}\n\n\tgetInitCenter() {\n\t\tlet center = this.props.store.get('map_center_fake')\n\n\t\tif (!(!!center)) {\n\t\t\tcenter = {\n\t\t\t\tlat: 51,\n\t\t\t\tlng: 10,\n\t\t\t}\n\t\t}\n\t\tif (!(!!center.lat) || center.lat <= -90 || center.lat >= 90) {\n\t\t\tcenter.lat = 51\n\t\t}\n\t\tif (!(!!center.lng)) {\n\t\t\tcenter.lng = 10\n\t\t}\n\n\t\treturn center\n\t}\n\n\tgotMapRefLeaflet(element) {\n\t\tif (!!element && this.leaflet_map === null) {\n\t\t\tthis.leaflet_map = new L.Map(element, {\n\t\t\t\tcenter: this.getInitCenter(),\n\t\t\t\tzoom: (this.props.store.get('map_zoom') || 3) + 1,\n\t\t\t\tzoomSnap: 0,\n\t\t\t\tzoomAnimation: false,\n\t\t\t\tfadeAnimation: false,\n\t\t\t\tmarkerZoomAnimation: false,\n\t\t\t\tscrollWheelZoom: false,\n\t\t\t\tminZoom: 1,\n\t\t\t\tmaxZoom: 22,\n\t\t\t})\n\n\t\t\t// L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n\t\t\t// \tattribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n\t\t\t// }).addTo(this.leaflet_map);\n\n\t\t\t// L.tileLayer('https://api.mapbox.com/styles/v1/qiekub/ck8ozalln0c1g1iog1mpl8aps/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoicWlla3ViIiwiYSI6ImNrOGF1ZGlpdzA1dDgzamx2ajNua3picmMifQ.OYr_o4fX7vPTvZCWZsUs4g', {\n\t\t\t// \tattribution: ''\n\t\t\t// }).addTo(this.leaflet_map)\n\n\t\t\tthis.clusterGroup = new PruneClusterForLeaflet()\n\t\t\tthis.clusterGroup.Cluster.Size = this.defaultClusterSize\n\t\t\tthis.leaflet_map.addLayer(this.clusterGroup)\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.syncViewport()\n\t\t\t}, 100)\n\t\t}\n\t}\n\tloadedMapbox({ ref, mapboxgl }) {\n\t\tthis.mapboxgl = mapboxgl\n\n\t\tif (!!ref && this.map === null) {\n\t\t\tthis.currentStyleURL = this.getStyleUrl()\n\n\t\t\tconst center = this.getInitCenter()\n\n\t\t\tthis.map = new this.mapboxgl.Map({\n\t\t\t\tcontainer: ref,\n\t\t\t\tstyle: this.currentStyleURL,\n\t\t\t\tcenter: new this.mapboxgl.LngLat(center.lng, center.lat),\n\t\t\t\tzoom: this.props.store.get('map_zoom') || 3,\n\t\t\t\tbearing: 0, // this.props.store.get('map_bearing') || 0,\n\t\t\t\tpitch: 0, // this.props.store.get('map_pitch') || 0,\n\t\t\t\thash: false, // 'map',\n\t\t\t\trefreshExpiredTiles: true,\n\t\t\t\tminZoom: 1,\n\t\t\t\tmaxZoom: 22,\n\t\t\t\tbearingSnap: 7,\n\t\t\t\tpitchWithRotate: true,\n\t\t\t\tdragPan: true,\n\t\t\t\tdragRotate: true,\n\t\t\t\ttouchZoomRotate: true,\n\t\t\t\ttouchPitch: true,\n\t\t\t\tscrollZoom: true,\n\t\t\t\tboxZoom: false,\n\t\t\t\tdoubleClickZoom: false,\n\t\t\t})\n\n\t\t\t// this.map.showPadding = true\n\n\t\t\tlet currentMapboxStylesheetID = null\n\t\t\tthis.map.on('styledata', event => {\n\t\t\t\tconst newMapboxStylesheetID = event.style.stylesheet.id\n\t\t\t\tif (event.style._loaded && currentMapboxStylesheetID !== newMapboxStylesheetID) {\n\t\t\t\t\tcurrentMapboxStylesheetID = event.style.stylesheet.id\n\t\t\t\t\tthis.localizeTheMap()\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tthis.map.on('move', this.syncViewport)\n\t\t\tthis.map.on('moveend', this.syncViewport)\n\t\t\tthis.map.on('zoom', this.syncViewport)\n\t\t\tthis.map.on('zoomend', this.syncViewport)\n\n\t\t\tthis.syncViewport()\n\t\t}\n\t}\n\tsyncViewport() {\n\t\tif (!!this.map) {\n\t\t\tthis.viewportChanged({\n\t\t\t\tcenter: this.map.getCenter(),\n\t\t\t\tzoom: this.map.getZoom(),\n\t\t\t\tbearing: this.map.getBearing(),\n\t\t\t\tpitch: this.map.getPitch(),\n\t\t\t})\n\t\t}\n\t}\n\n\tlocalizeTheMap() {\n\t\tconst language = this.props.getString('map_language')\n\n\t\tconst layerIDs = this.map.getStyle().layers\n\t\t\t.filter(layer => (\n\t\t\t\tlayer.hasOwnProperty('layout')\n\t\t\t\t&& layer.layout.hasOwnProperty('text-field')\n\t\t\t\t&& layer.layout['text-field'].flat().includes('name')\n\t\t\t))\n\t\t\t.map(layer => layer.id)\n\n\t\tfor (const layerID of layerIDs) {\n\t\t\tthis.map.setLayoutProperty(layerID, 'text-field', [\n\t\t\t\t'coalesce',\n\t\t\t\t['get', 'name_' + language],\n\t\t\t\t['get', 'name_en'],\n\t\t\t\t['get', 'name'],\n\t\t\t])\n\t\t}\n\t}\n\n\n\n\tupdateMarkers(options) {\n\t\toptions = options || {}\n\n\t\tif (\n\t\t\t!(!!this.clusterGroup)\n\t\t\t|| !(!!this.mapboxgl)\n\t\t) {\n\t\t\treturn null\n\t\t}\n\n\t\tconst newMarkers = {}\n\n\n\n\t\tif (options.forceRedraw) {\n\t\t\tfor (const id in this.mapbox_markers) {\n\t\t\t\tthis.mapbox_markers[id].remove()\n\t\t\t}\n\t\t\tthis.mapbox_markers = {}\n\t\t\tthis.mapbox_markersOnScreen = {}\n\t\t}\n\n\n\t\t// for every cluster on the screen, create an HTML marker for it (if we didn't yet), and add it to the map if it's not there already\n\t\tfor (const feature of this.clusterGroup._objectsOnMap) {\n\t\t\tconst averagePosition = feature.averagePosition\n\t\t\tconst id = feature.hashCode\n\n\t\t\tlet marker = this.mapbox_markers[id]\n\t\t\tif (!marker) {\n\t\t\t\tmarker = this.mapbox_markers[id] = new this.mapboxgl.Marker({\n\t\t\t\t\telement: (\n\t\t\t\t\t\tfeature.population === 1\n\t\t\t\t\t\t\t? this.createPoiMarker(feature)\n\t\t\t\t\t\t\t: this.createClusterMarker(feature)\n\t\t\t\t\t)\n\t\t\t\t})\n\t\t\t\t\t.setLngLat(averagePosition)\n\t\t\t}\n\t\t\tnewMarkers[id] = marker\n\n\t\t\tif (!this.mapbox_markersOnScreen[id]) {\n\t\t\t\tmarker.addTo(this.map)\n\t\t\t}\n\t\t}\n\n\t\t// for every marker we've added previously, remove those that are no longer visible\n\t\tfor (const id in this.mapbox_markersOnScreen) {\n\t\t\tif (!newMarkers[id]) {\n\t\t\t\tthis.mapbox_markersOnScreen[id].remove()\n\t\t\t}\n\t\t}\n\t\tthis.mapbox_markersOnScreen = newMarkers\n\t}\n\tupdateMarkersAfterPruneClusterUpdate() {\n\t\tsetTimeout(() => {\n\t\t\tthis.updateMarkers()\n\t\t}, 100)\n\t}\n\n\tcreatePoiMarker(options) {\n\t\tconst doc = options.lastMarker.data\n\n\t\tconst element = document.createElement('div')\n\t\telement.classList.add('marker-custom-icon')\n\t\telement.style.cursor = 'pointer'\n\t\telement.style.width = '40px'\n\t\telement.style.height = '40px'\n\n\t\telement.addEventListener('click', event => {\n\t\t\tif (!this.state.isGeoChooser) {\n\t\t\t\tnavigate(`/view/${doc._id}/`)\n\t\t\t}\n\t\t})\n\n\t\telement.innerHTML = `\n\t\t\t<div\n\t\t\t\tclass=\"wrapper material-icons-round\"\n\t\t\t\tstyle=\"\n\t\t\t\t\t--bg-color:${doc.___color.bg};\n\t\t\t\t\t--fg-color:${doc.___color.fg};\n\t\t\t\t\"\n\t\t\t>\n\t\t\t\t${doc.___preset.icon ? doc.___preset.icon.toLowerCase() : 'place'}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"mapboxTooltip marker-custom-tooltip\"\n\t\t\t\tstyle=\"\n\t\t\t\t\t--bg-color:${doc.___color.bg};\n\t\t\t\t\t--fg-color:${doc.___color.fg};\n\t\t\t\t\"\n\t\t\t>\n\t\t\t\t${(\n\t\t\t\tdoc.name &&\n\t\t\t\t\tdoc.name.length > 0\n\t\t\t\t\t? getTranslationFromArray(doc.name, this.props.globals.userLocales)\n\t\t\t\t\t: ''\n\t\t\t)}\n\t\t\t</div>\n\t\t`\n\n\t\treturn element\n\t}\n\tcreateClusterMarker(options) {\n\t\tconst colors = Object.entries(\n\t\t\toptions._clusterMarkers\n\t\t\t\t.filter(m => !!m.data.___color.key)\n\t\t\t\t.map(m =>\n\t\t\t\t\t// m.data.___color.key === 'default'\n\t\t\t\t\t// ? 'transparent'\n\t\t\t\t\t// :\n\t\t\t\t\tm.data.___color.bg\n\t\t\t\t)\n\t\t\t\t.reduce((obj, preset_key) => {\n\t\t\t\t\tif (!(!!obj[preset_key])) {\n\t\t\t\t\t\tobj[preset_key] = 0\n\t\t\t\t\t}\n\t\t\t\t\tobj[preset_key] += 1\n\t\t\t\t\treturn obj\n\t\t\t\t}, {})\n\t\t).sort((a, b) => a[1] - b[1])\n\n\t\tconst colors_sum = colors.reduce((sum, pair) => sum + pair[1], 0)\n\n\t\tconst gradient = this.getConicGradient(colors.map(pair => {\n\t\t\treturn [pair[0], pair[1] / colors_sum]\n\t\t}))\n\n\t\tconst element = document.createElement('div')\n\t\telement.classList.add('marker-cluster-custom-icon')\n\t\telement.style.cursor = 'pointer'\n\t\telement.style.width = '48px'\n\t\telement.style.height = '48px'\n\n\t\telement.innerHTML = `\n\t\t\t<div class=\"number\">${options.population || ''}</div>\n\t\t\t<div class=\"pieChart\" style=\"background-image:url(${!!gradient ? gradient.dataURL : ''});\"></div>\n\t\t`\n\n\n\t\telement.addEventListener('click', event => {\n\t\t\tlet padding = 128\n\t\t\tif (this.props.globals.isSmallScreen) {\n\t\t\t\tpadding = 64\n\t\t\t}\n\n\t\t\t// const o_bounds = options.bounds\n\t\t\t//\n\t\t\t// const minLngLat = new this.mapboxgl.LngLat(o_bounds.minLng, o_bounds.minLat);\n\t\t\t// const maxLngLat = new this.mapboxgl.LngLat(o_bounds.maxLng, o_bounds.maxLat);\n\t\t\t// const distance = minLngLat.distanceTo(maxLngLat)*0.5\n\t\t\t// const middle = options.position\n\t\t\t//\n\t\t\t// const bounds = new this.mapboxgl.LngLat(middle.lng, middle.lat).toBounds(distance)\n\t\t\t//\n\t\t\t// this.map.fitBounds(bounds, {\n\t\t\t// \tpadding: {\n\t\t\t// \t\ttop: padding,\n\t\t\t// \t\tright: padding,\n\t\t\t// \t\tbottom: 116+padding,\n\t\t\t// \t\tleft: (this.props.sidebarIsOpen ? 400+padding : padding)\n\t\t\t// \t},\n\t\t\t// })\n\n\t\t\tthis.map.flyTo({\n\t\t\t\tcenter: options.position, // .averagePosition,\n\t\t\t\tzoom: this.map.getZoom() + 1,\n\t\t\t\tpadding: {\n\t\t\t\t\ttop: padding,\n\t\t\t\t\tright: padding,\n\t\t\t\t\tbottom: 116 + padding,\n\t\t\t\t\tleft: (this.props.sidebarIsOpen ? 400 + padding : padding)\n\t\t\t\t},\n\t\t\t\tduration: 750,\n\t\t\t})\n\t\t})\n\n\t\treturn element\n\t}\n\n\tgetConicGradient(values) {\n\t\tif (!(!!this.ConicGradient)) {\n\t\t\treturn null\n\t\t}\n\n\t\tlet stops = []\n\n\t\tconst gapColor = 'transparent' // this.props.theme.palette.type === 'dark' ? '#181818' : 'white'\n\n\t\tif (values.length === 1) {\n\t\t\tstops = [values[0][0] + ' 0']\n\t\t} else {\n\t\t\tlet counter = 0\n\t\t\tlet currentPos = 0\n\t\t\tfor (const pair of values) {\n\t\t\t\tcurrentPos += 5\n\t\t\t\tif (counter === 0) {\n\t\t\t\t\tstops.push(gapColor + ' ' + currentPos + 'deg')\n\t\t\t\t} else {\n\t\t\t\t\tstops.push(gapColor + ' 0 ' + currentPos + 'deg')\n\t\t\t\t}\n\n\t\t\t\tif (counter === values.length - 1) {\n\t\t\t\t\tstops.push(pair[0] + ' 0')\n\t\t\t\t} else {\n\t\t\t\t\tcurrentPos += Math.ceil(pair[1] * 360)\n\t\t\t\t\tstops.push(pair[0] + ' 0 ' + currentPos + 'deg')\n\t\t\t\t}\n\n\t\t\t\tcounter += 1\n\t\t\t}\n\t\t}\n\t\tstops = stops.join(', ')\n\n\t\tconst gradient = new this.ConicGradient({\n\t\t\tstops: stops, // \"gold 40%, #f06 0\", // required\n\t\t\trepeating: false, // Default: false\n\t\t\tsize: 100, // Default: Math.max(innerWidth, innerHeight)\n\t\t})\n\n\t\treturn gradient\n\t}\n\n\taddMarkersToPruneCluster(docs) {\n\t\tthis.prune_markers = []\n\t\tthis.clusterGroup.RemoveMarkers()\n\n\t\tfor (const doc of docs) {\n\t\t\tlet marker = new PruneCluster.Marker(doc.lat, doc.lng, doc)\n\t\t\tmarker.filtered = true\n\t\t\tthis.prune_markers.push(marker)\n\t\t\tthis.clusterGroup.RegisterMarker(marker)\n\t\t}\n\n\t\t// this.clusterGroup.ProcessView()\n\t\t// this.leaflet_map.invalidateSize(false)\n\n\t\tthis.filterMarkers(this.filters)\n\t}\n\n\thideAllMarkers() {\n\t\tconst markers_length = this.prune_markers.length\n\t\tfor (let i = markers_length - 1; i >= 0; i--) {\n\t\t\tthis.prune_markers[i].filtered = true\n\t\t}\n\t\tthis.clusterGroup.ProcessView()\n\t\tthis.updateMarkersAfterPruneClusterUpdate()\n\t}\n\tshowAllMarkers() {\n\t\tconst markers_length = this.prune_markers.length\n\t\tfor (let i = markers_length - 1; i >= 0; i--) {\n\t\t\tthis.prune_markers[i].filtered = false\n\t\t}\n\t\tthis.clusterGroup.ProcessView()\n\t\tthis.updateMarkersAfterPruneClusterUpdate()\n\t}\n\tshowAllMarkersButMiddleMarker() {\n\t\tconst middleMarkerID = this.state.middleMarkerDoc._id\n\n\t\tconst markers_length = this.prune_markers.length\n\t\tfor (let i = markers_length - 1; i >= 0; i--) {\n\t\t\tif (middleMarkerID === this.prune_markers[i].data._id) {\n\t\t\t\tthis.prune_markers[i].filtered = true\n\t\t\t} else {\n\t\t\t\tthis.prune_markers[i].filtered = false\n\t\t\t}\n\t\t}\n\n\t\tthis.clusterGroup.ProcessView()\n\t\tthis.updateMarkersAfterPruneClusterUpdate()\n\t}\n\tfilterMarkers(filters) {\n\t\tif (this.state.isGeoChooser) {\n\t\t\tthis.showBorders()\n\t\t\tthis.showAllMarkersButMiddleMarker()\n\t\t} else {\n\t\t\tthis.hideBorders()\n\n\t\t\tif (!!this.filters) {\n\t\t\t\tconst ids = this.filters.ids || []\n\n\t\t\t\tconst presets = this.filters.presets || []\n\t\t\t\t// const presets = ['amenity/community_centre']\n\t\t\t\tconst presets_length = presets.length\n\n\t\t\t\tconst selectedAge = this.filters.selectedAge\n\t\t\t\tconst ageOption = this.filters.ageOption\n\t\t\t\tconst audienceQueerOptions = this.filters.audienceQueerOptions || []\n\t\t\t\tconst checkAudienceQueerOptions = audienceQueerOptions.length > 0\n\t\t\t\tconst mustHaveUndecidedChangeset = this.filters.mustHaveUndecidedChangeset || false\n\t\t\t\tconst published = (\n\t\t\t\t\tthis.filters.published === false || this.filters.published === true\n\t\t\t\t\t\t? this.filters.published\n\t\t\t\t\t\t: null\n\t\t\t\t)\n\n\t\t\t\tif (\n\t\t\t\t\tpresets_length > 0\n\t\t\t\t\t|| checkAudienceQueerOptions\n\t\t\t\t\t|| !!selectedAge\n\t\t\t\t\t|| mustHaveUndecidedChangeset\n\t\t\t\t\t|| published === true\n\t\t\t\t\t|| published === false\n\t\t\t\t) {\n\t\t\t\t\tconst markers_length = this.prune_markers.length\n\t\t\t\t\tfor (let i = markers_length - 1; i >= 0; i--) {\n\t\t\t\t\t\tconst marker = this.prune_markers[i]\n\n\t\t\t\t\t\tif (ids.includes(marker.data._id)) {\n\t\t\t\t\t\t\tthis.prune_markers[i].filtered = false\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tlet publishedFilter = false\n\t\t\t\t\t\t\tif (published === true) {\n\t\t\t\t\t\t\t\tpublishedFilter = marker.data.tags.published === true\n\t\t\t\t\t\t\t} else if (published === false) {\n\t\t\t\t\t\t\t\tpublishedFilter = marker.data.tags.published !== true\n\t\t\t\t\t\t\t} else if (published === null) {\n\t\t\t\t\t\t\t\tpublishedFilter = true\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet hasUndecidedChangesets = true\n\t\t\t\t\t\t\tif (mustHaveUndecidedChangeset) {\n\t\t\t\t\t\t\t\tif (marker.data.status === 'undecided') {\n\t\t\t\t\t\t\t\t\thasUndecidedChangesets = true\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\thasUndecidedChangesets = this.undecidedPlaces.includes(marker.data._id)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet isInPresets = true\n\t\t\t\t\t\t\tif (presets_length > 0) {\n\t\t\t\t\t\t\t\tisInPresets = presets.map(preset_key => {\n\t\t\t\t\t\t\t\t\treturn marker.data.___preset.key.startsWith(preset_key)\n\t\t\t\t\t\t\t\t}).reduce((bool, value) => (value ? true : bool), false)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet matchesAudienceQueer = true\n\t\t\t\t\t\t\tif (checkAudienceQueerOptions) {\n\t\t\t\t\t\t\t\tif (!audienceQueerOptions.includes(marker.data.tags.audience_queer)) {\n\t\t\t\t\t\t\t\t\tmatchesAudienceQueer = false\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet isInAgeRange = true\n\t\t\t\t\t\t\tif (!!selectedAge) {\n\t\t\t\t\t\t\t\tisInAgeRange = false\n\t\t\t\t\t\t\t\tif (ageOption !== 'open_end' && !!marker.data.tags.min_age && !!marker.data.tags.max_age) {\n\t\t\t\t\t\t\t\t\tconst parsedMin = Number.parseFloat(marker.data.tags.min_age)\n\t\t\t\t\t\t\t\t\tconst parsedMax = Number.parseFloat(marker.data.tags.max_age)\n\t\t\t\t\t\t\t\t\tisInAgeRange = (\n\t\t\t\t\t\t\t\t\t\t(!Number.isNaN(parsedMin) && parsedMin <= selectedAge)\n\t\t\t\t\t\t\t\t\t\t&& (!Number.isNaN(parsedMax) && parsedMax >= selectedAge)\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tif (!!marker.data.tags.min_age) {\n\t\t\t\t\t\t\t\t\t\tconst parsedMin = Number.parseFloat(marker.data.tags.min_age)\n\t\t\t\t\t\t\t\t\t\tisInAgeRange = (!Number.isNaN(parsedMin) && parsedMin <= selectedAge)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tif (isInAgeRange && !!marker.data.tags.max_age) {\n\t\t\t\t\t\t\t\t\t\tconst parsedMax = Number.parseFloat(marker.data.tags.max_age)\n\t\t\t\t\t\t\t\t\t\tisInAgeRange = (!Number.isNaN(parsedMax) && parsedMax >= selectedAge)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.prune_markers[i].filtered = !(publishedFilter && hasUndecidedChangesets && isInPresets && matchesAudienceQueer && isInAgeRange)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.clusterGroup.ProcessView()\n\t\t\t\t\tthis.updateMarkersAfterPruneClusterUpdate()\n\t\t\t\t} else {\n\t\t\t\t\tthis.hideBorders()\n\t\t\t\t\tthis.showAllMarkers()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.hideBorders()\n\t\t\t\tthis.showAllMarkers()\n\t\t\t}\n\t\t}\n\t}\n\n\n\tsetGlobalMapCenter() {\n\t\tconst viewport = this.mapViewport\n\n\t\tif (!(!!viewport && !!viewport.center && !!viewport.zoom)) {\n\t\t\treturn\n\t\t}\n\n\t\tlet mapCenter = viewport.center || { lng: 0, lat: 0 }\n\t\t// if (this.props.sidebarIsOpen) { // TODO this.props.sidebarIsOpen isn't enough on small screens\n\t\t// \tconst p1 = this.map.project(mapCenter)\n\t\t// console.log('p1', p1)\n\t\t// \tconst {x, y} = p1\n\t\t// \tmapCenter = this.map.unproject({\n\t\t// \t\tx: x+200,\n\t\t// \t\ty,\n\t\t// \t}) // map center with sidebar offset\n\t\t//\n\t\t// \tif (Array.isArray(mapCenter)) {\n\t\t// \t\tmapCenter = {\n\t\t// \t\t\tlng: mapCenter[1],\n\t\t// \t\t\tlat: mapCenter[0],\n\t\t// \t\t}\n\t\t// \t}\n\t\t// }\n\n\t\tlet mapZoom = viewport.zoom || 2\n\t\tif (this.clusterGroup) {\n\t\t\tif (mapZoom >= 18) {\n\t\t\t\tthis.clusterGroup.Cluster.Size = 10\n\t\t\t} else if (mapZoom >= 16) {\n\t\t\t\tthis.clusterGroup.Cluster.Size = 20\n\t\t\t} else if (mapZoom >= 14) {\n\t\t\t\tthis.clusterGroup.Cluster.Size = 60\n\t\t\t} else if (mapZoom >= 8) {\n\t\t\t\tthis.clusterGroup.Cluster.Size = 80\n\t\t\t} else {\n\t\t\t\tthis.clusterGroup.Cluster.Size = this.defaultClusterSize\n\t\t\t}\n\t\t}\n\n\t\tthis.props.store.set('map_center_fake', mapCenter)\n\t\tthis.props.store.set('map_center_real', viewport.center)\n\t\tthis.props.store.set('map_zoom', mapZoom)\n\t\t// this.props.store.set('map_bearing', viewport.bearing || 0)\n\t\t// this.props.store.set('map_pitch', viewport.pitch || 0)\n\n\t\twindow.dispatchEvent(new Event('mapViewportUpdated'))\n\t}\n\n\tviewportChanged(viewport) {\n\t\tif (this.leaflet_map) {\n\t\t\tthis.leaflet_map.setView(\n\t\t\t\tviewport.center,\n\t\t\t\tviewport.zoom + 1,\n\t\t\t\t{\n\t\t\t\t\tanimate: false,\n\t\t\t\t\tduration: 0,\n\t\t\t\t}\n\t\t\t)\n\t\t\tthis.updateMarkers()\n\t\t}\n\n\t\tthis.mapViewport = viewport\n\t\tthis.setGlobalMapCenter()\n\t}\n\n\tzoomIn() {\n\t\tthis.map.zoomIn({ duration: 200 })\n\t}\n\tzoomOut() {\n\t\tthis.map.zoomOut({ duration: 200 })\n\t}\n\n\tfiltersChanged(...attr) {\n\t\tif (this.props.onFiltersChanged) {\n\t\t\tthis.props.onFiltersChanged(...attr)\n\t\t}\n\t}\n\n\trender() {\n\t\treturn (<div className={`${this.props.className} ${this.props.mapIsResizing ? 'mapIsResizing' : ''} ${this.props.sidebarIsOpen ? 'sidebarIsOpen' : ''}`}>\n\n\t\t\t<div className=\"filtersPanel\">\n\t\t\t\t<FiltersPanelContent onChange={this.filtersChanged} />\n\t\t\t</div>\n\n\t\t\t<div className={`markerInTheMiddel rainbow ${this.state.isGeoChooser ? 'visible' : 'hidden'}`}>\n\t\t\t\t<div className=\"leaflet-marker-icon marker-custom-icon\">\n\t\t\t\t\t{\n\t\t\t\t\t\t!!this.state.middleMarkerDoc &&\n\t\t\t\t\t\t\t!!this.state.middleMarkerDoc.___color &&\n\t\t\t\t\t\t\t!!this.state.middleMarkerDoc.___color.bg &&\n\t\t\t\t\t\t\t!!this.state.middleMarkerDoc.___color.fg &&\n\t\t\t\t\t\t\t!!this.state.middleMarkerDoc.___preset\n\t\t\t\t\t\t\t? <div className=\"wrapper material-icons-round\" style={{ '--bg-color': this.state.middleMarkerDoc.___color.bg, '--fg-color': this.state.middleMarkerDoc.___color.fg }}>{this.state.middleMarkerDoc.___preset.icon ? this.state.middleMarkerDoc.___preset.icon.toLowerCase() : 'not_listed_location'}</div>\n\t\t\t\t\t\t\t: <div className=\"wrapper material-icons-round\">not_listed_location</div>\n\t\t\t\t\t}\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div className=\"zoomButtons\">\n\t\t\t\t<Fab\n\t\t\t\t\taria-label={this.props.getString('zoom_in_aria_label')}\n\t\t\t\t\ttitle={this.props.getString('zoom_in_aria_label')}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tpointerEvents: 'auto',\n\t\t\t\t\t\tpadding: '0',\n\t\t\t\t\t\twidth: '32px',\n\t\t\t\t\t\theight: '32px',\n\t\t\t\t\t\tminHeight: '32px',\n\t\t\t\t\t\tborderRadius: '8px',\n\t\t\t\t\t\t// borderBottomRightRadius: '2px',\n\t\t\t\t\t\t// borderBottomLeftRadius: '2px',\n\t\t\t\t\t\tmarginBottom: '4px',\n\t\t\t\t\t}}\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tonClick={this.zoomIn}\n\t\t\t\t>\n\t\t\t\t\t<ZoomInIcon />\n\t\t\t\t</Fab>\n\t\t\t\t<br />\n\t\t\t\t<Fab\n\t\t\t\t\taria-label={this.props.getString('zoom_out_aria_label')}\n\t\t\t\t\ttitle={this.props.getString('zoom_out_aria_label')}\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tpointerEvents: 'auto',\n\t\t\t\t\t\tpadding: '0',\n\t\t\t\t\t\twidth: '32px',\n\t\t\t\t\t\theight: '32px',\n\t\t\t\t\t\tminHeight: '32px',\n\t\t\t\t\t\tborderRadius: '8px',\n\t\t\t\t\t\t// borderTopLeftRadius: '2px',\n\t\t\t\t\t\t// borderTopRightRadius: '2px',\n\t\t\t\t\t}}\n\t\t\t\t\tsize=\"small\"\n\t\t\t\t\tonClick={this.zoomOut}\n\t\t\t\t>\n\t\t\t\t\t<ZoomOutIcon />\n\t\t\t\t</Fab>\n\t\t\t</div>\n\n\t\t\t<a\n\t\t\t\ttarget=\"_blank\"\n\t\t\t\trel=\"noopener noreferrer\"\n\t\t\t\thref=\"https://mapbox.com/\"\n\t\t\t>\n\t\t\t\t<img\n\t\t\t\t\tsrc={\n\t\t\t\t\t\tthis.props.theme.palette.type === 'dark'\n\t\t\t\t\t\t\t? mapbox_logo_darkmode\n\t\t\t\t\t\t\t: mapbox_logo_lightmode\n\t\t\t\t\t}\n\t\t\t\t\talt={this.props.getString('mapbox_logo_alt_text')}\n\t\t\t\t\tclassName={classes.mapbox_logo}\n\t\t\t\t/>\n\t\t\t</a>\n\n\t\t\t<Suspense fallback={this.props.globals.renderLazyLoader()}>\n\t\t\t\t<MapboxLoader\n\t\t\t\t\tonLoad={this.loadedMapbox}\n\t\t\t\t\tclassName={\n\t\t\t\t\t\t'map'\n\t\t\t\t\t\t+ (this.state.isGeoChooser ? ' isGeoChooser' : '')\n\t\t\t\t\t}\n\t\t\t\t/>\n\t\t\t</Suspense>\n\n\t\t\t<div\n\t\t\t\tref={this.gotMapRefLeaflet}\n\t\t\t\tclassName='map leaflet'\n\t\t\t></div>\n\n\t\t</div>)\n\t}\n}\n\nexport default withConicGradient(withGlobals(withLocalization(withTheme(MainMapMapbox))))\n","import React from 'react'\n\n// import MainMapLeaflet from './map/MainMapLeaflet.js'\nimport MainMapMapbox from './map/MainMapMapbox.js'\n\nconst Main = props => <MainMapMapbox {...props} />\n\nexport default Main\n","import React, { useEffect, lazy, Suspense } from 'react'\nimport './index.css'\n\nimport { Router, navigate } from '@reach/router'\n\n// import categories from '../../data/dist/categories.json'\n// import presets from '../../data/dist/presets.json'\n// import colors from '../../data/dist/colors.json'\n// import colorsByPreset from '../../data/dist/colorsByPreset.json'\n\nimport { /*Localized,*/ withLocalization } from '../Localized/'\n\nimport { withGlobals } from '../Globals/'\n\nimport { createMuiTheme, ThemeProvider, StylesProvider } from '@material-ui/core/styles'\n// import { CssBaseline } from '@material-ui/core'\n\nimport {\n\tFab,\n\tDrawer,\n} from '@material-ui/core'\nimport {\n\tCloseRounded as CloseIcon,\n\tMenuRounded as MenuIcon,\n\t// FilterList as FilterListIcon,\n\t// ExpandLess as ExpandLessIcon,\n} from '@material-ui/icons'\n\nimport Main from '../Main/'\n// import SearchBar from '../SearchBar/'\n// import Sidebar from '../Sidebar/'\n// import MainDrawerContent from '../MainDrawerContent/'\n\n\n// const MainMap = lazy(() => import('../MainMap'))\nconst SearchBar = lazy(() => import('../SearchBar'))\nconst Sidebar = lazy(() => import('../Sidebar'))\nconst MainDrawerContent = lazy(() => import('../MainDrawerContent'))\n\n\n\n\n\nconst defaultTheme = createMuiTheme({\n\tpalette: {\n\t\ttype: 'light',\n\t\tprimary: {\n\t\t\tmain: '#fff',\n\t\t},\n\t\tsecondary: {\n\t\t\tmain: '#000',\n\t\t},\n\t\taction: {\n\t\t\tactive: '#000',\n\t\t},\n\t\tbackground: {\n\t\t\tpaper: '#ffffff',\n\t\t\tdefault: '#f9f9f9',\n\t\t},\n\t\ttonalOffset: 0.05,\n\t},\n})\n\nfunction HandlePath(props) {\n\tconst action = props.action || ''\n\tconst docID = props.docID || ''\n\tconst onPathChanged = props.onPathChanged\n\n\tuseEffect(function(){\n\t\tif (!!onPathChanged) {\n\t\t\tonPathChanged({\n\t\t\t\taction,\n\t\t\t\tdocID,\n\t\t\t})\n\t\t}\n\t}, [action, docID, onPathChanged])\n\n\treturn null\n}\n\nclass App extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\n\t\tthis.state = {\n\t\t\tsearchBarValue: '',\n\t\t\tsidebarIsOpen: false,\n\t\t\tdoc: null,\n\t\t\tprefersDarkMode: false,\n\n\t\t\tfilters: {\n\t\t\t\tpresets: [],\n\t\t\t},\n\t\t\ttheme: defaultTheme,\n\n\t\t\tisSmallScreen: false,\n\n\t\t\taction: '',\n\t\t\tdocID: '',\n\n\t\t\tisMainDrawerOpen: false,\n\t\t}\n\n\t\tthis.functions = {}\n\n\t\tthis.setSearchBarValue = this.setSearchBarValue.bind(this)\n\t\tthis.setSidebarIsOpen = this.setSidebarIsOpen.bind(this)\n\t\tthis.filtersChanged = this.filtersChanged.bind(this)\n\t\tthis.setTheme = this.setTheme.bind(this)\n\n\t\tthis.check_color_scheme = this.check_color_scheme.bind(this)\n\t\tthis.check_small_screen = this.check_small_screen.bind(this)\n\n\t\tthis.setView = this.setView.bind(this)\n\t\tthis.flyTo = this.flyTo.bind(this)\n\t\tthis.getZoom = this.getZoom.bind(this)\n\n\t\tthis.dontFilterTheseIds = this.dontFilterTheseIds.bind(this)\n\t\tthis.onPathChanged = this.onPathChanged.bind(this)\n\n\t\tthis.closeMainDrawer = this.closeMainDrawer.bind(this)\n\t\tthis.toggleMainDrawer = this.toggleMainDrawer.bind(this)\n\n\t\tthis.closeSidebar = this.closeSidebar.bind(this)\n\t}\n\n\tcomponentDidMount(){\n\t\tif (!!window.matchMedia) {\n\t\t\t// https://react-theming.github.io/create-mui-theme\n\t\t\t// https://material.io/resources/color/#!/?view.left=0&view.right=0&primary.color=FAFAFA&secondary.color=263238\n\n\t\t\tthis.matcher_color_scheme = window.matchMedia('(prefers-color-scheme: dark)')\n\t\t\tthis.matcher_color_scheme.addListener(this.check_color_scheme)\n\t\t\tthis.check_color_scheme(this.matcher_color_scheme)\n\n\t\t\tthis.matcher_small_screen = window.matchMedia('(min-width: 600px)')\n\t\t\tthis.matcher_small_screen.addListener(this.check_small_screen)\n\t\t\tthis.check_small_screen(this.matcher_small_screen)\n\t\t}else{\n\t\t\tthis.setTheme(false)\n\t\t}\n\t}\n\tcomponentWillUnmount(){\n\t\tif (!!window.matchMedia) {\n\t\t\tthis.matcher_color_scheme.removeListener(this.check_color_scheme)\n\t\t\tthis.matcher_small_screen.removeListener(this.check_small_screen)\n\t\t}\n\t}\n\n\tsetTheme(prefersDarkMode){\n\t\tconst background_paper = prefersDarkMode ? '#202020' : '#ffffff'\n\t\tconst background_default = prefersDarkMode ? '#181818' : '#f9f9f9'\n\n\t\tconst secondary_main = prefersDarkMode ? '#448aff' : '#2962ff' // A200_A700\n\n\t\tconst error_main = prefersDarkMode ? '#f44' : '#e00'\n\n\t\tconst theme = createMuiTheme({\n\t\t\ttypography: {\n\t\t\t\tfontFamily: [\n\t\t\t\t\t'Ubuntu',\n\t\t\t\t\t'Helvetica',\n\t\t\t\t\t'Arial',\n\t\t\t\t\t'sans-serif',\n\t\t\t\t\t'\"Apple Color Emoji\"',\n\t\t\t\t\t'\"Segoe UI Emoji\"',\n\t\t\t\t\t'\"Segoe UI Symbol\"',\n\t\t\t\t].join(','),\n\t\t\t\th1: {\n\t\t\t\t\tfontSize: '98px',\n\t\t\t\t\tfontWeight: 'light',\n\t\t\t\t\tletterSpacing: '-1.5px',\n\t\t\t\t},\n\t\t\t\th2: {\n\t\t\t\t\tfontSize: '61px',\n\t\t\t\t\tfontWeight: 'light',\n\t\t\t\t\tletterSpacing: '-0.5px',\n\t\t\t\t},\n\t\t\t\th3: {\n\t\t\t\t\tfontSize: '49px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0px',\n\t\t\t\t},\n\t\t\t\th4: {\n\t\t\t\t\tfontSize: '35px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0.25px',\n\t\t\t\t},\n\t\t\t\th5: {\n\t\t\t\t\tfontSize: '24px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0px',\n\t\t\t\t},\n\t\t\t\th6: {\n\t\t\t\t\tfontSize: '20px',\n\t\t\t\t\tfontWeight: 'medium',\n\t\t\t\t\tletterSpacing: '0.015px',\n\t\t\t\t\t// letterSpacing: '0.15px',\n\t\t\t\t},\n\t\t\t\tsubtitle1: {\n\t\t\t\t\tfontSize: '16px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0.15px',\n\t\t\t\t},\n\t\t\t\tsubtitle2: {\n\t\t\t\t\tfontSize: '14px',\n\t\t\t\t\tfontWeight: 'medium',\n\t\t\t\t\tletterSpacing: '0.1px',\n\t\t\t\t},\n\t\t\t\tbody1: {\n\t\t\t\t\tfontSize: '16px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0.01px',\n\t\t\t\t\t// letterSpacing: '0.5px',\n\t\t\t\t},\n\t\t\t\tbody2: {\n\t\t\t\t\tfontSize: '14px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0.01px',\n\t\t\t\t\t// letterSpacing: '0.25px',\n\t\t\t\t},\n\t\t\t\tbutton: {\n\t\t\t\t\tfontSize: '14px',\n\t\t\t\t\tfontWeight: 'medium',\n\t\t\t\t\tletterSpacing: '0.25px',\n\t\t\t\t\t// letterSpacing: '1.25px',\n\t\t\t\t},\n\t\t\t\tcaption: {\n\t\t\t\t\tfontSize: '12px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '0.4px',\n\t\t\t\t},\n\t\t\t\toverline: {\n\t\t\t\t\tfontSize: '10px',\n\t\t\t\t\tfontWeight: 'normal',\n\t\t\t\t\tletterSpacing: '1.5px',\n\t\t\t\t},\n\t\t\t},\n\t\t\tpalette: {\n\t\t\t\ttype: prefersDarkMode ? 'dark' : 'light',\n\t\t\t\tprimary: {\n\t\t\t\t\tmain: '#fff', // this.state.prefersDarkMode ? '#000' : '#fff' // '#fff'\n\t\t\t\t},\n\t\t\t\tsecondary: {\n\t\t\t\t\tmain: secondary_main,\n\t\t\t\t},\n\t\t\t\taction: {\n\t\t\t\t\tactive: prefersDarkMode ? '#fff' : '#000',\n\t\t\t\t},\n\t\t\t\tbackground: {\n\t\t\t\t\tpaper: background_paper,\n\t\t\t\t\tdefault: background_default,\n\t\t\t\t},\n\t\t\t\terror: {\n\t\t\t\t\tmain: error_main,\n\t\t\t\t},\n\t\t\t\ttonalOffset: 0.05,\n\t\t\t},\n\t\t\tshape: {\n\t\t\t\tborderRadius: 8,\n\t\t\t},\n\t\t\ttransitions: {\n\t\t\t\tduration: {\n\t\t\t\t\tcomplex: 200, // 375,\n\t\t\t\t\tenteringScreen: 200, // 225,\n\t\t\t\t\tleavingScreen: 200, // 195,\n\t\t\t\t\tshort: 200, // 250,\n\t\t\t\t\tshorter: 200, // 200,\n\t\t\t\t\tshortest: 200, // 150,\n\t\t\t\t\tstandard: 200, // 300,\n\t\t\t\t},\n\t\t\t\teasing: {\n\t\t\t\t\teaseIn: \"ease\", // \"cubic-bezier(0.4, 0, 1, 1)\",\n\t\t\t\t\teaseInOut: \"ease\", // \"cubic-bezier(0.4, 0, 0.2, 1)\"\n\t\t\t\t\teaseOut: \"ease\", // \"cubic-bezier(0.0, 0, 0.2, 1)\",\n\t\t\t\t\tsharp: \"ease\", // \"cubic-bezier(0.4, 0, 0.6, 1)\",\n\t\t\t\t},\n\t\t\t},\n\t\t\toverrides: {\n\t\t\t\tMuiInputLabel: {\n\t\t\t\t\t'root': {\n\t\t\t\t\t\ttextOverflow: 'ellipsis',\n\t\t\t\t\t\toverflow: 'hidden',\n\t\t\t\t\t\twhiteSpace: 'nowrap',\n\t\t\t\t\t\tright: '16px',\n\t\t\t\t\t\theight: '100%',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\tMuiLink: {\n\t\t\t\t\troot: {\n\t\t\t\t\t\tcolor: secondary_main,\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tMuiFab: {\n\t\t\t\t\troot: {\n\t\t\t\t\t\tbackgroundColor: background_paper,\n\t\t\t\t\t\tcolor: defaultTheme.palette.getContrastText(background_paper),\n\t\t\t\t\t\ttransition: 'background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\n\t\t\t\t\t\t'&:hover': {\n\t\t\t\t\t\t\tbackgroundColor: background_default,\n\t\t\t\t\t\t\tcolor: defaultTheme.palette.getContrastText(background_paper),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tsecondary: {\n\t\t\t\t\t\tbackgroundColor: defaultTheme.palette.getContrastText(background_paper),\n\t\t\t\t\t\tcolor: background_paper,\n\t\t\t\t\t\ttransition: 'opacity 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,background-color 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\n\t\t\t\t\t\t'&:hover': {\n\t\t\t\t\t\t\topacity: 0.8,\n\t\t\t\t\t\t\tbackgroundColor: defaultTheme.palette.getContrastText(background_paper),\n\t\t\t\t\t\t\tcolor: background_default,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t})\n\n\t\tthis.setState({theme})\n\t}\n\tcheck_color_scheme(event){\n\t\tif(event.matches) {\n\t\t\tthis.setTheme(true)\n\t\t} else {\n\t\t\tthis.setTheme(false)\n\t\t}\n\t}\n\tcheck_small_screen(event){\n\t\tif (event.matches) {\n\t\t\tthis.props.globals.isSmallScreen = false\n\t\t}else{\n\t\t\tthis.props.globals.isSmallScreen = true\n\t\t}\n\n\t\tthis.setState((state, props) => {\n\t\t\tif (this.props.globals.isSmallScreen !== state.isSmallScreen) {\n\t\t\t\treturn {isSmallScreen: this.props.globals.isSmallScreen}\n\t\t\t}\n\t\t\treturn undefined\n\t\t})\n\t\t\n\t\t// const viewport_width = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)\n\t}\n\n\tsaveFunctions(componentName, functionsObject){\n\t\tthis.functions[componentName] = functionsObject\n\t}\n\n\tsetSearchBarValue(value){\n\t\t// this.setState({searchBarValue:value})\n\t}\n\n\tsetSidebarIsOpen(value){\n\t\t// const center = this.functions['Main']['map'].getCenter()\n\t\t// const zoom = this.functions['Main']['map'].getZoom()\n\n\t\tthis.props.globals.sidebarIsOpen = value\n\n\t\tthis.functions['Main']['map'].setPadding({\n\t\t\tleft: (value ? 400 : 0),\n\t\t})\n\n\t\tthis.setState({\n\t\t\tmapIsResizing: true,\n\t\t\tsidebarIsOpen: value,\n\t\t}, ()=>{\n\t\t\tsetTimeout(()=>{\n\t\t\t\tthis.setState({mapIsResizing: false})\n\t\t\t}, 300)\n\t\t\t// this.check_small_screen()\n\n\t\t\t// if (new Date()*1 - this.props.globals.pageOpenTS*1 > 2000) {\n\t\t\t// \t// this.functions['Main']['map'].invalidateSize()\n\t\t\t// \tsetTimeout(()=>{\n\t\t\t// \t\t// const center2 = this.functions['Main']['map'].getCenter()\n\t\t\t// \t\tthis.functions['Main']['map'].flyTo(center, Math.round(zoom), {\n\t\t\t// \t\t\tanimate: true,\n\t\t\t// \t\t\tduration: 1.5,\n\t\t\t// \t\t})\n\t\t\t// \t\t// this.functions['Main']['map'].invalidateSize()\n\t\t\t// \t}, 500)\n\t\t\t// }\n\n\t\t\t// if (new Date()*1 - this.props.globals.pageOpenTS*1 < 2000) {\n\t\t\t// \tthis.functions['Main']['map'].panTo(center, {\n\t\t\t// \t\tanimate: true,\n\t\t\t// \t\tduration: 5,\n\t\t\t// \t})\n\t\t\t// }else{\n\t\t\t// \tthis.functions['Main']['map'].panTo(\n\t\t\t// \t\tthis.functions['Main']['map'].getCenter(), {\n\t\t\t// \t\tanimate: true,\n\t\t\t// \t\tduration: 5,\n\t\t\t// \t})\n\t\t\t// }\n\t\t})\n\t}\n\n\tsetView(...attr){\n\t\treturn this.functions['Main']['map'].setView(...attr)\n\t}\n\tflyTo(...attr){\n\t\treturn this.functions['Main']['map'].flyTo(...attr)\n\t}\n\tgetZoom(...attr){\n\t\treturn this.functions['Main']['map'].getZoom(...attr)\n\t}\n\n\tfiltersChanged(newFilters){\n\t\tthis.setState((state, props) => ({\n\t\t\tfilters:{\n\t\t\t\t...state.filters,\n\t\t\t\t...newFilters,\n\t\t\t}\n\t\t}))\n\t}\n\n\tdontFilterTheseIds(ids){\n\t\tthis.setState((state, props) => ({\n\t\t\tfilters:{\n\t\t\t\t...state.filters,\n\t\t\t\tids,\n\t\t\t}\n\t\t}))\n\t}\n\n\tonPathChanged(pathVars){\n\t\tthis.setState(pathVars)\n\t}\n\n\tcloseMainDrawer(){\n\t\tthis.setState({isMainDrawerOpen:false})\n\t}\n\ttoggleMainDrawer(){\n\t\tthis.setState((state,props)=>{\n\t\t\treturn {isMainDrawerOpen:!state.isMainDrawerOpen}\n\t\t})\n\t}\n\n\tasync closeSidebar(){\n\t\tawait navigate(`/`)\n\t\tthis.dontFilterTheseIds([])\n\t\tthis.setSidebarIsOpen(false)\n\t}\n\n\trender() {\n\t\treturn (<div\n\t\t\tclassName={\n\t\t\t\t'appClassWrapper '\n\t\t\t\t+(this.state.sidebarIsOpen ? 'sidebarIsOpen ' : 'sidebarIsClosed')\n\t\t\t}\n\t\t>\n\t\t\t<ThemeProvider theme={this.state.theme}>\n\t\t\t<StylesProvider injectFirst>\n\n\t\t\t<Router primary={false}>\n\t\t\t\t<HandlePath\n\t\t\t\t\tpath=\"/:action/*docID\"\n\t\t\t\t\tonPathChanged={this.onPathChanged}\n\t\t\t\t/>\n\t\t\t\t<HandlePath\n\t\t\t\t\tpath=\"/\"\n\t\t\t\t\tonPathChanged={this.onPathChanged}\n\t\t\t\t/>\n\t\t\t</Router>\n\n\n\t\t\t<Drawer\n\t\t\t\topen={this.state.isMainDrawerOpen}\n\t\t\t\tonClose={this.toggleMainDrawer}\n\t\t\t>\n\t\t\t\t<Suspense fallback={this.props.globals.renderLazyLoader()}>\n\t\t\t\t\t<MainDrawerContent onClose={this.closeMainDrawer}/>\n\t\t\t\t</Suspense>\n\t\t\t</Drawer>\n\n\t\t\t{/*<Fab\n\t\t\t\taria-label={this.props.getString('open_menu_aria_label')}\n\t\t\t\ttitle={this.props.getString('open_menu_aria_label')}\n\t\t\t\tvariant=\"extended\"\n\t\t\t\tclassName=\"mainMenuFab\"\n\t\t\t\tonClick={this.toggleMainDrawer}\n\t\t\t>\n\t\t\t\t<MenuIcon style={{marginRight:'8px'}} />\n\t\t\t\tQueerMap <Localized\n\t\t\t\t\tid=\"by_brandname_link\"\n\t\t\t\t\telems={{\n\t\t\t\t\t\tmainlink: null,\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</Fab>*/}\n\n\n\t\t\t<Fab\n\t\t\t\taria-label={this.props.getString('open_menu_aria_label')}\n\t\t\t\ttitle={this.props.getString('open_menu_aria_label')}\n\t\t\t\tvariant=\"round\"\n\t\t\t\tsize=\"medium\"\n\t\t\t\tclassName=\"mainMenuFab\"\n\t\t\t\tonClick={this.toggleMainDrawer}\n\t\t\t>\n\t\t\t\t<MenuIcon />\n\t\t\t</Fab>\n\n\t\t\t<Fab\n\t\t\t\taria-label={this.props.getString('close_sidebar_aria_label')}\n\t\t\t\ttitle={this.props.getString('close_sidebar_aria_label')}\n\t\t\t\tvariant=\"extended\"\n\t\t\t\tclassName=\"closeSidebarFab\"\n\t\t\t\tonClick={this.closeSidebar}\n\t\t\t\tstyle={{\n\t\t\t\t\tdisplay: (this.state.sidebarIsOpen ? 'flex' : 'none'),\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<CloseIcon />\n\t\t\t</Fab>\n\n\n\t\t\t<Suspense fallback={this.props.globals.renderLazyLoader()}>\n\n\t\t\t<SearchBar\n\t\t\t\tclassName=\"SearchBar\"\n\t\t\t\tvalue={this.state.searchBarValue}\n\t\t\t\tsidebarIsOpen={this.state.sidebarIsOpen}\n\t\t\t\tonSetSidebarIsOpen={this.setSidebarIsOpen}\n\t\t\t\tonSetSearchBarValue={this.setSearchBarValue}\n\t\t\t\tonDontFilterTheseIds={this.dontFilterTheseIds}\n\t\t\t/>\n\n\t\t\t<Sidebar\n\t\t\t\taction={this.state.action}\n\t\t\t\tdocID={this.state.docID}\n\n\t\t\t\tclassName=\"Sidebar\"\n\n\t\t\t\tonSetSearchBarValue={this.setSearchBarValue}\n\t\t\t\tonSetSidebarIsOpen={this.setSidebarIsOpen}\n\n\t\t\t\tonSetView={this.setView}\n\t\t\t\tonFlyTo={this.flyTo}\n\t\t\t\tonGetZoom={this.getZoom}\n\n\t\t\t\tonDontFilterTheseIds={this.dontFilterTheseIds}\n\t\t\t/>\n\n\t\t\t</Suspense>\n\t\t\t\n\t\t\t<Main\n\t\t\t\tclassName={`page ${this.state.sidebarIsOpen ? 'sidebarIsOpen' : ''}`}\n\t\t\t\tonFunctions={(...attr)=>{this.saveFunctions('Main',...attr)}}\n\t\t\t\tfilters={this.state.filters}\n\t\t\t\tmapIsResizing={this.state.mapIsResizing}\n\t\t\t\tsidebarIsOpen={this.state.sidebarIsOpen}\n\t\t\t\tonFiltersChanged={this.filtersChanged}\n\t\t\t/>\n\n\t\t</StylesProvider>\n\t\t</ThemeProvider>\n\t\t</div>)\n\t}\n}\n\nexport default withGlobals(withLocalization(App))","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\n\n// import * as serviceWorker from './serviceWorker'\n\nimport App from './components/App/'\nimport { GlobalsProvider } from './components/Globals/'\n\nReactDOM.render(\n\t<GlobalsProvider>\n\t\t<App />\n\t</GlobalsProvider>,\n\tdocument.getElementById('root')\n)\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// serviceWorker.unregister()\n","import React from 'react'\n\n// https://projectfluent.org/play/\n\n// import {LocalizationProvider,Localized} from '@fluent/react' // '@fluent/react/compat'\nimport { ReactLocalization, LocalizationProvider } from '@fluent/react'\nimport { FluentBundle, FluentResource } from '@fluent/bundle'\nimport { negotiateLanguages } from '@fluent/langneg'\n\nconst _supportedLocales_ = [\n\t'ar',\n\t'es',\n\t'it',\n\t'ja',\n\t'ko',\n\t'pt',\n\t'ru',\n\t'zh-Hans',\n\t'zh-Hant',\n\n\t'fr',\n\t'de',\n\t'fil',\n\t'vi',\n\t'en_GB',\n\t'en_US',\n\t'en',\n]\nconst _defaultLocale_ = 'en'\n\n\nasync function fetchMessages(locale) {\n\tconst path = await import('./locales/'+locale+'.ftl')\n\n\tconst response = await fetch(path.default)\n\tconst messages = await response.text()\n\n\treturn { [locale]: new FluentResource(messages) }\n}\n\nfunction getDefaultBundles(){\n\tconst bundle = new FluentBundle('')\n\tbundle.addResource(new FluentResource(''))\n\treturn new ReactLocalization([bundle])\n}\n\nasync function createMessagesGenerator(currentLocales) {\n\tconst fetched = await Promise.all(\n\t\tcurrentLocales.map(fetchMessages)\n\t)\n\tconst messages = fetched.reduce(\n\t\t(obj, cur) => Object.assign(obj, cur)\n\t)\n\n\treturn function* generateBundles() {\n\t\tfor (const locale of currentLocales) {\n\t\t\tconst bundle = new FluentBundle(locale)\n\t\t\tbundle.addResource(messages[locale])\n\t\t\tyield bundle\n\t\t}\n\t}\n}\n\nexport class AppLocalizationProvider extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis.state = {\n\t\t\tbundles: getDefaultBundles(),\n\t\t}\n\t}\n\n\tasync componentDidMount() {\n\t\tconst currentLocales = negotiateLanguages(\n\t\t\tthis.props.userLocales,\n\t\t\t_supportedLocales_,\n\t\t\t{ defaultLocale: _defaultLocale_ }\n\t\t)\n\n\t\tconst generateBundles = await createMessagesGenerator(currentLocales)\n\t\tthis.setState({ bundles: new ReactLocalization(generateBundles()) })\n\t}\n\n\trender() {\n\t\tconst { children } = this.props\n\t\tconst { bundles } = this.state\n\n\t\tif (!bundles) {\n\t\t\t// Show a loader.\n\t\t\treturn <div>Loading texts…</div>\n\t\t}\n\n\t\treturn (\n\t\t\t<LocalizationProvider l10n={bundles}>\n\t\t\t\t{children}\n\t\t\t</LocalizationProvider>\n\t\t)\n\t}\n}","import React from 'react'\n\nimport store from 'store'\n\n\n\nconst default_privacy_level_key = 'essentials'\nconst privacy_level_keys = {\n\tessentials: 'privacy_consent_essentials',\n\ttracking: 'privacy_consent_tracking',\n}\n\n\n\nconst storage_functions = {\n\tget: (...args) => {\n\t\treturn store.get(...args)\n\t},\n\n\tset: (key, value, privacy_level_key) => {\n\t\t// this is a wrapper to check if the user consented to storing data on their device\n\t\tif (!(!!privacy_level_keys[key])) { // prevent overwriting of privacy settings\n\t\t\tif (!(!!privacy_level_key)) {\n\t\t\t\tprivacy_level_key = default_privacy_level_key // use a default if no privacy_level_key is provided\n\t\t\t}\n\n\t\t\tif (privacy_level_keys[privacy_level_key]) {\n\t\t\t\tconst privacy_level_consent = store.get(privacy_level_keys[privacy_level_key])\n\t\t\t\tif (privacy_level_consent === true) { // check if the user consented\n\t\t\t\t\tstore.set(key, value)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tsetPrivacy: (privacy_level_key, value) => {\n\t\treturn new Promise((resolve,reject)=>{\n\t\t\tif (!(!!privacy_level_key)) {\n\t\t\t\tprivacy_level_key = default_privacy_level_key // use a default if no privacy_level_key is provided\n\t\t\t}\n\n\t\t\tif (privacy_level_keys[privacy_level_key]) {\n\t\t\t\tstore.set(privacy_level_keys[privacy_level_key], !!value) // store as boolean\n\t\t\t\tresolve()\n\t\t\t} else {\n\t\t\t\treject()\n\t\t\t}\n\t\t})\n\t},\n\tgetPrivacy: (privacy_level_key) => {\n\t\tif (!(!!privacy_level_key)) {\n\t\t\tprivacy_level_key = default_privacy_level_key // use a default if no privacy_level_key is provided\n\t\t}\n\n\t\tif (privacy_level_keys[privacy_level_key]) {\n\t\t\treturn store.get(privacy_level_keys[privacy_level_key]) === true\n\t\t}\n\t\treturn false\n\t},\n}\n\nfunction withLocalStorage(Component) {\n\treturn React.forwardRef(function(props, ref){\n\t\treturn <Component store={storage_functions} ref={ref} {...props} />\n\t})\n}\n\nexport { withLocalStorage }","import React from 'react'\n\nimport 'intl-pluralrules'\nimport { AppLocalizationProvider } from '../../l10n.js'\n\nimport local_ip from '../../.env.local_ip.json'\n\nimport {\n\tApolloClient,\n\tHttpLink,\n\tInMemoryCache,\n} from '@apollo/client'\nimport { persistCache } from 'apollo-cache-persist'\n\nimport { withLocalStorage } from '../LocalStorage/'\n\nimport {\n\twhoami as query_whoami,\n\tcountries as query_countries,\n} from '../../queries.js'\n\nconst isDevEnvironment = (local_ip !== '')\n\n\nfunction getCookie(name){\n\tconst match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'))\n\tif (match) {\n\t\treturn match[2]\n\t}\n\treturn null\n}\n\nasync function getInitialGlobalState(callback){\n\tconst cache = new InMemoryCache()\n\n\ttry {\n\t\t// await before instantiating ApolloClient, else queries might run before the cache is persisted\n\t\tawait persistCache({\n\t\t\tcache,\n\t\t\tstorage: window.localStorage,\n\t\t})\n\t} catch (error) {\n\t\tconsole.error('Error restoring Apollo cache', error)\n\t}\n\t\n\t\n\tconst globalState = {}\n\n\tconst __session = getCookie('__session')\n\n\tglobalState.graphql = new ApolloClient({\n\t\tcache,\n\t\tlink: new HttpLink({\n\t\t\tcredentials: 'omit',\n\t\t\theaders: {\n\t\t\t\t'-x-session': __session,\n\t\t\t},\n\t\t\turi: (\n\t\t\t\tisDevEnvironment\n\t\t\t\t? 'http://0.0.0.0:11692/graphql/v1/' // `http://${local_ip}:5000/qiekub/us-central1/graphql/graphql/v1`\n\t\t\t\t: `https://api.qiekub.org/graphql/v1/`\n\t\t\t),\n\t\t})\n\t})\n\n\tif (!!__session) {\n\t\tglobalState.graphql.query({\n\t\t\tquery: query_whoami,\n\t\t\tfetchPolicy: 'cache-first',\n\t\t}).then(result => {\n\t\t\tglobalState.profileID = result.data.whoami\n\t\t}).catch(error => {\n\t\t\tconsole.error(error)\n\t\t}).finally(() => {\n\t\t\tglobalState.globalStateFinishedLoading = true\n\t\t\tcallback(globalState)\n\t\t})\n\t}else{\n\t\tglobalState.globalStateFinishedLoading = true\n\t\tcallback(globalState)\n\t}\n}\n\n\n\n// ----------------------------------------------------------------\n\nconst GlobalsContext = React.createContext()\n\nconst renderLazyLoader = () => <>Loading…</>\n\nclass GlobalsProvider extends React.Component {\n\tconstructor(props) {\n\t\tsuper(props)\n\n\t\tthis.state = {\n\t\t\tglobalStateFinishedLoading: false,\n\n\t\t\tpageOpenTS: new Date(),\n\t\t\tprofileID: null,\n\t\n\t\t\tlocal_ip,\n\t\t\tisDevEnvironment,\n\t\n\t\t\ttransitionDuration: 300,\n\t\t\tisSmallScreen: true,\n\t\t\tsidebarIsOpen: false,\n\n\t\t\tmainMapFunctions: undefined,\n\n\t\t\tcookieOptions: {\n\t\t\t\tpath: '/',\n\t\t\t\tmaxAge: 31557600, // expires in one year // these cookies doesn't exist for ever, cause they are used as a simple spam protection. Even one month would probably be enough.\n\t\t\t\t...(\n\t\t\t\t\tisDevEnvironment\n\t\t\t\t\t? undefined\n\t\t\t\t\t: {\n\t\t\t\t\t\tdomain: '.qiekub.org',\n\t\t\t\t\t\tsecure: true,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t},\n\n\t\t\tuserLocales: /*['de'] ||*/ navigator.languages,\n\n\t\t\temojis: {\n\t\t\t\taudience_queer_only: '🏳️‍🌈',\n\t\t\t\taudience_queer_primary: '🌈',\n\t\t\t\taudience_queer_welcome: '✨',\n\t\t\t},\n\n\t\t\trenderLazyLoader,\n\t\t}\n\t\t// this.state = {\n\t\t// \t...globalState,\n\t\t// \tset: (...attrs) => {\n\t\t// \t\tthis.setState(...attrs)\n\t\t// \t}\n\t\t// }\n\n\t\tthis.loadedCountries = false\n\t\tthis.country_by_iso_a2 = {}\n\t\tthis.country_by_iso_a3 = {} \n\t\tthis.saved_country_callbacks = []\n\n\t\tthis.loadCountries = this.loadCountries.bind(this)\n\t\tthis.getCountryByAlpha2 = this.getCountryByAlpha2.bind(this)\n\t\tthis.getCountryByAlpha3 = this.getCountryByAlpha3.bind(this)\n\t\tthis.convert_alpha3_to_alpha2 = this.convert_alpha3_to_alpha2.bind(this)\n\t\tthis.convert_alpha2_to_alpha3 = this.convert_alpha2_to_alpha3.bind(this)\n\t\tthis.getCountryByCode = this.getCountryByCode.bind(this)\n\t}\n\n\tcomponentDidMount(){\n\t\tgetInitialGlobalState(globalState=>{\n\t\t\tthis.setState({\n\t\t\t\t...globalState,\n\t\t\t\tgetCountryByAlpha2: this.getCountryByAlpha2,\n\t\t\t\tgetCountryByAlpha3: this.getCountryByAlpha3,\n\t\t\t\tconvert_alpha3_to_alpha2: this.convert_alpha3_to_alpha2,\n\t\t\t\tconvert_alpha2_to_alpha3: this.convert_alpha2_to_alpha3,\n\t\t\t\tgetCountryByCode: this.getCountryByCode,\n\t\t\t}, ()=>{\n\t\t\t\tthis.loadCountries()\n\t\t\t})\n\t\t})\n\t}\n\n\n\tloadCountries(callback){\n\t\tif (callback) {\n\t\t\tthis.saved_country_callbacks.push(callback)\n\t\t}\n\n\t\tif (!this.loadedCountries) {\n\t\t\tif (!!this.state.graphql) {\n\t\t\t\tthis.state.graphql.watchQuery({\n\t\t\t\t\tfetchPolicy: 'cache-and-network',\n\t\t\t\t\tquery: query_countries,\n\t\t\t\t\tvariables: {\n\t\t\t\t\t\twantedTags: [\n\t\t\t\t\t\t\t// 'ISO3166-1',\n\t\t\t\t\t\t\t'ISO3166-1:alpha2',\n\t\t\t\t\t\t\t'ISO3166-1:alpha3',\n\t\t\t\t\t\t\t// 'ISO3166-1:numeric',\n\t\t\t\t\t\t\t// 'timezone',\n\t\t\t\t\t\t],\n\t\t\t\t\t\tlanguages: navigator.languages,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.subscribe(({data}) => {\n\t\t\t\t\tif (!!data && !!data.countries) {\n\t\t\t\t\t\tconst country_by_iso_a2 = {}\n\t\t\t\t\t\tconst country_by_iso_a3 = {}\n\t\t\n\t\t\t\t\t\tfor (const doc of data.countries) {\n\t\t\t\t\t\t\tlet country_key_a2 = doc.properties.tags['ISO3166-1:alpha2']\n\t\t\t\t\t\t\tif (country_key_a2) {\n\t\t\t\t\t\t\t\tcountry_key_a2 = country_key_a2.toUpperCase()\n\t\t\t\t\t\t\t\tcountry_by_iso_a2[country_key_a2] = doc\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet country_key_a3 = doc.properties.tags['ISO3166-1:alpha3']\n\t\t\t\t\t\t\tif (country_key_a3) {\n\t\t\t\t\t\t\t\tcountry_key_a3 = country_key_a3.toUpperCase()\n\t\t\t\t\t\t\t\tcountry_by_iso_a3[country_key_a3] = doc\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\n\t\t\t\t\t\tthis.country_by_iso_a2 = country_by_iso_a2\n\t\t\t\t\t\tthis.country_by_iso_a3 = country_by_iso_a3\n\n\t\t\t\t\t\tthis.loadedCountries = true\n\t\n\t\t\t\t\t\tfor (const saved_country_callback of this.saved_country_callbacks) {\n\t\t\t\t\t\t\tsaved_country_callback()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t}else{\n\t\t\tfor (const saved_country_callback of this.saved_country_callbacks) {\n\t\t\t\tsaved_country_callback()\n\t\t\t}\n\t\t}\n\t}\n\n\tgetCountryByAlpha2(alpha2, callback){\n\t\tthis.loadCountries(()=>{\n\t\t\talpha2 = alpha2.toUpperCase()\n\t\t\tcallback(this.country_by_iso_a2[alpha2])\n\t\t})\n\t}\n\tgetCountryByAlpha3(alpha3, callback){\n\t\tthis.loadCountries(()=>{\n\t\t\talpha3 = alpha3.toUpperCase()\n\t\t\tcallback(this.country_by_iso_a3[alpha3])\n\t\t})\n\t}\n\n\tconvert_alpha3_to_alpha2(alpha3, callback){\n\t\tthis.getCountryByAlpha3(alpha3, countryDoc=>{\n\t\t\tcallback(countryDoc.properties.tags['ISO3166-1:alpha2'])\n\t\t})\n\t}\n\tconvert_alpha2_to_alpha3(alpha2, callback){\n\t\tthis.getCountryByAlpha2(alpha2, countryDoc=>{\n\t\t\tcallback(countryDoc.properties.tags['ISO3166-1:alpha3'])\n\t\t})\n\t}\n\n\tgetCountryByCode(iso_a3, callback){\n\t\tthis.getCountryByAlpha3(iso_a3, callback)\n\t}\n\n\trender() {\n\t\treturn (\n\t\t\t<GlobalsContext.Provider\n\t\t\t\tkey=\"GlobalsContext.Provider\"\n\t\t\t\tvalue={this.state}\n\t\t\t>\n\t\t\t\t<AppLocalizationProvider key=\"AppLocalizationProvider\" userLocales={this.state.userLocales}>\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.state.globalStateFinishedLoading\n\t\t\t\t\t\t? this.props.children\n\t\t\t\t\t\t: <>Loading cache data…</>\n\t\t\t\t\t}\n\t\t\t\t</AppLocalizationProvider>\n\t\t\t</GlobalsContext.Provider>\n\t\t)\n\t}\n}\n\nfunction useGlobals() {\n\treturn React.useContext(GlobalsContext)\n}\n\nfunction withGlobals(Component) {\n\tconst ComponentWrapped = withLocalStorage(Component)\n\t\n\treturn React.forwardRef(function(props, ref){\n\t\tconst globals = useGlobals()\n\t\treturn <ComponentWrapped globals={globals} ref={ref} {...props} />\n\t})\n}\n\nexport default GlobalsContext\n\nexport { GlobalsContext, GlobalsProvider, withGlobals, useGlobals }\n\n\n","import ilga_dataset from './data/dist/ilga_2019.json'\n\nimport { negotiateLanguages } from '@fluent/langneg'\nimport address_formats from './data/dist/address_formats.json'\nconst addressFormats = address_formats.map(item => ({\n\t...item,\n\tkeys: [].concat(...item.format),\n}))\n\n\nexport function uuidv4() {\n\t// source: https://stackoverflow.com/a/2117523/2387277\n\t// source: https://stackoverflow.com/questions/105034/how-to-create-guid-uuid\n\treturn ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>\n\t\t// eslint-disable-next-line\n\t\t(c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n\t)\n}\n\n\n\nexport function getTranslation(texts, userLocales = []) {\n\t// texts = {\n\t// \ten: 'hello world'\n\t// }\n\n\tif (typeof texts === 'object') {\n\t\tconst keys = Object.keys(texts)\n\t\tif (keys.length > 0) {\n\t\t\tconst currentLocales = negotiateLanguages(\n\t\t\t\tuserLocales,\n\t\t\t\tkeys,\n\t\t\t\t{}\n\t\t\t)\n\n\t\t\tif (currentLocales.length > 0) {\n\t\t\t\treturn texts[currentLocales[0]]\n\t\t\t}\n\t\t\treturn texts[keys[0]]\n\t\t}\n\t}\n\n\treturn ''\n}\nexport function getTranslationFromArray(texts_array, ...attrs) {\n\t// texts_array = [\n\t// \tlanguage: 'en',\n\t// \ttext: 'hello world',\n\t// ]\n\n\tif (!Array.isArray(texts_array)) {\n\t\treturn ''\n\t}\n\n\tconst text_object = {}\n\tfor (const text of texts_array) {\n\t\ttext_object[text.language || ''] = text.text\n\t}\n\n\treturn getTranslation(text_object, ...attrs)\n}\n\n\n\nexport function getPreset(tags,presets) {\n\tconst tags_keys = Object.keys(tags)\n\tfor (const preset_key in presets) {\n\t\tconst preset_tags = presets[preset_key].tags\n\t\tconst preset_tags_keys = Object.keys(preset_tags)\n\n\t\tconst common_keys = preset_tags_keys.filter(key => tags_keys.includes(key))\n\n\t\tif (common_keys.length === preset_tags_keys.length) {\n\t\t\tconst okay_keys = common_keys.filter(key => preset_tags[key] === '*' || tags[key].includes(preset_tags[key]))\n\t\t\tif (okay_keys.length === preset_tags_keys.length) {\n\t\t\t\treturn {\n\t\t\t\t\tkey: preset_key,\n\t\t\t\t\t...presets[preset_key],\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\n\treturn presets.default\n}\n\n\nexport function getColorByPreset(preset_key,colorsByPreset_sorted){\n\tfor (const pair of colorsByPreset_sorted) {\n\t\tif (preset_key.startsWith(pair[0])) {\n\t\t\treturn pair[1]\n\t\t\t// break\n\t\t}\n\t}\n}\n\n\n\nexport function addAddressFormatDefaults(addressFormat){\n\t// format-defaults from ID\n\taddressFormat.format = addressFormat.format || [\n\t\t['housenumber', 'street'],\n\t\t['city', 'postcode']\n\t]\n\n\t// widths-defaults from ID\n\taddressFormat.widths = addressFormat.widths || {\n\t\thousenumber: 1/3, street: 2/3, unit: 1/3,\n\t\tcity: 2/3, state: 1/3, postcode: 1/3,\n\t\t// housenumber: 1/3, street: 2/3,\n\t\t// city: 2/3, state: 1/4, postcode: 1/3,\n\t}\n\n\taddressFormat.keys = addressFormat.keys || [].concat(...addressFormat.format)\n\n\treturn addressFormat\n}\n\nexport function getAddressFormatDefault(){\n\tfor (const addressFormat of addressFormats) {\n\t\tif (addressFormat.countryCodes.length === 0) {\n\t\t\treturn addAddressFormatDefaults(addressFormat)\n\t\t} \n\t}\n\n\treturn null\n}\n\nexport function getAddressFormatByCountryCode(countryCode, showAllFields){\n\tcountryCode = (countryCode || '').toUpperCase()\n\n\tlet addressFormat2return = null\n\n\tfor (const addressFormat of addressFormats) {\n\t\tif (addressFormat.countryCodes.includes(countryCode)) {\n\t\t\taddressFormat2return = addAddressFormatDefaults(addressFormat)\n\t\t\tbreak\n\t\t}\n\t}\n\n\tif (addressFormat2return === null) {\n\t\taddressFormat2return = getAddressFormatDefault()\n\t}\n\n\taddressFormat2return = JSON.parse(JSON.stringify(addressFormat2return)) // clone the object as we are using push afterwards\n\n\tif (showAllFields && addressFormat2return !== null) {\n\t\tconst alreadInUseKeys = addressFormat2return.keys\n\n\t\tfor (const addressFormat of addressFormats) {\n\t\t\tif (addressFormat.countryCodes.includes('_ALL_FIELDS_')) {\n\t\t\t\tconst missingKeys = addressFormat.keys\n\t\t\t\t\n\t\t\t\tconst keys2add = missingKeys.filter(key => !alreadInUseKeys.includes(key))\n\t\t\t\tfor (const key of keys2add) {\n\t\t\t\t\taddressFormat2return.format.push([key])\n\t\t\t\t\taddressFormat2return.widths[key] = 1\n\t\t\t\t}\n\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\n\treturn addressFormat2return\n}\n\nexport function getAddressFormatByTags(tags) {\n\tconst addr_keys = Object.keys(tags)\n\t.filter(key => key.startsWith('addr:'))\n\t.map(key => key.split('addr:')[1])\n\n\treturn getAddressFormatBySubkeys(addr_keys)\n}\n\nexport function getAddressFormatBySubkeys(addr_keys) {\n\tlet lastMatchCount = 0\n\tlet lastAddressFormat = null\n\tfor (const addressFormat of addressFormats) {\n\t\tif (!addressFormat.countryCodes.includes('_ALL_FIELDS_')) {\n\t\t\tconst thisMatchCount = addr_keys.filter(value => addressFormat.keys.includes(value)).length\n\t\t\t\n\t\t\tif (thisMatchCount >= lastMatchCount) {\n\t\t\t\tlastMatchCount = thisMatchCount\n\t\t\t\tlastAddressFormat = addressFormat\n\t\t\t}\n\t\t}\n\t}\n\t\n\tif (!!lastAddressFormat) {\n\t\treturn addAddressFormatDefaults(lastAddressFormat)\n\t}\n\t\n\treturn null\n}\n\n\nexport function getWantedTagsList(presets){\n\treturn [...new Set([].concat(...Object.values(presets).map(preset=>Object.keys(preset.tags))))]\n}\n\n\nexport function getILGA(alpha3code){\n\t\tconst TR = {} // TR means \"to return\"\n\n\t\tif (!(!!alpha3code)) {\n\t\t\treturn null\n\t\t}\n\t\t\n\t\t\n\t\tconst ilga = ilga_dataset[alpha3code]\n\n\t\tif (!(!!ilga)) {\n\t\t\treturn null\n\t\t}\n\t\t\n\t\tTR.ilga = ilga\n\n\n\t\t// ### criminalisation:legality\n\t\tconst legality_values = [\n\t\t\t'legal_for_all',\n\t\t\t'legal_for_males',\n\t\t\t'legal_for_female',\n\t\t\t'illegal_for_all',\n\t\t\t'illegal_for_males',\n\t\t\t'illegal_for_female',\n\t\t\t'unknown',\n\t\t]\n\n\t\tconst legality_key = 'criminalisation:legality'\n\t\tconst gender_key = 'criminalisation:legality:by_gender'\n\n\t\tTR.criminalisation = {}\n\t\tTR.criminalisation.description = 'criminalisation:legality:unknown'\n\t\tif (\n\t\t\tilga.hasOwnProperty(gender_key)\n\t\t\t&& legality_values.includes(ilga[gender_key])\n\t\t) {\n\t\t\tTR.criminalisation.description = 'criminalisation:legality:'+ilga[gender_key]\n\t\t} else if (ilga.hasOwnProperty(legality_key)) {\n\t\t\tif (ilga[legality_key] === true) {\n\t\t\t\tTR.criminalisation.description = 'criminalisation:legality:legal_for_all'\n\t\t\t} else if (ilga[legality_key] === false) {\n\t\t\t\tTR.criminalisation.description = 'criminalisation:legality:illegal_for_all'\n\t\t\t}\n\t\t}\n\n\t\tTR.criminalisation.status = null\n\t\tif (TR.criminalisation.description === 'criminalisation:legality:legal_for_all') {\n\t\t\tTR.criminalisation.status = 'great'\n\t\t} else if (TR.criminalisation.description === 'criminalisation:legality:illegal_for_all') {\n\t\t\tTR.criminalisation.status = 'bad'\n\t\t} else if (TR.criminalisation.description !== 'criminalisation:legality:unknown') {\n\t\t\tTR.criminalisation.status = 'ok'\n\t\t}\n\n\t\tTR.criminalisation.description = [TR.criminalisation.description]\n\n\n\t\t// ### criminalisation:penalty\n\t\tTR.penalty = {}\n\t\tTR.penalty.description = []\n\t\tTR.penalty.vars = {}\n\t\tconst penalty_keys = Object.keys(ilga)\n\t\t.filter(key => key.startsWith('criminalisation:penalty:max:'))\n\t\t.sort((a, b) => a-b)\n\t\t\t\n\t\tfor (const key of penalty_keys) {\n\t\t\tif (ilga[key] === true) {\n\t\t\t\tTR.penalty.description.push(key)\n\t\t\t} else if (!isNaN(ilga[key]) && ilga[key] > 0) {\n\t\t\t\tTR.penalty.description.push('criminalisation:penalty:max:years')\n\t\t\t\tTR.penalty.vars.years = ilga[key]\n\t\t\t}\n\t\t}\n\n\t\tTR.penalty.status = null\n\t\tif (TR.penalty.description.length === 0) {\n\t\t\tTR.penalty.status = 'great'\n\t\t\tTR.penalty.description.push('criminalisation:penalty:none')\n\t\t} else if (TR.penalty.description.length > 0) {\n\t\t\tif (\n\t\t\t\tTR.penalty.description.includes('criminalisation:penalty:max:death')\n\t\t\t\t|| TR.penalty.description.includes('criminalisation:penalty:max:lifetime')\n\t\t\t) {\n\t\t\t\tTR.penalty.status = 'bad'\n\t\t\t}else{\n\t\t\t\tTR.penalty.status = 'ok'\n\t\t\t}\n\t\t}\n\n\n\t\t// ### protection\n\t\tTR.protection = {}\n\t\tTR.protection.description = []\n\t\tconst protection_keys = Object.keys(ilga)\n\t\t.filter(key => key.startsWith('protection:'))\n\t\t.sort((a, b) => a-b)\n\t\t\t\n\t\tfor (const key of protection_keys) {\n\t\t\tif (ilga[key] === true) {\n\t\t\t\tTR.protection.description.push(key)\n\t\t\t}\n\t\t}\n\n\t\tTR.protection.status = null\n\t\tif (\n\t\t\tTR.protection.description.includes('protection:constitutional')\n\t\t\t|| TR.protection.description.length >= 6 // max is 6\n\t\t) {\n\t\t\tTR.protection.status = 'great'\n\t\t} else if (TR.protection.description.length > 0) {\n\t\t\tTR.protection.status = 'ok'\n\t\t} else {\n\t\t\tTR.protection.status = 'bad'\n\t\t}\n\n\t\tif (TR.protection.description.length === 0) {\n\t\t\tTR.protection.description.push('protection:none')\n\t\t}\n\n\n\t\t// ### recognition\n\t\tTR.recognition = {}\n\t\tTR.recognition.description = []\n\t\tconst recognition_keys = Object.keys(ilga)\n\t\t.filter(key => key.startsWith('recognition:'))\n\t\t.sort((a, b) => a-b)\n\t\t\t\n\t\tfor (const key of recognition_keys) {\n\t\t\tif (ilga[key] === true) {\n\t\t\t\tTR.recognition.description.push(key)\n\t\t\t}\n\t\t}\n\n\t\tTR.recognition.status = null\n\t\tif (\n\t\t\tTR.recognition.description.includes('recognition:marriage')\n\t\t\t|| TR.recognition.description.length >= 4 // max is 4\n\t\t) {\n\t\t\tTR.recognition.status = 'great'\n\t\t} else if (TR.recognition.description.length > 0) {\n\t\t\tTR.recognition.status = 'ok'\n\t\t} else {\n\t\t\tTR.recognition.status = 'bad'\n\t\t}\n\n\t\tif (TR.recognition.description.length === 0) {\n\t\t\tTR.recognition.description.push('recognition:none')\n\t\t}\n\n\n\t\tTR.overview = {}\n\t\tTR.overview.statusNumber = -1\n\t\tif (\n\t\t\tTR\n\t\t\t&& TR.criminalisation\n\t\t\t&& TR.criminalisation.status\n\t\t\t&& TR.penalty\n\t\t\t&& TR.penalty.status\n\t\t\t&& TR.protection\n\t\t\t&& TR.protection.status\n\t\t\t&& TR.recognition\n\t\t\t&& TR.recognition.status\n\t\t) {\n\t\t\tconst getStatusNumber = status => {\n\t\t\t\tif (status === 'great') {\n\t\t\t\t\treturn 1\n\t\t\t\t} else if (status === 'ok') {\n\t\t\t\t\treturn 2\n\t\t\t\t} else if (status === 'bad') {\n\t\t\t\t\treturn 3\n\t\t\t\t}\n\t\t\t\treturn -1\n\t\t\t}\n\n\t\t\tTR.overview.statusNumber = Math.max(...[\n\t\t\t\tgetStatusNumber(TR.criminalisation.status),\n\t\t\t\tgetStatusNumber(TR.penalty.status),\n\t\t\t\tgetStatusNumber(TR.protection.status),\n\t\t\t\tgetStatusNumber(TR.recognition.status),\n\t\t\t])\n\t\t}\n\n\n\t\treturn TR\n}\n\nexport function getCountryCode(properties){\n\tlet country_code = null\n\tif (properties.ISO_A3 && properties.ISO_A3 !== '-99') {\n\t\tcountry_code = properties.ISO_A3\n\t} else if (properties.ISO_A3_EH && properties.ISO_A3_EH !== '-99') {\n\t\tcountry_code = properties.ISO_A3_EH\n\t} else if (properties.ADM0_A3 && properties.ADM0_A3 !== '-99') {\n\t\tcountry_code = properties.ADM0_A3\n\t}\n\n\treturn country_code\n}\n\n\n","import {gql} from '@apollo/client'\n\nexport const id = gql`\n\tquery {\n\t\tid\n\t}\n`\n\nexport const whoami = gql`\n\tquery {\n\t\twhoami\n\t}\n`\n\nexport const place = gql`\n\tquery($_id: ID, $wantedTags: [String], $languages: [String]){\n\t\tplace(_id: $_id){\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t__typename\n\t\t\t\t... on Place {\n\t\t\t\t\tname (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\tdescription (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\tgeometry {\n\t\t\t\t\t\tlocation {\n\t\t\t\t\t\t\tlng\n\t\t\t\t\t\t\tlat\n\t\t\t\t\t\t}\n\t\t\t\t\t\tboundingbox {\n\t\t\t\t\t\t\tnortheast {\n\t\t\t\t\t\t\t\tlng\n\t\t\t\t\t\t\t\tlat\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tsouthwest {\n\t\t\t\t\t\t\t\tlng\n\t\t\t\t\t\t\t\tlat\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\ttags(keys: $wantedTags)\n\t\t\t\t}\n\t\t\t\t... on Changeset {\n\t\t\t\t\ttags\n\t\t\t\t\tforID\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const countries = gql`\n\tquery($wantedTags: [String], $languages: [String]){\n\t\tcountries{\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t... on Place {\n\t\t\t\t\tname (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\ttags(keys: $wantedTags)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const markers = gql`\n\tquery($languages: [String]){\n\t\tmarkers{\n\t\t\t_id\n\t\t\toriginalTypename\n\t\t\tname (languages: $languages){\n\t\t\t\ttext\n\t\t\t\tlanguage\n\t\t\t}\n\t\t\tlng\n\t\t\tlat\n\t\t\tpreset\n\t\t\tstatus\n\t\t\ttags\n\t\t}\n\t}\n`\n\nexport const search = gql`\n\tquery($query: String=\"\", $languages: [String]){\n\t\tsearch(query: $query, languages: $languages){\n\t\t\tquery\n\t\t\tresults {\n\t\t\t\tplaceID\n\t\t\t\tpreset\n\t\t\t\tname {\n\t\t\t\t\ttext\n\t\t\t\t\tlanguage\n\t\t\t\t}\n\t\t\t\taddress\n\t\t\t\tgeometry {\n\t\t\t\t\tlocation {\n\t\t\t\t\t\tlng\n\t\t\t\t\t\tlat\n\t\t\t\t\t}\n\t\t\t\t\tboundingbox {\n\t\t\t\t\t\tnortheast {\n\t\t\t\t\t\t\tlng\n\t\t\t\t\t\t\tlat\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsouthwest {\n\t\t\t\t\t\t\tlng\n\t\t\t\t\t\t\tlat\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const questions = gql`\n\tquery($languages: [String]){\n\t\tquestions {\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t... on Question {\n\t\t\t\t\tquestion (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\tin_one_word (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\tdescription (languages: $languages){\n\t\t\t\t\t\ttext\n\t\t\t\t\t\tlanguage\n\t\t\t\t\t}\n\t\t\t\t\ticon\n\t\t\t\t\tpossibleAnswers {\n\t\t\t\t\t\tinputtype\n\t\t\t\t\t\tinputOptions\n\t\t\t\t\t\tnamespace\n\t\t\t\t\t\tparsers\n\t\t\t\t\t\tkey\n\t\t\t\t\t\ticon\n\t\t\t\t\t\ttitle (languages: $languages){\n\t\t\t\t\t\t\ttext\n\t\t\t\t\t\t\tlanguage\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdescription (languages: $languages){\n\t\t\t\t\t\t\ttext\n\t\t\t\t\t\t\tlanguage\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfollowUpQuestionIDs\n\t\t\t\t\t\ttags\n\t\t\t\t\t\thidden\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const countrycode = gql`\n\tquery($lat: Float = 0.0, $lng: Float = 0.0) {\n\t\tcountrycode(lat: $lat, lng: $lng)\n\t}\n`\n\nexport const addChangeset = gql`\n\tmutation($properties: Changeset_Input){\n\t\taddChangeset(properties: $properties)\n\t}\n`\n\nexport const addEdge = gql`\n\tmutation($properties: Edge_Input){\n\t\taddEdge(properties: $properties)\n\t}\n`\n\nexport const sessions = gql`\n\tquery {\n\t\tsessions {\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t__typename\n\t\t\t\t... on Session {\n\t\t\t\t\tprofileID\n\t\t\t\t\tuser_agent\n\t\t\t\t\tstarted\n\t\t\t\t\texpires\n\t\t\t\t\tlastModified\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const accounts = gql`\n\tquery {\n\t\taccounts {\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t__typename\n\t\t\t\t... on Account {\n\t\t\t\t\tprovider\n\t\t\t\t\tusername\n\t\t\t\t\tdisplayName\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const undecidedPlaces = gql`\n\tquery($forID: ID) {\n\t\tundecidedPlaces(forID: $forID) {\n\t\t\t_id\n\t\t}\n\t}\n`\n\nexport const undecidedTags = gql`\n\tquery($forID: ID) {\n\t\tundecidedTags(forID: $forID)\n\t}\n`\n\nexport const changesets = gql`\n\tquery($forID: ID) {\n\t\tchangesets(forID: $forID) {\n\t\t\t_id\n\t\t\tproperties {\n\t\t\t\t__typename\n\t\t\t\t... on Changeset {\n\t\t\t\t\tforID\n\t\t\t\t\ttags\n\t\t\t\t\tsources\n\t\t\t\t\tfromBot\n\t\t\t\t\tdataset\n\t\t\t\t\tantiSpamUserIdentifier\n\t\t\t\t}\n\t\t\t}\n\t\t\tmetadata {\n\t\t\t\tcreated\n\t\t\t}\n\t\t}\n\t}\n`\n\nexport const recompile = gql`\n\tmutation($_id: ID){\n\t\trecompile(_id: $_id)\n\t}\n`\n\n\n"],"sourceRoot":""}